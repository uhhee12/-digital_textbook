"use strict";var EDUTSS=EDUTSS||{};EDUTSS.util={isTouch:"ontouchstart"in document.documentElement,detectDevice:function(){EDUTSS.isDevice=EDUTSS.util.getDevice(),EDUTSS.isMobile=EDUTSS.util.isMobile(),document.body&&(EDUTSS.isDevice&&(document.body.dataset.browserType="is--"+EDUTSS.isDevice),EDUTSS.isMobile?document.body.dataset.deviceType="is--mobile":document.body.dataset.deviceType="is--desktop"),EDUTSS.isDevMsg&&console.log("#D: [isTouch] "+EDUTSS.util.isTouch+", [isDevice] "+EDUTSS.isDevice+", [isMobile] "+EDUTSS.isMobile+", [isMobileType] "+EDUTSS.isMobileType)},isMobile:function(){if(void 0!==EDUTSS.isMobile)return EDUTSS.isMobile;let e=!1,t=["iPhone","iPod","BlackBerry","Android","Windows CE","LG","MOT","SAMSUNG","SonyEricsson","webOS","IEMobile","Opera Mini"];if(navigator.platform){if(0>"win16|win32|win64|mac|macintel".indexOf(navigator.platform.toLowerCase())){for(var i in e=!0,t)if(null!==navigator.userAgent.match(t[i])){EDUTSS.isMobileType=t[i];break}}else EDUTSS.isMobileType=!1}return e?EDUTSS.isMobile=!0:EDUTSS.isMobile=!1,e},getDevice:function(){if(void 0!==EDUTSS.isDevice)return EDUTSS.isDevice;let e=navigator.userAgent.toLowerCase(),t;t=/(?=.*chrome)^(?!.*edg)^(?!.*android)/.test(e)?"chrome":/firefox/.test(e)?"firefox":/edg/.test(e)?"edge":/trident/.test(e)?"ie":/android/.test(e)?"android":/iphone|ipad|ipod/.test(e)?"ios":/safari/.test(e)?"safari":"etc";let i=navigator.userAgent.match(/(iPad)/)||"MacIntel"===navigator.userAgent.platform&&navigator.userAgent.maxTouchPoints>1;return i&&(t="ios"),t},getEvt:function(e){let t="",i=EDUTSS.util.isTouch;return"down"===e?i?"touchstart":"mousedown":"up"===e?i?"touchend":"mouseup":"move"===e?i?"touchmove":"mousemove":"enter"===e?i?"touchstart":"mouseenter":"leave"===e?i?"touchcancel":"mouseleave":e},getEle:function(e,t){let i;if(e.includes("#"))i=document.getElementById(e.slice(1));else{let a=t||document;i=a.querySelectorAll(e)}return i},createEle:function(e,t,i,a){let n=document.createElement(e);for(var s in t)t[s]&&n.setAttribute(s,t[s]);return a?i&&i.prepend(n):i&&i.append(n),n},addCls:function(e,t){if(e){let i=e.length,a=t.split(" "),n=a.length;for(let s=0;s<n;s++){let o=a[s];if(i)for(let l=0;l<i;l++)e[l].classList.add(o);else if(!NodeList.prototype.isPrototypeOf(e)&&(e.classList.add(o),n<=1))return e}}},removeCls:function(e,t){if(e){let i=e.length,a=t.split(" "),n=a.length;for(let s=0;s<n;s++){let o=a[s];if(i)for(let l=0;l<i;l++)e[l].classList.remove(o);else if(!NodeList.prototype.isPrototypeOf(e)&&(e.classList.remove(o),n<=1))return e}}},hasCls:function(e,t){if(e){let i=e.classList.contains(t);return i}},addEvt:function(e,t,i,a){let n=EDUTSS.util.getEvt(t);if(e){if(e.length){let s=e.length;for(let o=0;o<s;o++)e[o].addEventListener(n,i,a)}else e instanceof NodeList||e.addEventListener(n,i,a)}},removeEvt:function(e,t,i,a){let n=EDUTSS.util.getEvt(t);if(e){if(e.length){let s=e.length;for(let o=0;o<s;o++)e[o].removeEventListener(n,i,a)}else e.removeEventListener(n,i,a)}},getIdx:function(e,t){return e?t?[].indexOf.call(e,t):[].indexOf.call(e.parentNode.children,e):-1},getRandomNumber:function(e){let t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*e)+t},getText:function(e){return e.replace(/[\{\}\[\]\?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"\s\\n\\r]/gi,"")},getFileName:function(){return window.location.href.split("/").slice(-3)},getFileNum:function(){return this.getFileName().slice(-1)[0].split("?")[0].replace(/[^0-9]/g,"")},getURL:function(){let e={};return window.location.search.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,i,a){e[i]=a}),e},isNum:function(e){return e<10?"0"+e:e.toString()},isInViewport:function(e){var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)},isInDisplay:function(e){let t=e.getBoundingClientRect(),i=!0;return 0===t.width&&0===t.height&&(i=!1),i},setStyle:function(e,t){for(var i in t)e.style[i]=t[i]},getStyle:function(e){return window.getComputedStyle(e)},createAudio:function(e){let t=new Audio;return t.src=e,t.load(),t},loadJSON:function(e,t){var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",e,!0),i.onreadystatechange=function(){4===i.readyState&&"200"==i.status&&t(i.responseText)},i.send(null)},copyPaste:function(e,t){if(e.innerHTML="",t){let i=null;e.innerHTML=t.innerHTML,(i=this.getEle(".scroll_area",e)[0])&&"scroll"!==e.closest(".popup").dataset.duplicationTextarea&&(i.removeAttribute("data-layout-type"),i.removeAttribute("data-scroll-id"),this.removeCls(i,"scroll_area"),this.removeCls(this.getEle(".scroll--content",i),"scroll--content")),this.getEle(".scroll_area",e).forEach(function(e){EDUTSS.view.initScroll(e)}),this.getEle(".slider_area",e).forEach(function(e){EDUTSS.view.initSlide(e)}),(function i(){this.getEle(".drawing--canvas",e).forEach((function(e,i){let a=this.getEle(".drawing--canvas",t)[i],n=this.getEle(".drawing--save",a.parentElement)[0].value,s=e.getContext("2d"),o=new Image;o.src=n,o.onload=function(){s.drawImage(o,0,0)}}).bind(this))}).call(this),this.getEle("[data-duplication-type]",e).forEach(function(e){"false"===e.dataset.duplicationType&&e.remove()}),this.getEle("input, textarea",e).forEach(function(e){e.removeAttribute("id")})}},getCursorPos:function(e){let t=0,i=0;return t=(e=e||window.event).pageX,i=e.pageY,{x:t=(t-window.pageXOffset)/EDUTSS.scaleValue.zoom,y:i=(i-window.pageYOffset)/EDUTSS.scaleValue.zoom}},createMarkingGif:function(e){if(this.getEle("oxquiz--answer--marking",e)[0])return;let t=this.createEle("span",{class:"oxquiz--answer--marking"},this.getEle(".icon",e)[0]);this.createEle("img",{src:"./images/libs/quiz/marking_o.gif?"+this.getRandomNumber(1e4)},t)},detectDoubleTab:function(e){let t=0;return function(i){let a=new Date().getTime(),n=a-t;i.preventDefault(),n<400&&(EDUTSS.util.addCls(i.target,"double--tap"),e(i)),t=a}}};var EDUTSS=EDUTSS||{};EDUTSS.ui=function(){let e=EDUTSS.util;return{initPageNum:function(){let t=e.getFileName(),i=e.getFileNum(),a=parseInt(i)%2,n=e.getEle("#wrap"),s=e.getEle(".page_container",n),o;i&&(0!==s.length?o=e.getEle(".page_num",s[0])[0]:(s=e.createEle("footer",{class:"page_container"},n),o=e.createEle("div",{class:"page_num"},s)),e.hasCls(n,"hide--pagenum")||(o.innerText=parseInt(i)),0===a?(e.addCls(n,"type_left"),e.addCls(s,"left")):(e.addCls(n,"type_right"),e.addCls(s,"right")),n.dataset.infoLesson=t[1]||0,n.dataset.infoPage=parseInt(i)||0,EDUTSS.pageInfo||(EDUTSS.pageInfo={}),EDUTSS.pageInfo&&(EDUTSS.pageInfo.thisPage=[],EDUTSS.pageInfo.thisPage.folder=t[1],EDUTSS.pageInfo.thisPage.pageNum=Number(i)),EDUTSS.isDevMsg&&console.log("#D: 단원 => "+t[1]+", 페이지 번호 => "+i))},pageInfo:function(){if(EDUTSS.pageInfo){let t=EDUTSS.pageInfo,i=t.chapter,a=t.lesson,n=Number(t.thisPage.pageNum),s=document.getElementsByTagName("header")[0],o,l,r,c;if(e.getEle("h1",s).length>0)return;if(n===i.startPage)t.thisPage.lesson=i.title,t.thisPage.lessonNum=i.idx,l=e.createEle("h1",{class:"title chapter"},s,"prepend"),c=e.createEle("span",{class:"txt"},l,"prepend"),(r=e.createEle("span",{class:"num"},l,"prepend")).textContent=t.thisPage.lessonNum,c.innerHTML=t.thisPage.lesson.replace(/\/n/gi,"<br/>");else for(let d=0;d<a.length;d++)if(n>=(o=a[d]).startPage&&n<=o.endPage){t.thisPage.lesson=o.title,t.thisPage.lessonNum=d+1,n===o.startPage&&(l=e.createEle("h1",{class:"title lesson"},s,"prepend"),c=e.createEle("span",{class:"txt"},l,"prepend"),(r=e.createEle("span",{class:"num blind"},l,"prepend")).textContent=t.thisPage.lessonNum,c.innerHTML=t.thisPage.lesson.replace(/\/n/gi,"<br/>"),o.corner&&"soc"===EDUTSS.isSubject)&&(e.createEle("div",{class:"title corner"},s,"prepend").innerHTML=o.corner);break}t.thisPage.lesson&&e.getEle(".chapter--title").forEach(function(i){""===e.getText(i.textContent)&&(i.textContent=t.thisPage.lesson.replace(/\/n/gi," "))}),EDUTSS.isDevMsg&&console.log(t.thisPage)}this.initPageNum(),this.createAssist()},createAssist:function(){let t=EDUTSS.util.getEle(".gif--random--num")||null;t&&t.forEach(function(e){e.src=e.getAttribute("src")+"?"+EDUTSS.util.getRandomNumber(1e4)});let i;(i=e.getEle("input[placeholder]")).length>0&&i.forEach(function(e){EDUTSS.ui.addPlaceholder(e)}),(i=e.getEle("textarea[placeholder]")).length>0&&i.forEach(function(e){EDUTSS.ui.addPlaceholder(e)}),(i=e.getEle(".btn.has--stop")).length>0&&i.forEach(function(t){e.createEle("i",{class:"stop"},t)}),(i=e.getEle("[data-quiz-btn='close-solution']")).length>0&&i.forEach(function(e){if(!e.dataset.quizTarget){let t=e.closest("[data-quiz-solution]");"in"!==t.dataset.quizSolution?e.dataset.quizTarget=t.dataset.quizSolution:(t=e.closest("[data-quiz-id]"),e.dataset.quizTarget=t.dataset.quizId)}}),(i=e.getEle(".btn_wrap.bottom_right.fix, .btn_wrap.bottom_left.fix")).length>0&&EDUTSS.fixBtnBottomPosition&&this.addPositionButton(i),(i=e.getEle(".convert--grayscale")).length>0&&this.convertGrayscale(i),(i=e.getEle("[data-goal-txt]")).length>0&&this.createGoalPopup(i),(i=e.getEle("[data-guide-txt]")).length>0&&this.createGuidePopup(i),(i=e.getEle("[data-create-hide]")).length>0&&this.createShowHide(i),(i=e.getEle("[data-word-text]")).length>0&&this.createWordPopup(i),(i=e.getEle(".toast")).length>0&&(i.forEach(function(t){0===e.getEle(".tail",t).length&&e.createEle("span",{class:"tail"},t)}),EDUTSS.isDevMsg&&console.log("#D: toast 팝업 tail 생성")),(i=e.getEle("[data-layout-type='popup']")).length>0&&(i.forEach(function(t){0===e.getEle("[data-popup-btn='close']",t).length&&e.createEle("button",{type:"button",class:"btn close","data-popup-btn":"close",title:"닫기"},t),e.getEle("[data-layout-type='popup']",t).forEach(function(e){e.setAttribute("data-overlay","true")})}),EDUTSS.isDevMsg&&console.log("#D: popup 닫기 버튼 생성")),(i=e.getEle(".box.input.auto")).length>0&&this.matchInputWidth(i),(i=e.getEle("assessmentItem")).length>0&&(i.forEach(function(t){let i=e.getEle("[data-quiz-type]",t)[0];if(t.dataset.qid||t.setAttribute("data-qid",i.dataset.quizId),!t.dataset.responseType){if("essay"===i.dataset.quizType)t.setAttribute("data-response-type","fillInTheBlank");else if("multiple"===i.dataset.quizType){let a=e.getEle("[data-quiz-answer]",i);a.forEach(function(e){-1!==e.textContent.indexOf("//")?t.setAttribute("data-response-type","multipleChoice"):t.setAttribute("data-response-type","singleChoice")})}else t.setAttribute("data-response-type","etc")}if("sci"==EDUTSS.isSubject&&0===e.getEle(".caliper--description",t).length){let n=e.createEle("span",{class:"caliper--description"},e.getEle("[data-quiz-type]",t)[0]);n.innerText="마무리 문제"+(t.closest("[data-dot-name]")?" "+t.closest("[data-dot-name]").dataset.dotName:"")}}),EDUTSS.isDevMsg&&console.log("#D: assessmentItem 속성 생성")),EDUTSS.ui.checkInputType()},addPlaceholder:function(t){let i=e.createEle("span",{class:"placeholder--text"},t.parentNode);function a(e){i.style.display="none"}i.textContent=t.getAttribute("placeholder"),t.setAttribute("placeholder",""),e.addEvt(t,"click",a),e.addEvt(t,"focus",a),e.addEvt(t,"blur",function e(t){this.value.length>0?i.style.display="none":i.style.display="block"})},addPositionButton:function(t){let i=setInterval(function(){if(0!==e.getEle("#wrap").offsetHeight){parent.ZOOMVALUE&&(EDUTSS.scaleValue.zoom=parent.ZOOMVALUE),clearInterval(i);let a=e.getEle("#wrap").offsetHeight,n=a-EDUTSS.fixBtnBottomPosition,s=EDUTSS.fixBtnBottomPosition,o=0,l;t.forEach(function(t){(l=e.getEle(".btn",t)[0])&&(o=l.offsetHeight,t.children[0].style.height=o+"px"),e.isInDisplay(t)&&""===t.style.top&&""===t.style.bottom&&((s=a-t.getBoundingClientRect().top/EDUTSS.scaleValue.zoom-n)<0?s=Math.abs(s):s*=-1,t.style.bottom=s+o+"px"),e.addCls(t,"has--position"),EDUTSS.isDevMsg&&EDUTSS.isDevMsg&&console.log("#D: 하단 고정 버튼 위치 지정")})}},100);setTimeout(function(){clearInterval(i)},5e3)},convertGrayscale:function(t){t.length||(t=[t]),t.forEach(function(t){let i=e.getEle(".images--grayscale",t)[0],a=e.getEle(".canvas--grayscale",t)[0];if(i&&a){let n=a.getContext("2d"),s=new Image;s.onload=function(){s.crossOrigin="anonymous",n.drawImage(s,0,0,n.canvas.width,n.canvas.height);let e=n.getImageData(0,0,n.canvas.width,n.canvas.height),t=e.data;for(var i=0;i<t.length;i+=4){let a=parseInt((t[i]+t[i+1]+t[i+2])/3);t[i]=a,t[i+1]=a,t[i+2]=a}n.putImageData(e,0,0)},s.src=i.src,EDUTSS.isDevMsg&&console.log("#D: 이미지 그레이스케일 생성")}})},createGoalPopup:function(t){t.forEach(function(t){let i=t.dataset.goalTxt,a=t.dataset.goalCls||"toast down center goal",n=e.createEle("button",{type:"button",title:"학습 목표"},t),s=e.createEle("span",{"data-layout-type":"popup"},t),o=e.createEle("span",{},s),l=e.createEle("p",{},o);e.addCls(s,a),e.addCls(o,"inner"),e.addCls(n,"btn goal"),n.dataset.popup="next",n.innerText="선택",s.dataset.isPosition="true",l.innerText=i,e.hasCls(t,"this_goal")?(n.setAttribute("title","이번 차시를 공부하면"),n.dataset.funcAudio="thisgoal_"+EDUTSS.pageInfo.thisPage.pageNum):e.hasCls(t,"last_goal")&&(n.setAttribute("title","지난 시간에는"),n.dataset.funcAudio="lastgoal_"+EDUTSS.pageInfo.thisPage.pageNum)}),EDUTSS.isDevMsg&&console.log("#D: [data-goal-txt] 생성")},createGuidePopup:function(t){t.forEach(function(t){let i=t.dataset.guideTxt,a=t.dataset.guideCls||"toast up guide",n=e.createEle("button",{type:"button",title:"해설"},t),s=e.createEle("span",{"data-layout-type":"popup"},t),o=e.createEle("span",{},s),l=e.createEle("p",{},o);e.addCls(s,a),e.addCls(o,"inner"),e.addCls(n,"btn guide"),n.dataset.popup="next",n.innerText="선택",l.innerText=i}),EDUTSS.isDevMsg&&console.log("#D: [data-guide-txt] 생성")},createShowHide:function(t){t.forEach(function(t,i){let a=t.innerText,n=t.dataset.createHide;t.innerText="";let s=e.createEle("span",{class:"btn "+n,"data-show-idx":i+1},t);e.createEle("span",{class:"answer","data-show-obj":i+1},s).innerText=a}),EDUTSS.isDevMsg&&console.log("#D: [data-create-hide] 생성")},createWordPopup:function(t){let i,a=0;t.forEach(function(t){t.dataset.popup="inner",i=e.createEle("span",{id:"layerWordPop"+a,class:"toast word","data-layout-type":"popup","data-overlay":"true"},t);let n=e.createEle("span",{class:"inner"},i),s=e.createEle("span",{class:"word_tit"},n),o=e.createEle("span",{class:"word_txt"},n);s.innerHTML=t.textContent,o.innerHTML=t.dataset.wordText.replace(/\/n/gi,"<br/>").replace(/\/b/gi,'<span class="bold">').replace(/\/s/gi,"</span>"),t.dataset.wordEx&&(e.createEle("span",{class:"word_ex"},n).innerHTML=t.dataset.wordEx.replace(/\/n/gi,"<br/>").replace(/\/b/gi,'<span class="bold">').replace(/\/s/gi,"</span>")),t.dataset.wordImg&&e.createEle("img",{class:"word_img",src:t.dataset.wordImg},n),a++,EDUTSS.isDevMsg&&console.log("#D: 단어장 생성 => "+i)})},matchInputWidth:function(t){let i=0;t.forEach(function(t){let a=e.getEle(".quiz--input",t)[0],n;a.nextElementSibling&&(n=a.nextElementSibling),n&&n.dataset.quizAnswer&&(i=e.getText(n.textContent).split("//")[0].length),e.hasCls(a,"spelling")?t.style.width=28*i+"px":n&&""===t.style.width&&!e.hasCls(t,"fix")&&(t.style.width=20*i+"px")}),EDUTSS.isDevMsg&&console.log("#D: .box.input.auto => answer와 input width 글자 수 매칭")},checkInputType:function(){let t=e.getEle(".check--number");function i(e){(e.keyCode<48||e.keyCode>57)&&(e.returnValue=!1)}t.forEach(function(e){e.addEventListener("keypress",i),e.addEventListener("keyup",function(e){this.value=this.value.replace(/[^0-9]/g,"")})})},swipeHorizontal:function(){let t=document.querySelectorAll(".through--box"),i,a;function n(t){let n=t.currentTarget,s=e.getCursorPos(t).x,o=i-s,l=a-o,r=n.parentElement.offsetWidth-n.offsetWidth;n.style.left=l>0?0:l<r?r:l+"px"}function s(t){let i=t.currentTarget;e.removeEvt(i,"pointermove",n),e.removeEvt(i,"pointerup",s)}e.addEvt(t,"pointerdown",function t(o){let l=o.currentTarget;o.preventDefault(),o.stopPropagation(),i=e.getCursorPos(o).x,a=l.offsetLeft,e.addEvt(l,"pointermove",n),e.addEvt(l,"pointerup",s),e.addEvt(l,"pointerleave",s)}),e.addEvt(t,"down",function(e){e.preventDefault(),e.stopPropagation()})},moveFlag:function(){let t=e.getEle(".flag_drag_items")[0],i=t.offsetWidth/2,a=t.parentElement,n=e.getEle(".flag--how--to")[0],s,o,l;function r(n){let s=e.getCursorPos(n).x,r=o-s,c=t.offsetLeft,d=a.lastElementChild.offsetLeft-t.clientWidth/2,u=l-r,h=u>d?d:u<c?c:u,p=e.getEle(".flag_drop_items",a),g=e.getEle(".flag_items");t.style.left=h+"px",p.forEach(function(t,a){h>=t.offsetLeft-i&&(e.addCls(t,"done"),e.removeCls(g[a],"hide"))})}function c(t){e.setStyle(s,{zIndex:0}),e.removeEvt(s,"pointermove",r),e.removeEvt(t.currentTarget,"pointerup",c),e.removeEvt(s,"pointerleave",c)}e.addEvt(t,"pointerdown",function i(d){d.preventDefault(),d.stopPropagation(),e.getEle(".dragArea",a).length||(s=function i(){let n=t.offsetLeft+"px",s=a.lastElementChild.offsetLeft-t.offsetLeft+t.clientWidth+"px",o=t.clientHeight+"px",l=e.createEle("div",{class:"dragArea"},a,!0);return e.setStyle(l,{position:"relative",width:s,height:o,left:n,touchAction:"none"}),l}()),e.setStyle(s,{zIndex:99}),o=e.getCursorPos(d).x,l=t.offsetLeft,e.addEvt(s,"pointermove",r),e.addEvt(s,"pointerup",c),e.addEvt(s,"pointerleave",c),e.addCls(n,"hide")}),e.addEvt(t,"down",function(e){e.preventDefault(),e.stopPropagation()})},initScratchImage:function(){function t(t){this.container=t,this.id=t.dataset.scratchId,this.canvas=e.getEle("canvas",t)[0],this.imgEle=e.getEle("img",t)[0],this.btnClear=e.getEle(".check[data-scratch-target="+this.id+"]")[0],this.btnReplay=e.getEle(".replay[data-scratch-target="+this.id+"]")[0],this.ctx=this.canvas.getContext("2d"),this.img=new Image,this.startPos=null,this.moveHandler=this.drawImage.bind(this),this.leaveHandler=this.endDraw.bind(this),this.pointer=t.dataset.scratchPointer||!1,this.feedback=e.getEle("[data-scratch-feedback="+this.id+"]")[0],this.input=e.getEle("input",this.container)[0],this.multiplyingNum=t.dataset.scratchMultiply,this.textEle=e.getEle(".intxt",t)[0],this.isStore=!t.dataset.scratchOption||!t.dataset.scratchOption.includes("noStore")}return t.prototype.init=function(){e.setStyle(this.canvas,{position:"absolute",left:this.container.clientLeft,top:this.container.clientTop}),this.img.src=this.canvas.dataset.src,this.imgEle.style.opacity=0,this.percent=0,this.textEle&&(this.textEle.style.opacity=0),this.input||(e.getEle(".scratch--content").forEach(function(t,i){e.createEle("input",{id:"saveP"+EDUTSS.pageInfo.thisPage.pageNum+"_scratch_"+i,class:"scratch--save blind"},t)}),this.input=e.getEle("input",this.container)[0]),this.guide||(this.guide=e.createEle("span",{class:"scratch--guide show"},this.container),"none"!==getComputedStyle(this.guide).display||(this.guide.remove(),this.guide=null)),this.img.onload=(function t(){setTimeout((function(){let t=this.imgEle.clientWidth,i=this.imgEle.clientHeight;t&&(this.canvas.width=t,this.canvas.height=i),this.ctx.drawImage(this.img,this.container.clientLeft,this.container.clientTop,this.canvas.width,this.canvas.height),this.imgEle.style.opacity=1,this.textEle&&(this.textEle.style.opacity=1),this.input.value&&(this.getPercent(),this.percent>50&&(e.addCls(this.container,"scratch--complete"),this.clear()),EDUTSS.complete&&EDUTSS.complete.scratch(this.container,this.percent,this))}).bind(this),400)}).bind(this),setTimeout((function(){this.input.value&&(this.img.src=this.input.value)}).bind(this),1e3),this.canvas.addEventListener("pointerdown",(function(t){if(e.hasCls(this.guide,"show")){e.removeCls(this.guide,"show");return}t.preventDefault(),t.stopPropagation(),this.startPos={x:t.offsetX,y:t.offsetY},this.canvas.addEventListener("pointermove",this.moveHandler),this.canvas.addEventListener("pointerup",this.leaveHandler),this.canvas.addEventListener("pointerleave",this.leaveHandler),e.addCls(this.btnReplay,"btn--show"),e.removeCls(this.guide,"show")}).bind(this)),e.addEvt(this.canvas,"down",function(e){e.preventDefault(),e.stopPropagation()}),this.btnClear&&this.btnClear.addEventListener("click",(function(){if(this.feedback&&0===this.percent){EDUTSS.sound.playAudio("empty");let t=e.getEle(".empty",this.feedback);e.addCls(t,"show"),setTimeout(function(){e.removeCls(t,"show")},1500);return}this.clear(),EDUTSS.sound.playAudio("showAnswer")}).bind(this)),this.btnReplay&&this.btnReplay.addEventListener("click",(function(){this.img.src=this.canvas.dataset.src,this.input.value="",e.removeCls(this.container,"scratch--complete"),e.removeCls(this.btnClear,"on disabled"),e.removeCls(this.btnReplay,"btn--show"),e.addCls(this.guide,"show"),EDUTSS.sound.playAudio("click")}).bind(this)),this.container.classList.add("initialized"),e.removeCls(this.btnReplay,"btn--show"),EDUTSS.isMobile||EDUTSS.util.isTouch||!this.pointer||(this.cursorInHandler=this.cursorMove.bind(this),this.cursorOutHandler=this.cursorOut.bind(this),this.canvas.style.cursor="none",this.cursor=e.createEle("span",{class:"scratch--pointer"},this.container),e.addCls(this.cursor,this.pointer),this.canvas.addEventListener("pointermove",this.cursorInHandler),this.canvas.addEventListener("pointerleave",this.cursorOutHandler))},t.prototype.drawImage=function(e){let t=e.offsetX,i=e.offsetY,a=this.multiplyingNum||1;this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(t,i,20*a,0,2*Math.PI),this.ctx.fill(),this.ctx.lineWidth=20*a,this.ctx.beginPath(),this.ctx.moveTo(this.startPos.x,this.startPos.y),this.ctx.lineTo(t,i),this.ctx.stroke(),this.startPos={x:t,y:i},e.preventDefault(),e.stopPropagation()},t.prototype.endDraw=function(){this.canvas.removeEventListener("pointermove",this.moveHandler),this.canvas.removeEventListener("pointerup",this.leaveHandler),this.canvas.removeEventListener("pointerleave",this.leaveHandler),this.getPercent(),this.percent>50&&(e.addCls(this.container,"scratch--complete"),this.clear()),this.isStore&&(this.input.value=this.canvas.toDataURL()),EDUTSS.complete&&EDUTSS.complete.scratch(this.container,this.percent,this)},t.prototype.clear=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),e.addCls(this.btnClear,"on disabled"),e.addCls(this.btnReplay,"btn--show"),e.addCls(this.container,"scratch--complete"),e.removeCls(this.guide,"show"),this.isStore&&(this.input.value=this.canvas.toDataURL())},t.prototype.getPercent=function(){this.pixels=this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height),this.pixelsData=this.pixels.data,this.pixelsLength=this.pixelsData.length,this.pixelsTotal=this.pixelsLength/32,this.pixelsCount=0;for(let e=this.pixelsCount=0;e<this.pixelsLength;e+=32)0===parseInt(this.pixelsData[e])&&this.pixelsCount++;this.percent=Math.round(this.pixelsCount/this.pixelsTotal*100)},t.prototype.cursorMove=function(t){e.addCls(this.cursor,"show"),this.cursor.style.top=t.offsetY+"px",this.cursor.style.left=t.offsetX+"px"},t.prototype.cursorOut=function(){e.removeCls(this.cursor,"show")},t},addSwipe:function(t,i){function a(){this.target=t,this.stage=i,this.downHandler=this.downHandler.bind(this),this.moveHandler=this.moveHandler.bind(this),this.upHandler=this.upHandler.bind(this),this.startPoint={},this.dx=0,this.dy=0}a.prototype.init=function(){e.addEvt(this.target,"pointerdown",this.downHandler),e.addEvt(this.target,"down",function(e){e.preventDefault(),e.stopPropagation()})},a.prototype.downHandler=function(t){let i=t.composedPath&&t.composedPath()||t.path,a=!1;t.currentTarget!==t.target&&!t.target.classList.contains("scroll--content")&&t.target.innerText&&(a=!0),(!i||(i.forEach(function(e){e instanceof Element&&("input"===e.nodeName||"textarea"===e.nodeName||e.classList.contains("quiz--input")||e.classList.contains("media--area")||e.classList.contains("scroll--bar")||e.dataset.quizPointer||e.dataset.funcZoom||e.dataset.funcDrawing||e.dataset.quizBtn)&&(a=!0)}),!a))&&(t.preventDefault(),t.stopPropagation(),this.startPoint=e.getCursorPos(t),e.addEvt(this.target,"pointermove",this.moveHandler),e.addEvt(this.target,"pointerup",this.upHandler))},a.prototype.moveHandler=function(t){let i=e.getCursorPos(t);this.dx=i.x-this.startPoint.x,this.dy=Math.abs(i.y-this.startPoint.y)},a.prototype.upHandler=function(t){let i=180*Math.atan2(this.dy,this.dx)/Math.PI,a=!(this.dx>0);if(this.dx>=15&&i<=20||180-i<=20){let n=t.currentTarget.closest("[data-slide-list]"),s=n.nextElementSibling,o=n.previousElementSibling;this.stage.thisNum=a?s&&e.hasCls(s,"page")?s.dataset.slideList:this.stage.thisNum++:o?o.dataset.slideList:this.stage.thisNum--,Number(this.stage.oldNum)!==Number(this.stage.thisNum)&&(this.stage.oldNum=Number(this.stage.thisNum),EDUTSS.view.moveSlide(this.stage,t),EDUTSS.sound.playAudio("slide"))}this.dx=0,this.dy=0,e.removeEvt(this.target,"pointermove",this.moveHandler),e.removeEvt(this.target,"pointerup",this.upHandler)};let n=new a;n.init()},initInpKeyEvent:function(){e.addEvt(e.getEle("input, textarea"),"blur",function(e){let t=e.currentTarget;EDUTSS.view.limitInputText(t,t.value,t.dataset.max)}),e.addEvt(e.getEle("input, textarea"),"keydown",function(e){let t=e.currentTarget;EDUTSS.view.limitInputText(t,t.value,t.dataset.max)}),e.addEvt(e.getEle("input, textarea"),"keyup",function(t){let i=t.currentTarget,a=i.value,n=e.getText(a);EDUTSS.view.limitInputText(i,a,i.dataset.max),EDUTSS.view.toggleIndivReplay(i,n),"textarea"===i.tagName&&EDUTSS.view.visibleScrollState(i.closest(".scroll_area"))})},initRemoveIndivText:function(){e.addEvt(e.getEle(".input--reset"),"click",function(t){let i=t.currentTarget;EDUTSS.view.removeInpText(i),EDUTSS.view.toggleIndivReplay(i),EDUTSS.view.visibleScrollState(e.getEle(".scroll_area",i.closest(".input_area"))[0])})},videoSyncReflash:function(){console.group("## 자막 싱크 타임 갱신 ##");let t=EDUTSS.videoSyncTimeData;if(!t){console.warn("싱크 데이터 없음!");return}let i=e.getEle("video");i.forEach(function(i){let a=e.getEle("source",i)[0].src.split("/").slice(-1)[0].replace(".mp4",""),n=e.getEle(".synctxt",i.closest(".media--area")),s=t[a];if(!s||s.length!==n.length){console.warn(a+" : 싱크 데이터 확인 필요!");return}n.forEach(function(e,t){let i=s[t],a=i[0],n=i[1];e.dataset.syncS=a.substring(0,2)+":"+a.substring(2),e.dataset.syncE=n.substring(0,2)+":"+n.substring(2)}),console.log(a+" : 싱크 데이터 갱신")}),console.groupEnd("## 자막 싱크 타임 갱신 ##")}}}();var EDUTSS=EDUTSS||{};EDUTSS.isPlayingObject,EDUTSS.sound=function(){let e=EDUTSS.util,t={};return{initAudio:function(){let i,a;i=e.getEle("[data-func-audio]"),e.addEvt(i,"click",function(i){let n=i.composedPath&&i.composedPath()||i.path,s=i.currentTarget;a="./media/audio/"+s.dataset.funcAudio+".mp3",n[0].classList.contains("stop")?(e.removeCls(s,"audio--on"),t[s.dataset.funcAudio].pause(),t[s.dataset.funcAudio].currentTime=0,s.dataset.playTime&&s.removeAttribute("data-play-time"),s.dataset.animateTarget?EDUTSS.animate.animateStop(s.dataset.animateTarget):e.getEle("[data-animate-id]",s).forEach(function(e){EDUTSS.animate.animateStop(e.dataset.animateId)})):e.hasCls(s,"audio--on")?(e.removeCls(s,"audio--on"),s.dataset.playTime=t[s.dataset.funcAudio].currentTime,t[s.dataset.funcAudio].pause()):s.dataset.playTime?(EDUTSS.sound.stopAllSound(),t[s.dataset.funcAudio].src=a,t[s.dataset.funcAudio].currentTime=s.dataset.playTime,t[s.dataset.funcAudio].play(),e.addCls(s,"audio--on")):(t[s.dataset.funcAudio]?t[s.dataset.funcAudio].src=a:t[s.dataset.funcAudio]=e.createAudio(a),EDUTSS.sound.playAudio(s.dataset.funcAudio,this))}),EDUTSS.turnPlayer||(EDUTSS.turnPlayer={}),e.getEle("[data-func-turnplay]").forEach(function(e,t){EDUTSS.sound.turnAudioPlay(e,t)}),EDUTSS.commonEffectAudio.click="none",EDUTSS.commonEffectAudio.popup="none",EDUTSS.commonEffectAudio.tab="none",EDUTSS.commonEffectAudio.close="none",EDUTSS.commonEffectAudio.slide="none",EDUTSS.commonEffectAudio.incorrect="none",EDUTSS.commonEffectAudio.dragtrue="none",EDUTSS.commonEffectAudio.dragfalse="none"},playAudio:function(i,a){let n,s;if(a&&"object"==typeof a&&e.hasCls(a,"audio--on")){e.removeCls(a,"audio--on"),"string"==typeof i&&(t.isPlaying=!1),this.stopAllSound(),EDUTSS.complete&&EDUTSS.complete.sound(a,"[soundStop]");return}("string"!=typeof i||a||"none"!==EDUTSS.commonEffectAudio[i])&&(EDUTSS.commonEffectAudio[i]?this.stopAudio():this.stopAllSound(),"string"==typeof i?(t[i]?"ios"===EDUTSS.isDevice&&t[i].load():EDUTSS.commonEffectAudio[i]&&(t[i]=e.createAudio(EDUTSS.commonEffectAudio[i]+".mp3")),n=t[i],"object"==typeof a&&(EDUTSS.animate.stopAllAnimate(),e.addCls(a,"audio--on play--done"),EDUTSS.isDevMsg&&console.log("#D: 말풍선 찾기 : obj의 parentNode가 .bubble이거나, obj의 parentNode의 자식중 .bubble가 있거나, data-bubble-target='대상'로 id를 명시했을 경우"),(s=a.dataset.bubbleTarget?e.getEle("#"+a.dataset.bubbleTarget):e.hasCls(a.parentNode,"bubble")?s=[a.parentNode]:e.getEle(".bubble",a.parentNode))&&s.length>0&&s.forEach(function(t){e.hasCls(t,"bubble--show")||(e.addCls(t,"animated"),e.addCls(t,"bubble--show"),setTimeout(function(){e.removeCls(t,"animated")},500)),e.hasCls(t,"bubble--show")||e.addCls(t,"bubble--show"),EDUTSS.isDevMsg&&console.log("#D: 말풍선 등장 => [data-func-audio] > parentNode > .bubble > add cls bubble--show")}),a.dataset.animateTarget?EDUTSS.animate.animatePlay(a.dataset.animateTarget):(EDUTSS.isDevMsg&&console.log("#D: 애니메이션 찾기, obj의 data-animate-id 값이 있을 경우"),e.getEle("[data-animate-id]",a).forEach(function(e){EDUTSS.animate.animatePlay(e.dataset.animateId),EDUTSS.isDevMsg&&console.log("#D: 애니메이션 재생, [data-animate-id] : "+e.dataset.animateId)})),EDUTSS.isDevMsg&&console.log("#D: 음성 재생"))):(e.addCls(i,"audio--on"),n=0===(n=e.getEle("audio",i)).length?e.createEle("audio",{src:a,type:"audio/mpeg",preload:"auto"},i):n[0]),n&&(n.play(),"string"==typeof i&&(t.isPlaying=i),a&&"object"==typeof a&&EDUTSS.complete&&EDUTSS.complete.sound(a,"[soundPlay]"),n.onended=function(){"object"==typeof a&&(e.removeCls(a,"audio--on"),a.dataset.playTime&&a.removeAttribute("data-play-time"),a.dataset.animateTarget?EDUTSS.animate.animateStop(a.dataset.animateTarget):e.getEle("[data-animate-id]",a).forEach(function(e){EDUTSS.animate.animateStop(e.dataset.animateId)}),s&&(s.length>0&&e.addCls(s,"bubble--complete"),e.removeCls(s,"bubble--show")),EDUTSS.complete&&EDUTSS.complete.sound(a,"[soundEnd]"),EDUTSS.isDevMsg&&console.log("#D: 음성 완료")),"string"==typeof i&&(t.isPlaying=!1),"string"!=typeof i&&e.removeCls(i,"audio--on")}))},stopActiveSound:function(){this.stopAudio(),EDUTSS.isPlayingObject&&("player"===EDUTSS.isPlayingObject[0]?EDUTSS.isPlayingObject[1].mediaPause():"turn"===EDUTSS.isPlayingObject[0]&&EDUTSS.isPlayingObject[1].pause())},stopCurrentSound:function(t){this.stopAudio(),t&&(t.length||(t=[t]),t.forEach(function(t){e.getEle("[data-media-control]",t).forEach(function(e){for(let t in EDUTSS.mediaPlayer)EDUTSS.mediaPlayer[t].mediaId===e.dataset.mediaId&&EDUTSS.mediaPlayer[t].mediaStop()}),e.getEle("[data-func-turnplay]",t).forEach(function(e){for(let t in EDUTSS.turnPlayer)EDUTSS.turnPlayer[t].turnplayId===e.dataset.turnplayId&&EDUTSS.turnPlayer[t].stop()})}))},stopAudio:function(){let i;for(i in t)"object"==typeof t[i]&&0!==t[i].currentTime&&(t[i].pause(),t[i].currentTime=0);t.isPlaying=!1,e.getEle(".audio--on").forEach(function(t){t.dataset.turnIdx||e.removeCls(t,"audio--on")})},stopAllSound:function(i,a,n){let s=e.getEle("audio"),o,l,r;for(s&&(o=s.length),r=0;r<o;r++)l=s[r],e.hasCls(l.parentNode,"media--area")||0===l.currentTime||(l.currentTime=0,l.pause());if(this.stopAudio(),t.isPlaying=!1,e.removeCls(e.getEle(".audio--on"),"audio--on"),EDUTSS.animate.stopAllAnimate(),n){for(r in EDUTSS.turnPlayer)EDUTSS.turnPlayer[r].turnplayId!==a&&EDUTSS.turnPlayer[r].pause();for(r in EDUTSS.mediaPlayer)EDUTSS.mediaPlayer[r].mediaId!==a&&EDUTSS.mediaPlayer[r].mediaPause()}else{for(r in EDUTSS.turnPlayer)"turnPlayer"===i?EDUTSS.turnPlayer[r].pause(a):EDUTSS.turnPlayer[r].stop();for(r in EDUTSS.mediaPlayer)"mediaPlayer"===i?EDUTSS.mediaPlayer[r].mediaAllStop(a):EDUTSS.mediaPlayer[r].mediaAllStop()}},turnAudioPlay:function(t,i){function a(t){this.container=t,this.turnplayId="turnplay-"+e.isNum(i),this.turnEle=e.getEle("[data-turn-idx]",this.container),this.turnLen=this.turnEle.length,this.turnBtn=e.getEle("[data-turn-btn]",this.container)[0],this.mediaArr=this.turnBtn.dataset.turnAudio.split("//"),this.bubbleKeep=e.hasCls(this.container,"keep--bubble")||!1,this.turnDelay=0,this.turnIdx=0,this.currentBubble,this.prevBubble,this.audio,this.playTime,this.animate}a.prototype={init:function(){let t=this;t.container.dataset.turnplayId=t.turnplayId,t.container.dataset.isPlaying="stop",t.turnBtn.dataset.turnDelay&&(t.turnDelay=t.turnBtn.dataset.turnDelay),t.container.dataset.animateTarget&&(t.animate=t.container.dataset.animateTarget),t.turnEle.forEach(function(e,i){e.dataset.funcAudio=t.mediaArr[i]+".mp3"}),t.audio=e.getEle("audio",t.container),0===t.audio.length?t.audio=e.createEle("audio",{class:"blind",src:"./media/audio/"+t.mediaArr[t.turnIdx]+".mp3",type:"audio/mpeg",preload:"auto"},t.container):(t.audio=t.audio[0],t.audio.src="./media/audio/"+t.mediaArr[t.turnIdx]+".mp3"),e.addEvt(t.turnBtn,"click",t.playType.bind(t))},playType:function(e){let t=e.composedPath&&e.composedPath()||e.path;t[0].classList.contains("stop")?this.stop():"play"===this.container.dataset.isPlaying?(this.pause(),this.turnAniStop("isPause")):(this.play(),EDUTSS.isPlayingObject=["turn",this])},play:function(){EDUTSS.sound.stopAllSound("turnPlayer",this.turnplayId,"isPause"),this.playTime&&(this.audio.currentTime=this.playTime),this.audio.play(),this.container.dataset.isPlaying="play",0===this.turnIdx&&e.removeCls(e.getEle(".bubble--show",this.container),"bubble--show"),e.removeCls(this.turnEle,"audio--on"),e.addCls(this.turnEle[this.turnIdx],"audio--on play--done"),e.addCls(this.turnBtn,"on"),e.addCls(this.container,"turn--play viewed--turn"),this.turnAniPlay(),this.nextPlay(),EDUTSS.isDevMsg&&console.log("#D: 순차 오디오 재생 => "+turnIdx),EDUTSS.complete&&EDUTSS.complete.turnAudio(this.container,"[turnStart]",this.turnIdx)},nextPlay:function(){let t=this;this.audio.onended=function(){t.turnIdx++,t.turnIdx<t.turnLen?(t.audio.src="./media/audio/"+t.mediaArr[t.turnIdx]+".mp3",e.removeCls(t.turnEle[t.turnIdx-1],"audio--on"),t.prevBubble=e.getEle(".bubble",t.turnEle[t.turnIdx-1]),t.prevBubble&&(t.bubbleKeep?e.addCls(t.prevBubble,"bubble--keep"):e.removeCls(t.prevBubble,"bubble--show")),"sci"===EDUTSS.isSubject&&EDUTSS.util.hasCls(t.turnEle[t.turnIdx],"auto")&&$(".turn--play").find(".move--slider .dot[data-slide-dot="+t.turnIdx+"]").trigger("click"),t.animate||e.getEle("[data-animate-id]",t.turnEle[t.turnIdx-1]).forEach(function(e){EDUTSS.animate.animateStop(e.dataset.animateId)}),e.addCls(t.turnEle[t.turnIdx],"audio--on play--done"),t.turnDelay?setTimeout(function(){t.turnAniPlay(),t.audio.play(),t.playTime=0},t.turnDelay):(t.turnAniPlay(),t.audio.play(),t.playTime=0),EDUTSS.isDevMsg&&console.log("#D: 순차 오디오 다음 => "+t.turnIdx),EDUTSS.complete&&EDUTSS.complete.turnAudio(t.container,"[turnNext]",t.turnIdx)):(t.stop(),e.addCls(t.container,"turn--complete"),EDUTSS.isDevMsg&&console.log("#D: 순차 오디오 종료"),EDUTSS.complete&&EDUTSS.complete.turnAudio(t.container,"[turnEnd]",t.turnIdx))}},pause:function(){this.playTime=this.audio.currentTime,this.audio.pause(),e.removeCls(this.turnBtn,"on"),this.container.dataset.isPlaying="pause"},stop:function(){this.turnIdx=0,this.playTime=0,this.audio.pause(),this.audio.src="./media/audio/"+this.mediaArr[0]+".mp3",this.audio.currentTime=0,this.currentBubble=e.getEle(".bubble",this.container),this.currentBubble&&(this.bubbleKeep||e.removeCls(this.currentBubble,"bubble--show")),e.removeCls(this.turnBtn,"on is--play"),e.removeCls(this.turnEle,"audio--on"),e.removeCls(this.container,"turn--play"),this.turnAniStop(),"sci"===EDUTSS.isSubject&&$(".turn--play").find(".move--slider .dot[data-slide-dot=0]").trigger("click"),this.container.dataset.isPlaying="stop",EDUTSS.isPlayingObject=null},turnAniPlay:function(){this.turnEle[this.turnIdx]&&e.getEle(".bubble",this.turnEle[this.turnIdx]).forEach(function(t){e.hasCls(t,"bubble--show")||(e.addCls(t,"animated"),e.addCls(t,"bubble--show"),setTimeout(function(){e.removeCls(t,"animated")},500)),e.hasCls(t,"bubble--show")||e.addCls(t,"bubble--show")}),this.animate?EDUTSS.animate.animatePlay(this.animate):e.getEle("[data-animate-id]",this.turnEle[this.turnIdx]).forEach(function(e){EDUTSS.animate.animatePlay(e.dataset.animateId)})},turnAniStop:function(t){if(this.animate)EDUTSS.animate.stopAllAnimate();else{let i;(i=t?this.turnEle[this.turnIdx]:this.container)&&e.getEle("[data-animate-id]",i).forEach(function(e){EDUTSS.animate.animateStop(e.dataset.animateId)})}},turnfuncAudioPlay:function(t,i){e.hasCls(t,"play--done")&&(this.turnIdx!==i&&(this.turnIdx=i,this.playTime=0,this.audio.src="./media/audio/"+this.mediaArr[this.turnIdx]+".mp3"),"play"===this.container.dataset.isPlaying?(this.pause(),this.turnAniStop("isPause")):(this.play(),EDUTSS.isPlayingObject=["turn",this]))}},EDUTSS.turnPlayer[i]=new a(t),EDUTSS.turnPlayer[i].init()}}}(),EDUTSS.player=function(){let e=EDUTSS.util;return{initMediaPlayer:function(t){function i(e,i,a,n){function s(e){return e<10?"0"+e:e.toString()}this.container=e,this.mediaInner=e.querySelectorAll(".media--inner")[0],this.type=i,this.media=a,this.mediaId="mediaPlayer"+(n<10?"0"+n:n.toString()),this.btnOnly=!1,this.isVolume=t.volume||!1,this.isCaption=!1,this.isCaptionOn=!1,this.isCaptionView=!1,this.captionHeight=e.dataset.captionHeight||EDUTSS.videoCaptionHeight,this.isImportCaption=!0,this.isRealTimeCaption=!1,this.isCover=t.cover||!1,this.isCoverPause=t.coverPause||!0,this.isCloseBtn=t.close||!1,this.fullscreenMode=t.fullScreenMode||"native",this.autoPlay=!1,this.isPlay=!1,this.isTitle=t.mediaTitle||!1,this.isPreLoad=t.preLoad||!1,this.isHiddenControls=t.hiddenControls||!1,this.defaultVolume=t.defaultVolume||1,this.defaultVolumeWidth=t.defaultVolumeWidth||50,this.syncUpdateInterval,this.controlsVisibleTimer,this.titleVisibleTimer,this.playerResizeHandler=this.resizePlayer.bind(this),this.isHiddenControls&&(this.visibleControlsHandler=this.controlShowClass.bind(this),this.hiddenControlsHandler=this.controlHideClass.bind(this)),this.isCoverPause&&(this.coverEventHandler=this.coverOverHandler.bind(this)),Object.defineProperties(this,{duration:{get:function(){return this.media.duration}},durationText:{get:function(){return s(Math.floor(this.duration/60))+":"+s(Math.floor(this.duration%60))}},playTime:{get:function(){return this.media.currentTime},set:function(e){this.media.currentTime=e}},currentText:{get:function(){return s(Math.floor(this.playTime/60))+":"+s(Math.floor(this.playTime%60))}},timeRate:{get:function(){return this.playTime/this.duration}},barSize:{get:function(){return this.barRail.getBoundingClientRect()}},barWidth:{get:function(){return this.barSize.right-this.barSize.left}},volume:{get:function(){return this.media.volume},set:function(e){this.media.volume=e}},volumeSize:{get:function(){return this.isVolume&&this.volumeRail.getBoundingClientRect()}},volumeWidth:{get:function(){let e;return this.isVolume&&0==(e=this.volumeSize.right-this.volumeSize.left)&&(e=this.defaultVolumeWidth),this.isVolume&&e}},coord:{get:function(){return this.coordX,this.coordY},set:function(e){this.coordX=e.touches?e.touches[0].clientX:e.clientX,this.coordY=e.touches?e.touches[0].clientY:e.clientY}},isFullscreen:{get:function(){return document.fullscreenElement||document.msFullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}}})}i.prototype={init:function(){let t=this;e.hasCls(this.container,"only")&&(this.btnOnly=!0),e.hasCls(this.container,"is--caption")&&(this.isCaption=!0),e.hasCls(this.container,"not--dbclick")&&(this.isNotdblClick=!0),this.create(),this.container.dataset.mediaId=this.mediaId,"audio"===this.type&&e.addCls(e.getEle(".progress--bar",this.container),"hide"),this.addEvt(),this.mediaReady(),e.hasCls(this.container,"is--caption--view")&&(this.isCaptionView=!0),this.isVolume&&(this.setVolume(this.defaultVolume),this.updateVolumeBar()),this.isCaption?this.isCaptionView&&this.captionBtn.click():this.captionHeight=0,e.getEle("[data-layout-type='scroll']",t.captionContainer).forEach(function(e){t.captionScrollContent=e})},create:function(){return this.control=e.createEle("div",{class:"media--controller"},this.mediaInner),this.playBtn=e.createEle("div",{class:"btn play",title:"재생"},this.control),this.pauseBtn=e.createEle("div",{class:"btn pause on",title:"일시 정지"},this.control),this.stopBtn=e.createEle("div",{class:"btn stop",title:"정지"},this.control),this.btnOnly||(this.controlBar=e.createEle("div",{class:"progress--bar"},this.control),this.barRail=e.createEle("div",{class:"progress rail"},this.controlBar),this.barActive=e.createEle("div",{class:"progress current"},this.controlBar),this.barHandler=e.createEle("div",{class:"progress handle"},this.controlBar),this.controlTime=e.createEle("div",{class:"time--text"},this.control),this.current=e.createEle("div",{class:"time current"},this.controlTime),this.total=e.createEle("div",{class:"time total"},this.controlTime)),!this.btnOnly&&this.isVolume&&(this.muteBtn=e.createEle("div",{class:"btn mute",title:"음소거"},this.control),this.volumeBar=e.createEle("div",{class:"volume--bar"},this.control),this.volumeRail=e.createEle("div",{class:"volume rail"},this.volumeBar),this.volumeActive=e.createEle("div",{class:"volume current"},this.volumeBar),this.volumeHandler=e.createEle("div",{class:"volume handle"},this.volumeBar)),"video"===this.type&&this.isCover&&(this.thumbContainer=e.createEle("div",{class:"thumb--area"},this.mediaInner),this.coverImg=e.createEle("div",{class:"img cover"},this.thumbContainer),this.coverBtn=e.createEle("div",{class:"btn play"},this.thumbContainer)),"video"===this.type&&(this.fullScreenBtn=e.createEle("div",{class:"btn fullScreen",title:"전체 화면"},this.control)),"video"===this.type&&this.isCaption&&(this.captionBtn=e.createEle("div",{class:"btn caption",title:"자막"},this.control),0===this.container.querySelectorAll(".caption--inner").length?(this.captionContainer=e.createEle("div",{class:"caption--area script"},this.mediaInner),this.captionTxt=e.createEle("p",{class:"txt"},this.captionContainer),this.isImportCaption=!0):(this.captionContainer=e.getEle(".caption--inner",this.container)[0],this.isImportCaption=!1)),"video"===this.type&&this.isCloseBtn&&(this.closeBtn=e.createEle("div",{class:"btn close",title:"닫기"},this.container)),"video"===this.type&&this.isTitle&&(this.mediaTitle=e.createEle("div",{class:"media_title"},this.mediaInner),this.mediaTitleTxt=e.createEle("p",{},this.mediaTitle)),this},addEvt:function(){let t=this;this.isPreLoad&&e.addEvt(this.container,"down",this.mediaLoad.bind(this),{capture:!0}),e.addEvt(this.playBtn,"click",this.mediaPlay.bind(this),{capture:!0}),e.addEvt(this.pauseBtn,"click",this.mediaPause.bind(this),{capture:!0}),e.addEvt(this.stopBtn,"click",this.mediaStop.bind(this),{capture:!0}),!this.btnOnly&&(e.addEvt(this.barRail,"click",this.clickBarHandle.bind(this),{capture:!0}),e.addEvt(this.barActive,"click",this.clickBarHandle.bind(this),{capture:!0}),e.addEvt(this.barHandler,"down",this.dragBarHandle.bind(this),{capture:!0}),this.isVolume&&(e.addEvt(this.muteBtn,"click",this.mediaMute.bind(this),{capture:!0}),e.addEvt(this.volumeRail,"click",this.clickBarHandle.bind(this),{capture:!0}),e.addEvt(this.volumeActive,"click",this.clickBarHandle.bind(this),{capture:!0}),e.addEvt(this.volumeHandler,"down",this.dragBarHandle.bind(this),{capture:!0}))),"video"===this.type&&(this.isNotdblClick||e.addEvt(this.thumbContainer,"dblclick",this.mediaFullScreen.bind(this),{capture:!0}),e.addEvt(this.fullScreenBtn,"click",this.mediaFullScreen.bind(this),{capture:!0}),document.addEventListener("fullscreenchange",this.fullScreenHandler.bind(this)),document.addEventListener("webkitfullscreenchange",this.fullScreenHandler.bind(this)),document.addEventListener("mozfullscreenchange",this.fullScreenHandler.bind(this)),document.addEventListener("MSFullscreenChange",this.fullScreenHandler.bind(this)),this.isCover&&e.addEvt(this.coverBtn,"click",this.mediaCoverPlay.bind(this),{capture:!0}),this.isTitle&&(this.mediaInner.addEventListener("mousemove",this.titleOverHandler.bind(this),{capture:!0}),this.mediaInner.addEventListener("touchstart",this.titleOverHandler.bind(this),{capture:!0}),this.mediaInner.addEventListener("mouseleave",this.titleOverHandler.bind(this),{capture:!0}))),this.isCloseBtn&&e.addEvt(this.closeBtn,"click",this.mediaStop.bind(this),{capture:!0}),t.isCaption&&!t.isImportCaption&&e.addEvt(t.captionBtn,"click",function(){t.isCaptionOn?(t.isCaptionOn=!1,e.removeCls(t.captionBtn,"on"),e.removeCls(t.captionContainer,"caption--show"),t.isFullscreen&&t.resizePlayer(),t.isRealTimeCaption&&clearInterval(t.syncUpdateInterval),EDUTSS.isDevMsg&&console.log("#D: video 자막 닫기")):(t.isCaptionOn=!0,e.addCls(t.captionBtn,"on"),e.addCls(t.captionContainer,"caption--show"),t.isFullscreen&&t.resizePlayer(),t.isRealTimeCaption&&(clearInterval(t.syncUpdateInterval),t.isPlay&&t.innerCaptionSync()),t.captionScrollContent&&EDUTSS.view.visibleScrollState(t.captionScrollContent),EDUTSS.isDevMsg&&console.log("#D: video 자막 열기"))}),this.media.addEventListener("play",function(){t.isPlay=!0,t.isBtnState("play"),t.isPlaying(),EDUTSS.complete&&EDUTSS.complete.mediaPlayer(t,"play")}),this.media.addEventListener("pause",function(){t.isPlay=!1,t.isBtnState("pause"),e.removeCls(t.container,"is--playing"),clearInterval(t.mediaUpdate),t.isCaptionOn&&t.isRealTimeCaption&&!t.isImportCaption&&clearInterval(t.syncUpdateInterval),EDUTSS.complete&&EDUTSS.complete.mediaPlayer(t,"pause")}),this.media.addEventListener("ended",function(){t.isPlay=!1,t.mediaStop(),EDUTSS.complete&&EDUTSS.complete.mediaPlayer(t,"end")}),"ios"===EDUTSS.isDevice&&this.media.addEventListener("webkitfullscreenchange",function(){!document.webkitIsFullScreen&&t.media.paused&&(t.isPlay=!1,t.isBtnState("pause"))},!1)},mediaLoad:function(){this.media.readyState||(this.media.load(),this.media.play(),this.media.pause())},mediaReady:function(){let t=this;if(t.current.innerText="00:00",t.total.innerText=t.container.dataset.totalTime||"00:00",t.controlTime.style.opacity="1","video"===t.type&&t.isCover){var i=t.media.getAttribute("poster");t.coverImg.style.backgroundImage="url("+i+")"}!t.isImportCaption&&e.getEle("[data-sync-s]",t.container).length>0&&(t.isRealTimeCaption=!0),e.addCls(t.playBtn,"off"),e.addCls(t.pauseBtn,"on");let a=setInterval(function(){t.media.readyState&&(clearInterval(a),t.controlTime.style.opacity="1",t.mediaDuration=t.media.duration,t.btnOnly||(t.total.innerText=t.durationText,t.updateTimer()),!t.btnOnly&&t.isVolume&&t.updateVolumeBar(),t.isBtnState(),"video"===t.type&&t.isCover&&(t.videoWidth=e.getStyle(t.media).width,t.videoHeight=e.getStyle(t.media).height,t.thumbContainer.style.width=t.videoWidth,t.thumbContainer.style.height=t.videoHeight,setTimeout(function(){if("video"===t.type&&t.isCover&&EDUTSS.isDTBOOK){let e=setInterval(function(){0!==t.media.offsetHeight&&(t.videoWidth=t.media.offsetWidth+"px",t.videoHeight=t.media.offsetHeight+"px",t.thumbContainer.style.width=t.videoWidth,t.thumbContainer.style.height=t.videoHeight,clearInterval(e),EDUTSS.isDevMsg&&console.log("#D: 쎔네일 사이즈 => "+t.videoWidth+", "+t.videoHeight))})}},500)),this.isTitle&&this.mediaTitle&&(this.mediaTitleTxt.innerText=mediaTitle,e.addCls(this.mediaTitle,"show"),t.titleVisibleTimer=setTimeout(function(){e.removeCls(t.mediaTitle,"show")},2e3)),t.isCaption&&t.isImportCaption&&(t.getCaptionData(),EDUTSS.player.initMediaCaption(t)),t.reservationPlaying&&(t.mediaPlay(),t.reservationPlaying=!1))})},mediaPlay:function(){EDUTSS.sound.stopAllSound("mediaPlayer",this.mediaId,"isPause"),this.media.readyState?(this.isVolume&&this.updateVolumeBar(),this.media.currentTime=this.playTime,this.media.play(),EDUTSS.isPlayingObject=["player",this]):this.reservationPlaying=!0},mediaPause:function(){this.media.pause(),"video"===this.type&&this.media.readyState&&this.bindCoverEvent(!1)},mediaStop:function(){this.mediaDuration&&(this.media.pause(),this.changeTime(0),EDUTSS.isPlayingObject=null,this.current.innerText="00:00",this.barHandler.style.left="0px",this.barActive.style.width="0px",this.isCaptionOn&&this.isRealTimeCaption&&!this.isImportCaption&&this.innerCaptionSync("reset"),"video"===this.type&&this.media.readyState&&(e.removeCls(this.coverImg,"hide"),this.bindCoverEvent(!1)))},mediaCoverPlay:function(){this.isPlay?this.mediaPause():this.mediaPlay()},isPlaying:function(){let t=this;e.addCls(this.container,"is--playing"),t.mediaUpdate=setInterval((function(){t.btnOnly||t.updateTimer(),t.btnOnly||t.updateBar()}).bind(this),100),t.isCaptionOn&&t.isRealTimeCaption&&!t.isImportCaption&&t.innerCaptionSync(),"video"===this.type&&this.media.readyState&&(e.addCls(this.coverImg,"hide"),this.bindCoverEvent(!0))},isBtnState:function(t){"play"===t?(e.addCls(this.playBtn,"on"),e.addCls(this.pauseBtn,"off"),e.removeCls(this.playBtn,"off"),e.removeCls(this.pauseBtn,"on"),e.addCls(this.coverBtn,"pause"),e.removeCls(this.coverBtn,"play")):(e.removeCls(this.playBtn,"on"),e.removeCls(this.pauseBtn,"off"),e.addCls(this.playBtn,"off"),e.addCls(this.pauseBtn,"on"),e.addCls(this.coverBtn,"play"),e.removeCls(this.coverBtn,"pause"))},clickBarHandle:function(e,t){if(!this.mediaDuration){let i=this,a=e.currentTarget.className.split(" ")[0],n=e,s=setInterval(function(){i.mediaDuration&&(clearInterval(s),i.clickBarHandle(n,a))});return}this.coord=e;let o=e.currentTarget?e.currentTarget.className.split(" ")[0]:t,l=this.getBarValue(this.coordX,o);"progress"===o?(this.changeTime(l),this.isCaption&&this.isCaptionOn&&this.isImportCaption&&this.captionFs.getCaptionTxt()):"volume"===o&&(this.setVolume(l),this.updateVolumeBar())},dragBarHandle:function(t,i){if(t.preventDefault(),t.stopPropagation(),!this.mediaDuration){let a=this,n=t.currentTarget.className.split(" ")[0],s=t,o=setInterval(function(){a.mediaDuration&&(clearInterval(o),a.dragBarHandle(s,n))});return}let l=this,r=(function e(t){l.coord=t;let i,a;t.preventDefault(),t.stopPropagation(),"progress"===c?(i=l.coordX-l.barSize.left)>0&&i<l.barSize.width&&(a=l.getBarValue(l.coordX,c),l.changeTime(a),l.isCaption&&l.isCaptionOn&&l.isImportCaption&&l.captionFs.getCaptionTxt()):"volume"===c&&(i=l.coordX-l.volumeSize.left)>0&&i<=l.volumeSize.width&&(a=l.getBarValue(l.coordX,c),l.setVolume(a))}).bind(this),c=t.currentTarget?t.currentTarget.className.split(" ")[0]:i;e.addEvt(document,"move",r),e.addEvt(document,"up",function(){e.removeEvt(document,"move",r)}),EDUTSS.view.senseClosePopupEvent(t)},getBarValue:function(e,t){return"progress"===t?(e-this.barSize.left)/this.barWidth:"volume"===t?parseFloat((e-this.volumeSize.left)/this.volumeWidth).toFixed(1):void 0},changeTime:function(t){let i=t*this.mediaDuration;i>=this.mediaDuration&&(i=this.mediaDuration-.05),i<=0&&(i=0),this.playTime=i,this.btnOnly||this.updateTimer(),this.btnOnly||this.updateBar(),"video"===this.type&&(e.addCls(this.coverImg,"hide"),e.addCls(this.coverBtn,"hide")),this.isCaptionOn&&this.isRealTimeCaption&&!this.isImportCaption&&this.innerCaptionSync("once")},updateTimer:function(){this.current.innerText=this.playTime<=0?"00:00":this.currentText},updateBar:function(){let e=this.isFullscreen?this.barWidth*this.timeRate:this.barWidth/EDUTSS.scaleValue.zoom*this.timeRate;this.barHandler.style.left=e+"px",this.barActive.style.width=e+"px"},updateVolumeBar:function(){let e=this.isFullscreen?this.volumeWidth*this.media.volume:this.volumeWidth/EDUTSS.scaleValue.zoom*this.media.volume;this.volumeHandler.style.left=e+"px",this.volumeActive.style.width=e+"px"},setVolume:function(e){this.media.muted=!0,e<=0?(e=0,this.media.muted=!1):e>=1&&(e=1),this.volume=e,this.mediaMute(),EDUTSS.isDevMsg&&console.log("#D: 볼륨 : "+this.volume)},mediaMute:function(){this.media.muted?(this.media.muted=!1,e.removeCls(this.muteBtn,"on"),this.updateVolumeBar()):(this.media.muted=!0,e.addCls(this.muteBtn,"on"),this.volumeHandler.style.left=null,this.volumeActive.style.width=null)},mediaFullScreen:function(){if("ios"===EDUTSS.isDevice){e.addCls(this.container,"is--controls"),this.media.webkitEnterFullScreen();return}if(this.isFullscreen)document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),this.isHiddenControls&&this.controlOverHandler(!1);else{let t=this;if(!t.media.readyState){setTimeout(function(){t.mediaFullScreen()},100);return}this.videoWidth=this.media.offsetWidth+"px",this.videoHeight=this.media.offsetHeight+"px",this.container.requestFullscreen?this.container.requestFullscreen():this.container.msRequestFullscreen?this.container.msRequestFullscreen():this.container.mozRequestFullScreen?this.container.mozRequestFullScreen():this.container.webkitRequestFullscreen&&this.container.webkitRequestFullscreen(),this.isHiddenControls&&this.controlOverHandler(!0)}},fullScreenHandler:function(){this.media.readyState&&(this.isFullscreen?(e.addCls(this.container,"is--fullscreen"),e.addCls(this.fullScreenBtn,"on"),this.resizeInner(),this.updateBar(),this.captionBtn&&!this.isRealTimeCaption&&(e.addCls(this.captionBtn,"disabled"),this.captionContainer.style.display="none"),window.addEventListener("resize",this.playerResizeHandler)):(e.removeCls(this.container,"is--controls"),e.removeCls(this.container,"is--fullscreen"),e.removeCls(this.fullScreenBtn,"on"),this.media.style.width=null,this.media.style.height=null,this.thumbContainer.style.width=null,this.thumbContainer.style.height=null,this.mediaInner.style.marginTop=null,this.control.style.bottom=null,this.isCaption&&(this.captionContainer.style.bottom=null,this.captionContainer.style.height=null),clearInterval(this.positionInterval),this.updateBar(),this.captionBtn&&!this.isRealTimeCaption&&(e.removeCls(this.captionBtn,"disabled"),this.captionContainer.style.display=null),this.captionScrollContent&&EDUTSS.view.visibleScrollState(this.captionScrollContent),window.removeEventListener("resize",this.playerResizeHandler)))},resizeInner:function(){let e=this;setTimeout(function(){e.media.style.width="100%",e.media.style.height="auto",e.thumbContainer.style.width="100%",e.thumbContainer.style.height="100%",!e.isHiddenControls&&e.mediaInner&&e.resizePlayer()},50)},resizePlayer:function(){this.mediaInner.style.height=null,window.innerHeight<=this.mediaInner.clientHeight+this.control.offsetHeight+("sci"===EDUTSS.isSubject?0:this.captionHeight)?(this.mediaInner.style.height="100%",this.mediaInner.style.marginTop="0px",this.control.style.bottom="0px",this.thumbContainer.style.width="100%","none"===EDUTSS.isSubject?this.isCaptionOn&&(this.captionHeight=.12*this.media.offsetHeight-this.control.offsetHeight,this.captionContainer.style.bottom=this.control.offsetHeight+"px",this.captionContainer.style.height=this.captionHeight+"px"):this.isCaptionOn?(this.thumbContainer.style.height="calc(100% - "+(this.control.offsetHeight+this.captionHeight)+"px)",this.media.style.height="calc(100% - "+(this.control.offsetHeight+this.captionHeight)+"px)",this.captionContainer.style.bottom=this.control.offsetHeight+"px",this.captionContainer.style.height=this.captionHeight+"px"):(this.thumbContainer.style.height="calc(100% - "+this.control.offsetHeight+"px)",this.media.style.height="calc(100% - "+this.control.offsetHeight+"px)")):(this.mediaInner.style.height=null,this.thumbContainer.style.width=this.media.offsetWidth+"px",this.thumbContainer.style.height=this.media.offsetHeight+"px","none"===EDUTSS.isSubject?this.isCaptionOn?(this.mediaInner.style.marginTop="-"+this.control.offsetHeight/2+"px",this.control.style.bottom="-"+this.control.offsetHeight+"px",this.captionContainer.style.bottom=(window.innerHeight-(this.mediaInner.offsetHeight+this.control.offsetHeight))/2+this.control.offsetHeight+"px",this.captionContainer.style.height=.12*this.media.offsetHeight+"px"):(this.mediaInner.style.marginTop="-"+this.control.offsetHeight/2+"px",this.control.style.bottom="-"+this.control.offsetHeight+"px"):this.isCaptionOn?(this.mediaInner.style.marginTop="-"+(this.control.offsetHeight+this.captionHeight)/2+"px",this.control.style.bottom="-"+(this.control.offsetHeight+this.captionHeight)+"px",this.captionContainer.style.bottom="-"+this.captionHeight+"px",this.captionContainer.style.height=this.captionHeight+"px"):(this.mediaInner.style.marginTop="-"+this.control.offsetHeight/2+"px",this.control.style.bottom="-"+this.control.offsetHeight+"px"))},controlOverHandler:function(t){let i=this;if(t){if(i.isOverControlEvent)return;i.isOverControlEvent=!0,document.addEventListener("mousemove",i.visibleControlsHandler),document.addEventListener("touchstart",i.visibleControlsHandler),document.addEventListener("mouseleave",i.hiddenControlsHandler),clearTimeout(i.controlsVisibleTimer),i.controlsVisibleTimer=setTimeout(function(){e.addCls(i.control,"hide")},2e3)}else{if(!i.isOverControlEvent)return;i.isOverControlEvent=!1,document.removeEventListener("mousemove",i.visibleControlsHandler),document.removeEventListener("touchstart",i.visibleControlsHandler),document.removeEventListener("mouseleave",i.hiddenControlsHandler),e.removeCls(i.control,"hide"),clearTimeout(i.controlsVisibleTimer),i.controlsVisibleTimer=setTimeout(function(){e.removeCls(i.control,"hide")},2e3)}},controlHideClass:function(){e.addCls(this.control,"hide"),clearTimeout(this.controlsVisibleTimer)},controlShowClass:function(){let t=this;e.removeCls(t.control,"hide"),clearTimeout(t.controlsVisibleTimer),t.controlsVisibleTimer=setTimeout(function(){e.addCls(t.control,"hide")},2e3),e.isTouch&&(clearTimeout(t.controlsVisibleTimer),setTimeout(function(){e.addCls(t.control,"hide")},2e3))},titleOverHandler:function(t){let i=this;this.isTitle&&"mousemove"===t.type||"touchstart"===t.type?(e.addCls(this.mediaTitle,"show"),clearTimeout(i.titleVisibleTimer),e.isTouch&&(i.titleVisibleTimer=setTimeout(function(){e.removeCls(i.mediaTitle,"show")},2e3))):e.removeCls(this.mediaTitle,"show"),this.isTitle&&(clearTimeout(i.titleVisibleTimer),i.titleVisibleTimer=setTimeout(function(){e.removeCls(i.mediaTitle,"show")},2e3))},bindCoverEvent:function(t){t?(e.removeCls(this.thumbContainer,"is--over"),e.addCls(this.coverBtn,"hide"),!EDUTSS.isMobile&&this.isCoverPause&&(this.thumbContainer.addEventListener("mousemove",this.coverEventHandler,{capture:!0}),this.thumbContainer.addEventListener("mouseleave",this.coverEventHandler,{capture:!0}))):(e.removeCls(this.thumbContainer,"is--over"),e.removeCls(this.coverBtn,"hide"),!EDUTSS.isMobile&&this.isCoverPause&&(this.thumbContainer.removeEventListener("mousemove",this.coverEventHandler,{capture:!0}),this.thumbContainer.removeEventListener("mouseleave",this.coverEventHandler,{capture:!0})))},coverOverHandler:function(t){"mousemove"===t.type||"touchstart"===t.type?e.addCls(this.thumbContainer,"is--over"):e.removeCls(this.thumbContainer,"is--over")},getCaptionData:function(){let e=window.EDUTSS_CAPTION,t=this.media.currentSrc.split("/").slice(-1)[0].split(".")[0];for(let i in e)i===t&&(this.isRealTimeCaption=!0,this.CAPTION_DATA=e[i])},innerCaptionSync:function(t){let i=this,a=e.getEle("[data-sync-s]",i.container),n,s,o=a[0].closest(".scroll--content"),l;function r(){for(n=0;n<a.length;n++)if(i.playTime>=c(a[n].dataset.syncS)&&i.playTime<c(a[n].dataset.syncE)&&s!==n){e.removeCls(a,"on"),e.addCls(a[n],"on"),o&&(o.scrollTop=parseInt(a[n].offsetTop/(l/2))*parseInt(l/2)),s=n;break}a[s]&&(i.playTime<c(a[s].dataset.syncS)||i.playTime>c(a[s].dataset.syncE))&&e.removeCls(a,"on")}function c(e){return 60*parseFloat(e.split(":")[0])+parseFloat(e.split(":")[1])}o&&(l=o.offsetHeight),t?"reset"===t?(e.removeCls(a,"on"),o&&(o.scrollTop=0)):r():i.syncUpdateInterval=setInterval(function(){r()},500)},mediaChange:function(e,t,i){this.media.childNodes[1].src=e+t+".mp4",this.media.poster=e+t+".jpg",this.media.load(),i?this.isTitle=!0:this.isTitle=!1,this.mediaReady()},mediaAllStop:function(e){this.media.readyState&&(e?e!==this.mediaId&&this.mediaStop():this.mediaStop())}},EDUTSS.mediaPlayer||(EDUTSS.mediaPlayer={});e.getEle("[data-media-control]").forEach(function(t,a){let n=t.dataset.mediaControl,s=e.getEle("audio, video",t)[0];EDUTSS.mediaPlayer[a]=new i(t,n,s,a+1),EDUTSS.mediaPlayer[a].init(),EDUTSS.isDevMsg&&console.log("#D: audio player, video player 세팅")})},initMediaCaption:function(t){t.captionCurIdx,t.captionOldIdx,t.captionFs={captionUpdate:function(){t.syncUpdateInterval=setInterval(function(){t.captionFs.getCaptionTxt()},200)},getCaptionTxt:function(){(t.captionFs.getIdx(),t.captionCurIdx)?(t.captionOldIdx!==t.captionCurIdx||""===t.captionTxt.textContent)&&(t.captionOldIdx=t.captionCurIdx,t.captionTextOn=!0,e.addCls(t.captionTxt,"on"),t.captionTxt.innerHTML=t.CAPTION_DATA[t.captionCurIdx].text,EDUTSS.isDevMsg&&console.log("#D: 자막 갱신 => "+t.captionTxt.innerHTML)):t.captionTextOn&&(t.captionTextOn=!1,e.removeCls(t.captionTxt,"on"),t.captionTxt.textContent="")},getIdx:function(){for(let e in t.captionCurIdx=null,t.CAPTION_DATA)if(t.playTime>=t.captionFs.getTime(t.CAPTION_DATA[e].startTime)&&t.playTime<=t.captionFs.getTime(t.CAPTION_DATA[e].endTime)){if(t.captionOldIdx===t.captionCurIdx)break;t.captionCurIdx=e;break}},getTime:function(e){return 60*parseFloat(e.split(":")[0])+parseFloat(e.split(":")[1])}},e.addEvt(t.captionBtn,"click",function(){t.isCaptionOn?(t.isCaptionOn=!1,e.removeCls(t.captionBtn,"on"),e.removeCls(t.captionContainer,"caption--show"),t.isFullscreen&&t.resizePlayer(),clearInterval(t.syncUpdateInterval),EDUTSS.isDevMsg&&console.log("#D: video 자막 닫기")):(t.isCaptionOn=!0,e.addCls(t.captionBtn,"on"),e.addCls(t.captionContainer,"caption--show"),t.isFullscreen&&t.resizePlayer(),t.captionFs.getCaptionTxt(),t.captionFs.captionUpdate(),EDUTSS.isDevMsg&&console.log("#D: video 자막 열기"))})}}}();var EDUTSS=EDUTSS||{};EDUTSS.dragUtil={setPluralValue:function(e,t){e.correctAnswer&&(e.pluralArea=this.getPluralArea(e.correctAnswer,e.isOnce),e.pluralDrag=this.getPluralSelect(e.correctAnswer,t,e.isOnce))},getPluralArea:function(e,t){let i=!1;return e.forEach(function(e){e.length>1&&!t&&(i=!0)}),EDUTSS.isDevMsg&&i&&console.log("#D: drop에 여러개 드래그 가능"),i},getPluralSelect:function(e,t,i){let a=!1;return t.forEach(function(t){EDUTSS.dragUtil.getPluralCorrect(e,t.dataset.num)>1&&!i&&(a=!0)}),EDUTSS.isDevMsg&&a&&console.log("#D: drag 중복 이동 가능"),a},getPluralCorrect:function(e,t){let i=e.filter(function(e){let i=!1;return Array.isArray(t)&&t.length>1?t.forEach(function(t){e.includes(Number(t))&&(i=!0)}):i=e.includes(Number(t)),i}).length;return i},selectHasDone:function(e){e.isHasValue=this.hasDone("value",e.userValue,e.doneNum,e.thisNum),e.isHasAnswer=this.hasDone("answer",e.correctAnswer,e.doneNum,e.thisNum,e)},hasDone:function(e,t,i,a,n){if("answer"===e&&n.isPairType&&n.droppedCnt){let s=n.thisSelect.dataset.pair.split(","),o=n.userValue.flat(),l=!1;return 0===n.userValue[i].length&&s.forEach(function(e){o.includes(Number(e))&&(l=!0)}),l}if(t[i])return t[i].includes(a)},setSelectItems:function(e,t){let i=e.target,a=e.currentTarget,n=EDUTSS.util.hasCls(a,"drop_box")&&!!a.firstElementChild;t.thisSelect=n?t.dragItems[i.closest(".drag_box").dataset.num-1]:a,t.thisNum=parseInt(t.thisSelect.dataset.num),EDUTSS.util.removeCls(t.thisSelect,"drag--done"),t.thisSelect.dataset.pointerGroup&&(t.groupName=t.thisSelect.dataset.pointerGroup)},directCheckResult:function(e){e.userValue[e.doneNum].push(e.thisNum),this.checkPluralDone(e),this.directShowResult(e)},checkPluralDone:function(e){(this.getPluralCorrect(e.userValue,e.thisNum)===e.correctPlural||e.isOnce)&&("drag"===e.type&&EDUTSS.util.addCls(e.thisSelect,"drag--done"),"draw"===e.type&&EDUTSS.util.addCls(e.thisSelect,"draw--done")),(e.userValue[e.doneNum].length===e.correctAnswer[e.doneNum].length||e.isPairType||!e.isMultiAns&&e.isOnce)&&("drag"===e.type&&EDUTSS.util.addCls(e.dropItems[e.doneNum],"drop--done"),"draw"===e.type&&EDUTSS.util.addCls(e.endItems[e.doneNum],"line--done"))},directShowResult:function(e){for(let t=0;t<e.correctAnswer.length;t++){let i=e.correctAnswer[t],a=e.userValue[t];if(!i.includes(a[0])||e.isMultiAns&&i.length!==a.length){e.isCorrect=!1;break}e.isCorrect=!0}e.isCorrect&&EDUTSS.quiz.resultQuiz(e.qid)},addClsDone:function(e){e.userValue[e.doneNum].push(e.thisNum),e.pluralArea||e.pluralDrag?e.pluralArea&&!e.pluralDrag&&"drag"===e.type&&EDUTSS.util.addCls(e.thisSelect,"drag--done"):this.checkPluralDone(e),e.pluralDrag||"drag"===e.type&&EDUTSS.util.addCls(e.dropItems[e.doneNum],"drop--done"),"draw"===e.type&&EDUTSS.util.addCls(e.endItems[e.doneNum],"line--done")},getSelectDone:function(e,t,i){let a=e.touches?e.touches[0].clientX:e.clientX,n=e.touches?e.touches[0].clientY:e.clientY,s;for(let o=0;o<i.dropItems.length;o++)a>t["drop"+o].x&&a<t["drop"+o].x+t["drop"+o].width&&n>t["drop"+o].y&&n<t["drop"+o].y+t["drop"+o].height&&(s=o);if(!s&&0!==s){let l=i.thisSelect.getBoundingClientRect(),r;for(let c=0;c<i.dropItems.length;c++)if(!1===(r=d(l,t["drop"+c]))){s=c;break}}function d(e,t){return e.left>t.left+t.width||e.left+e.width<t.left||e.top>t.top+t.height||e.top+e.height<t.top}s||0===s?i.selectDropItems!==s&&(EDUTSS.util.removeCls(i.dropItems,"select--drop"),EDUTSS.util.addCls(i.dropItems[s],"select--drop"),i.selectDropItems=s):(EDUTSS.util.removeCls(i.dropItems,"select--drop"),i.selectDropItems=null)},getDoneElement:function(e,t){t.doneEl=e.target,t.doneNum=null,t.isSuccess=!1,t.doneEl&&t.doneEl.dataset&&void 0!==t.doneEl.dataset.quizPointer&&(("drag"===t.doneEl.dataset.quizPointer||"start"===t.doneEl.dataset.quizPointer)&&t.doneEl.style.zIndex&&t.doneEl.style.removeProperty("z-index"),EDUTSS.util.isTouch?t.doneEl=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY):t.doneEl=document.elementFromPoint(e.clientX,e.clientY),"drag"===t.type?t.doneEl&&"drop"===t.doneEl.dataset.quizPointer&&(t.doneNum=parseInt(t.doneEl.dataset.num)-1):"draw"===t.type&&t.doneEl&&"end"===t.doneEl.dataset.quizPointer&&(t.doneNum=parseInt(t.doneEl.dataset.num)-1))},isGroupName:function(e){e.groupName&&e.groupName!==e.doneEl.dataset.pointerGroup&&(EDUTSS.isDevMsg&&console.log("#D: 동일 그룹이 아님"),e.isSuccess=!1)},saveSendComplete:function(e){"drag"===e.type?EDUTSS.complete&&EDUTSS.complete.dragDrop(e,e.thisNum,e.doneNum):"draw"===e.type&&EDUTSS.complete&&EDUTSS.complete.drawLine(e,e.thisNum,e.doneNum)},getCoord:function(e,t){return t.coord={left:e.touches?e.touches[0].clientX:e.clientX,top:e.touches?e.touches[0].clientY:e.clientY},t},setDragPosition:function(e,t,i){EDUTSS.util.hasCls(e,"is--scale")?(t.drag.moveLeft=t.coord.left-(EDUTSS.util.hasCls(i,"drop_box")?t.drag.prevLeft+(t.drag.width-i.getBoundingClientRect().width)/2:t.drag.width/2)-t.dragArea.left,t.drag.moveTop=t.coord.top-(EDUTSS.util.hasCls(i,"drop_box")?t.drag.prevTop+(t.drag.height-i.getBoundingClientRect().height)/2:t.drag.height/2)-t.dragArea.top):(t.drag.moveLeft=t.coord.left-t.drag.prevLeft-t.dragArea.left,t.drag.moveTop=t.coord.top-t.drag.prevTop-t.dragArea.top),e.style.left=t.drag.moveLeft/EDUTSS.scaleValue.zoom+"px",e.style.top=t.drag.moveTop/EDUTSS.scaleValue.zoom+"px"},resetDragPosition:function(e){e.dataset.randomPosition?(e.style.left=e.dataset.randomPosition.split(",")[0],e.style.top=e.dataset.randomPosition.split(",")[1]):(e.style.left=null,e.style.top=null)},getDragPosition:function(e,t,i,a,n){let s={};return e.forEach(function(e){s[e.dataset.quizArea+"Area"]=e.getBoundingClientRect()}),s.drag=EDUTSS.util.hasCls(t,"drop_box")?n.target.closest(".drag_box").getBoundingClientRect():t.getBoundingClientRect(),EDUTSS.util.hasCls(a,"is--scale")&&Object.defineProperties(s.drag,{width:{value:a.getBoundingClientRect().width,writable:!0},height:{value:a.getBoundingClientRect().height,writable:!0}}),i&&i.forEach(function(e,t){s["drop"+t]=e.getBoundingClientRect()}),EDUTSS.isDevMsg&&console.log(s),s},dragStickTo:function(e,t){return t.drag.left>t["drop"+e].left+t["drop"+e].width||t.drag.left+t.drag.width<t["drop"+e].left||t.drag.top>t["drop"+e].top+t["drop"+e].height||t.drag.top+t.drag.height<t["drop"+e].top},cloneDrag:function(e,t){let i=t.cloneNode(!0);return e.pluralArea||i.classList.add("inline_flex"),EDUTSS.util.removeCls(i,"this--dragging is--scale"),i.removeAttribute("data-quiz-pointer"),i.removeAttribute("data-random-position"),this.resetDragPosition(i),i},getDrawPosition:function(e,t){let i={};return i.svg=e.getBoundingClientRect(),i.start=t.getBoundingClientRect(),EDUTSS.isDevMsg&&console.log(i),i},drawStartPosition:function(e){let t={};return t={x:(e.start.left-e.svg.left+e.start.width/2)/EDUTSS.scaleValue.zoom,y:(e.start.top-e.svg.top+e.start.height/2)/EDUTSS.scaleValue.zoom},EDUTSS.isDevMsg&&console.log(t),t},drawEndPosition:function(e,t,i){let a={},n,s,o;return i?(n=(o=i.getBoundingClientRect()).left+o.width/2,s=o.top+o.height/2):(n=e.touches?e.touches[0].clientX:e.clientX,s=e.touches?e.touches[0].clientY:e.clientY),a={x:(n-t.svg.left)/EDUTSS.scaleValue.zoom,y:(s-t.svg.top)/EDUTSS.scaleValue.zoom},EDUTSS.isDevMsg&&console.log(a),a},drawAnswerPosition:function(e,t){let i={},a={};return i.svg=e.getBoundingClientRect(),i.dot=t.getBoundingClientRect(),a={x:(i.dot.left-i.svg.left+i.dot.width/2)/EDUTSS.scaleValue.zoom,y:(i.dot.top-i.svg.top+i.dot.height/2)/EDUTSS.scaleValue.zoom},EDUTSS.isDevMsg&&console.log(a),a},isInLine:function(e,t,i){let a=EDUTSS.util.getEle(t,e),n=!1;return a.forEach(function(e){parseInt(e.getAttribute(t))===i&&(n=!0)}),n},createLine:function(e,t,i){let a=document.createElementNS("http://www.w3.org/2000/svg","line");return a.setAttribute("class",t),a.setAttribute("data-start-num",i),e.appendChild(a)},drawLine:function(e,t,i,a){return e.setAttribute("x1",t.x),e.setAttribute("y1",t.y),e.setAttribute("x2",i.x),e.setAttribute("y2",i.y),a&&e.setAttribute("data-end-num",a),e},loadDrawData:function(e){let t,i,a=e[0]||e;(t=EDUTSS.util.getEle(".is--not--rect",a)).length>0&&t.forEach(function(e){EDUTSS.util.isInDisplay(e)&&EDUTSS.util.hasCls(e,"is--not--rect")&&(i=e.dataset.quizId,EDUTSS.util.removeCls(e,"is--not--rect"),EDUTSS.quizDtBook.dtLoadData(i))})}};var EDUTSS=EDUTSS||{};EDUTSS.quizData={DATA:{},setData:function(e){let t=this.DEFAULT_OPTION,i={};i.qid=e.dataset.quizId,i.type=e.dataset.quizType,i.totalChance=t.totalChance,i.isMarking=t.marking,i.isCommonFeedback=t.commonFeedback||!1,i.isEachFeedback=!1,i.isFeedback=!1,i.isSolvingCheck=t.solvingCheck||!1,i.isEmptyFeedback=t.emptyFeedback||!1,i.isCorrect=!1,i.isExample=!1,i.isDirectCheck=!1,i.isActivity=!1,i.isCheckToggle=!1,i.controlShowHide=t.controlShowHide||!1,i.isSendCaliperSensor=!1,i.isDuplicationPopup=!1,i.isViewAnswer=!1,i.chance=0,i.wrongScore=0,i.isCorrectList=[],i.droppedCnt=0,i.isPairType=!1,i.isWordMatching=!1,i.isOnce=!1,i.isMultiAns=!1,i.isGrouping=!1,i.isFreeDrag=!1,i.isClone=!1,i.isBlindAnswer=!1,e.dataset.quizOption&&(i.option=e.dataset.quizOption.split("//"),i.option.forEach(function(e){-1!==e.indexOf("chance:")&&(i.totalChance=parseInt(e.replace("chance:",""))),-1!==e.indexOf("commonfeedback")&&(t.commonFeedback?i.isCommonFeedback=!1:i.isCommonFeedback=!0),-1!==e.indexOf("feedCls:")&&(i.feedbackCls=e.replace("feedCls:","")),-1!==e.indexOf("marking")&&(t.marking?i.isMarking=!1:i.isMarking=!0),-1!==e.indexOf("solving")&&(t.solvingCheck?i.isSolvingCheck=!1:i.isSolvingCheck=!0),-1!==e.indexOf("empty")&&(t.emptyFeedback?i.isEmptyFeedback=!1:i.isEmptyFeedback=!0),-1!==e.indexOf("free")&&(i.isFreeDrag=!0),-1!==e.indexOf("clone")&&(i.isClone=!0),-1!==e.indexOf("cloneDrag")&&(i.isCloneDrag=!0),-1!==e.indexOf("direct")&&(i.isDirectCheck=!0),-1!==e.indexOf("toggle")&&(i.isCheckToggle=!0),-1!==e.indexOf("nopass")&&(i.isTurnNopass=!0),-1!==e.indexOf("turn:")&&(i.isTurn=!0,i.turnTime=parseInt(e.replace("turn:",""))),-1!==e.indexOf("ex")&&(i.isExample=!0,i.isBlindAnswer=!0),-1!==e.indexOf("btn")&&(t.controlShowHide?i.controlShowHide=!1:i.controlShowHide=!0),-1!==e.indexOf("pair")&&(i.isPairType=!0),-1!==e.indexOf("word-matching")&&(i.isWordMatching=!0),-1!==e.indexOf("once")&&(i.isOnce=!0),-1!==e.indexOf("multi")&&(i.isMultiAns=!0),-1!==e.indexOf("group")&&(i.isGrouping=!0),-1!==e.indexOf("viewtab")&&(i.isViewAnswer=!0),-1!==e.indexOf("blind")&&(i.isBlindAnswer=!0)})),i.correctAnswer=this.getAnswer(e,i.type),i.userValue=this.resetUserValue(i.correctAnswer),i.isTurn&&(i.turnTime||(i.turnTime=3e3),i.isTurnNopass||(i.isTurnNopass=!1)),EDUTSS.isDTBOOK&&(i.isMergeSave=!0,this.createSaveInput(e)),this.getElement(i),this.DATA[i.qid]=i,EDUTSS.isDevMsg&&(console.log("#D: 퀴즈 데이터"),console.log(i)),this.addQuizActivity(this.DATA[i.qid],!1)},getElement:function(e){if(e.container=EDUTSS.util.getEle("[data-quiz-id='"+e.qid+"']")[0],e.controlBtns=EDUTSS.util.getEle("[data-quiz-target='"+e.qid+"']")||null,e.controlBtns.forEach(function(t){t.dataset.popup&&(e.isDuplicationPopup=!0)}),e.isExample&&this.getExample(e),e.hintItems=EDUTSS.util.getEle("[data-quiz-feed='hint']",e.container)[0]||null,!e.isCommonFeedback&&e.isEmptyFeedback){let t=EDUTSS.util.getEle("[data-quiz-feed='feedback']",e.container)[0];if(t)e.eachFeedback=[],EDUTSS.util.getEle(".correct, .incorrect, .hint, .again, .empty, .done",t).forEach(function(t){e.eachFeedback.push(t)});else{let i=EDUTSS.util.getEle(".quiz--btn--feedback",e.container)[0],a=EDUTSS.util.getEle("[data-quiz-btn='check'][data-quiz-target='"+e.qid+"']")[0];if(a&&(i||EDUTSS.quizFeedBackText)){let n=EDUTSS.util.createEle("div",{class:"each--feedback","data-quiz-feed":"feedback"},a.parentNode);if(e.eachFeedback=[],i){EDUTSS.util.addCls(n,"custom");let s=i.children;for(let o=0;o<s.length;o++)r(s[o].className,s[o])}else if(EDUTSS.quizFeedBackText)for(let l in EDUTSS.quizFeedBackText)r(l,EDUTSS.quizFeedBackText[l]);function r(t,i){let a=EDUTSS.util.createEle("span",{class:t},n);"string"==typeof i?a.innerHTML=i:a.innerHTML=i.innerHTML,e.eachFeedback.push(a)}}}e.eachFeedback&&(e.isEachFeedback=!0)}switch((e.isCommonFeedback||e.isEachFeedback)&&(e.isFeedback=!0),EDUTSS.util.getEle(".caliper--description",e.container).length>0&&e.container.closest("assessmentItem")&&(e.isSendCaliperSensor=!0,e.description=EDUTSS.util.getEle(".caliper--description",e.container)[0].textContent||"평가"),EDUTSS.util.getEle("[data-quiz-solution='"+e.qid+"']").length>0&&(e.solution||(e.solution=[]),e.solution.push(EDUTSS.util.getEle("[data-quiz-solution='"+e.qid+"']"))),EDUTSS.util.getEle("[data-quiz-solution]",e.container).length>0&&(e.solution||(e.solution=[]),e.solution.push(EDUTSS.util.getEle("[data-quiz-solution]",e.container))),e.type){case"multiple":e.quizName=EDUTSS.util.getEle("[data-quiz-name]",e.container),0===e.quizName.length&&(e.quizName=[e.container]),e.selectItems=[],e.selectedNums=[];break;case"essay":e.essayItems=EDUTSS.util.getEle(".quiz--input",e.container),e.correctAnswer||(e.userValue.length=e.essayItems.length,e.essayItems.forEach(function(t,i){e.userValue[i]=[]}));break;case"draw":e.svgContainer=EDUTSS.util.getEle("[data-quiz-area='svg']",e.container)[0],e.startItems=EDUTSS.util.getEle("[data-quiz-pointer='start']",e.container),e.endItems=EDUTSS.util.getEle("[data-quiz-pointer='end']",e.container);break;case"drag":e.dragArea=EDUTSS.util.getEle("[data-quiz-area]",e.container),e.dragItems=EDUTSS.util.getEle("[data-quiz-pointer='drag']",e.container),e.dropItems=EDUTSS.util.getEle("[data-quiz-pointer='drop']",e.container),e.dragCloneItems=EDUTSS.util.getEle(".drag--clone",e.container),e.dropLen=e.dropItems.length,e.isRandomPosition=EDUTSS.randomDragPosition;let c=EDUTSS.util.getEle("[data-quiz-area='drag']",e.container)[0].dataset.randomPosition||null;"true"===c?e.isRandomPosition=!0:"false"===c&&(e.isRandomPosition=!1);break;case"layer":e.layerPopup=EDUTSS.util.getEle(".layer--select",e.container)[0],e.layerSelect=EDUTSS.util.getEle(".layer--return",e.container),e.layerOption=EDUTSS.util.getEle(".layer--option",e.layerPopup),e.selectPosition,e.selectIdx=0}return(e.container.closest(".pop_chapter_quiz")||e.container.closest(".pop_self_summary")||e.container.closest(".pop_finish"))&&(e.isBlindAnswer=!1,e.quizTypeChapter=!0),e},getExample:function(e){let t,i,a;if(e.example=[],(t=EDUTSS.util.getEle("[data-quiz-feed='example']",e.container)).length>0)for(a=0;a<t.length;a++)e.example.push(t[a]);if(e.controlBtns.length>0)for(a=0;a<e.controlBtns.length;a++)(i=e.controlBtns[a].nextElementSibling)&&i.dataset.quizFeed&&(e.controlBtns[a].dataset.popup="next",i.classList.add("toast","example"),i.dataset.layoutType="popup",e.example.push(i))},getAnswer:function(e,t){let i=EDUTSS.util.getEle("[data-quiz-answer]",e),a=[],n=!1;return i.length>0?i.forEach(function(e){switch(t){case"multiple":a.push(e.textContent.split("//").map(Number));break;case"essay":a.push(EDUTSS.util.getText(e.textContent).split("//"));break;default:(n=e.textContent.split("//")).forEach(function(e,t){a[t]=e.split(",").map(function(e){return/noAnswer/.test(e)?e:Number(e)})})}}):a=!1,a},resetUserData:function(e){let t=this.DATA[e];t.userValue=this.resetUserValue(t.userValue),t.isCorrect=!1,t.isCorrectList=[],t.chance=0,t.wrongScore=0,t.isTurnIdx&&(t.isTurnIdx=0),t.droppedCnt=0,t.dragItemsPos=[],t.selectedNums=[]},resetUserValue:function(e){let t=[];return e&&e.forEach(function(e,i){t[i]=[]}),t},getCaliperUser:function(e){let t=null;if("essay"===e.type){t=[];EDUTSS.util.getEle("[data-quiz-answer]",e.container).forEach(function(e){t.push(e.previousSibling.textContent)})}else t=e.userValue;return t.join()},getCaliperAnswer:function(e){let t=EDUTSS.util.getEle("[data-quiz-answer]",e.container),i=null;return t.length>0&&(i=[],t.forEach(function(e){i.push(e.textContent.split("//"))})),i.join(" ")},createSaveInput:function(e){let t;0===EDUTSS.util.getEle(".quiz--save--data",e).length&&(t="saveData_P"+EDUTSS.util.getFileNum()+"-quizID-"+e.dataset.quizId,EDUTSS.util.createEle("input",{id:t,class:"quiz--save--data hide","data-duplication-type":"false"},e),EDUTSS.isDevMsg&&console.log("#D: 디지털교과서 저장 input 생성 => ID: "+t))},addQuizActivity:function(e,t){EDUTSS.util.getEle(".title")[0];let i=e.container.closest(".pop_finish"),a=EDUTSS.util.getEle(".drawing--canvas",e.container)[0],n=!0,s,o;if(t){switch(e.type){case"multiple":t=!!EDUTSS.util.getText(JSON.stringify(e.userValue)).length;break;case"essay":e.essayItems.length!==e.userValue.length&&(t=!1),e.essayItems.forEach(function(t,a){if(!EDUTSS.util.hasCls(t,"exceptional--activity")){let s=e.userValue[a],o=s?EDUTSS.util.getText(JSON.stringify(s)):"";if(o){let l=Number(t.dataset.minLength)||0;(l&&o.length<l||i&&!o.length)&&(n=!1)}else n=!1}}),t=n;break;case"drag":case"draw":t=function e(t){let i=!0;for(let a=0;a<t.userValue.length;a++)t.userValue[a].length<1&&(i=!1);return i}(e);break;case"layer":let l=[];e.layerSelect.forEach(function(e){l.push(!!e.value||!!e.className.match(/bg\d/))}),t=!l.includes(!1)}(s=EDUTSS.util.getEle("[data-func-check]",e.container)).forEach(function(e){(o=EDUTSS.view.getCheckActivity(e))||(t=!1)}),e.isTotalCheckBtn&&EDUTSS.util.getEle("header span")[0]&&"주제 정리"===EDUTSS.util.getEle("header span")[0].textContent&&(t=!!EDUTSS.util.getText(JSON.stringify(e.userValue))),a&&(EDUTSS.util.hasCls(a,"canvas--drawn")||(t=!1))}t?(e.isActivity=!0,e.container.dataset.isActivity=!0,EDUTSS.util.addCls(e.container,"is--activity"),EDUTSS.util.removeCls(e.container,"is--not--activity"),EDUTSS.util.getEle("[data-quiz-marking='"+e.qid+"']").forEach(function(e){(e.dataset.tabNav||e.dataset.viewedList)&&(EDUTSS.util.addCls(e,"is--activity"),EDUTSS.util.removeCls(e,"is--not--activity"))})):(e.isActivity=!1,e.container.dataset.isActivity=!1,EDUTSS.util.removeCls(e.container,"is--activity"),EDUTSS.util.addCls(e.container,"is--not--activity"),EDUTSS.util.getEle("[data-quiz-marking='"+e.qid+"']").forEach(function(e){(e.dataset.tabNav||e.dataset.viewedList)&&(EDUTSS.util.removeCls(e,"is--activity"),EDUTSS.util.addCls(e,"is--not--activity"))}))}};var EDUTSS=EDUTSS||{};EDUTSS.quizFeedBack=function(){let e=EDUTSS.util,t=EDUTSS.sound;return{initFeedback:function(){let t=e.createEle("div",{class:"feedback--container"},e.getEle("#wrap"));this.target=null,this.stage=null,this.totalQuiz=!1,this.unusual=!1,this.timeoutId=0,e.createEle("div",{class:"feed--img"},t),e.addEvt(t,"click",this.hideFeedback.bind(this))},playFeedback:function(t,i,a,n){this.target=null,this.stage=t,this.totalQuiz=a,this.unusual=n,!0===i?i="correct":!1===i&&(i="incorrect"),n?this.target=e.getEle("."+i,n)[0]:"empty"===i?(t.isEachFeedback&&t.eachFeedback.forEach(function(t){e.removeCls(t,"show"),e.hasCls(t,"empty")&&(this.target=t)},this),this.target||(this.target=e.getEle(".feedback--container")[0],e.addCls(this.target,"empty"))):a||t.isCommonFeedback?(this.target=e.getEle(".feedback--container")[0],e.addCls(this.target,i)):t.isEachFeedback&&t.eachFeedback.forEach(function(a){if(e.removeCls(a,"show"),e.hasCls(a,i)&&(this.target=a,"incorrect"===i)){let n=e.getEle(".wrong",a)[0];n&&(t.isWordMatching||(e.hasCls(t.essayItems[0].parentElement.parentElement,"input--set")?e.getEle(".input--set",t.container).forEach(function(i){let a=!0;for(let n=0;n<e.getEle(".quiz--input",i).length;n++){let s=e.getEle(".quiz--input",i)[n];if(s.value!==s.nextElementSibling.textContent){a=!1;break}}a?e.addCls(i,"input--set--correct"):e.addCls(i,"input--set--incorrect"),!a&&t.wrongScore++}):e.getEle(".number",t.essayItems[0].closest(".input_area")).forEach(function(i,a){let n="";e.getEle(".quiz--input",i).forEach(function(e){n+=e.value}),e.getEle(".answer_list .answer")[a].textContent!==n&&t.wrongScore++})),n.textContent=t.wrongScore)}},this),this.target&&("play"!==this.target.dataset.feedPlay&&(t.isCommonFeedback?this.hideTimeout():"correct"!==i&&"incorrect"!==i&&this.hideTimeout()),this.showFeedback(this.target,i),t.feedbackCls&&e.addCls(this.target,t.feedbackCls))},showFeedback:function(i,a){switch(e.addCls(i,"show"),i.dataset.feedPlay="play",a){case"correct":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 정답 입니다.");break;case"incorrect":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 오답 입니다.");break;case"hint":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 힌트를 보고 다시 풀어주세요."),t.playAudio("hint");break;case"again":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 문제를 다시 풀어주세요."),t.playAudio("again");break;case"empty":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 문제를 풀어주세요."),t.playAudio("empty");break;case"done":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 정답 확인을 눌러보세요."),t.playAudio("empty");break;case"done":EDUTSS.isDevMsg&&console.log("#D: 피드백 : 예시 답안 확인")}},hideFeedback:function(){this.target&&(e.removeCls(this.target,"show"),this.target.removeAttribute("data-feed-play"),this.stage.feedbackCls&&e.removeCls(this.target,this.stage.feedbackCls),!this.unusual&&(this.totalQuiz||this.stage.isCommonFeedback)&&e.removeCls(this.target,"correct incorrect again hint empty done"),clearTimeout(this.timeoutId))},hideTimeout:function(e){this.timeoutId=setTimeout((function(){this.hideFeedback()}).bind(this),e||2500)}}}();var EDUTSS=EDUTSS||{};EDUTSS.quizDtBook=function(){let e=EDUTSS.util,t=EDUTSS.quizData,i=EDUTSS.dragUtil;return{dtLoadData:function(i){let a=t.DATA[i],n=e.getEle("input, textarea",a.container),s=e.getEle(".quiz--save--data",a.container)[0],o=[],l=!1,r,c=0,d=setInterval(function(){c++,!parent.ZOOMVALUE&&c<=50?EDUTSS.isDevMsg&&console.log("#D: 디지털교과서 연동 : Zoom Value 확인"):(parent.ZOOMVALUE&&(EDUTSS.scaleValue.zoom=parent.ZOOMVALUE),n.forEach(function(t){if(a.isMergeSave)(r=s.getAttribute("id"))&&(-1!==o.indexOf(r)&&clearInterval(d),!s||""===s.value||(o.push(r),l||a.isDtLoad||(l=!0,EDUTSS.quizDtBook.dtInitMergeQuiz(s.value))));else{if(e.hasCls(t,"check--input"))return;(r=t.getAttribute("id"))&&(-1!==o.indexOf(r)&&clearInterval(d),!0!==t.checked&&""===t.value||(o.push(r),l||a.isDtLoad||(l=!0,EDUTSS.quizDtBook.dtInitQuiz(i))))}}))},100);setTimeout(function(){clearInterval(d)},7e3),EDUTSS.isDevMsg&&console.log("#D: 디지털교과서 연동")},dtInitMergeQuiz:function(e){let i=JSON.parse(e.slice(1).slice(0,-1)),a=t.DATA[i.qid];a.droppedCnt=i.droppedCnt,a.isActivity=i.isActivity,a.isCorrect=i.isCorrect,a.userValue=i.userValue,a.wrongScore=i.wrongScore,a.isResult=i.isResult,a.dragItemsPos=i.dragItemsPos,a.selectedNums=i.selectedNums,a.userValue&&this.dtInitQuiz(a.qid)},dtInitQuiz:function(t){let a=EDUTSS.quizData.DATA[t];switch(e.getEle("input[placeholder]",a.container).forEach(function(t){""!==t.value&&(e.getEle(".placeholder--text",t.parentNode)[0].style.display="none")}),a.type){case"multiple":let n;a.userValue.forEach(function(t,i){for(let s=0;s<t.length;s++)n=t[s],a.selectItems[i]&&a.selectItems[i].forEach(function(t){parseInt(t.dataset.multipleNum)===n&&e.addCls(t,"select--on")});a.isTurn&&(a.turnIdxBtn&&t.length>0&&e.removeCls(a.turnIdxBtn[i],"disabled"),0===i&&a.turnNavNext&&t.length>0&&e.removeCls(a.turnNavNext,"disabled")),a.isDirectCheck&&a.isResult&&(a.correctAnswer.forEach(function(t,i){for(let n=0;n<t.length;n++){let s=t[n]-1;e.addCls(a.selectItems[i][s],"select--answer"),e.createMarkingGif(a.selectItems[i][s])}}),e.addCls(e.getEle("[data-quiz-solution='"+a.qid+"']"),"solution--show"),e.addCls(e.getEle("[data-quiz-solution]",a.container),"solution--show"))});break;case"essay":a.isMergeSave||a.essayItems.forEach(function(t,i){let n=t.getAttribute("maxlength")||null,s=t.value;"1"===n&&(s=s.toLowerCase()),a.userValue[i]=[s],!a.isExample&&a.correctAnswer&&a.correctAnswer[i].length>1&&a.correctAnswer[i].includes(e.getText(t.value).trim())&&(a.userValue[i]=a.correctAnswer[i])}),EDUTSS.view.initTextAreaScroll();break;case"drag":!function t(){let n,s,o;for(n=0;n<a.userValue.length;n++)if((s=a.userValue[n])&&0!==s.length){if(s.length>1)for(o=0;o<s.length;o++)a.isFreeDrag&&a.isClone||l(s[o],a.dropItems[n]);else l(s,a.dropItems[n]);a.pluralArea||a.pluralDrag?a.pluralArea&&!a.pluralDrag&&(s.forEach(function(t){e.addCls(a.dragItems[t-1],"drag--done")}),e.addCls(a.dropItems[n],"drop--done")):(a.correctAnswer&&i.getPluralCorrect(a.userValue,s)===a.correctAnswer[n].length||i.getPluralCorrect(a.userValue,s)&&a.isOnce&&!a.isMultiAns)&&(e.addCls(a.dragItems[s-1],"drag--done"),e.addCls(a.dropItems[n],"drop--done")),a.isDirectCheck&&a.dropItems.forEach(function(t){for(let i=0;i<s.length;i++)e.getEle(".drag_box[data-num='"+s[i]+"']",t).length&&e.addCls(a.dragItems[s[i]-1],"drag--done")})}if(a.isDirectCheck&&a.pluralArea&&a.pluralDrag){for(o=0;o<a.dragItems.length;o++)i.getPluralCorrect(a.userValue,o+1)===i.getPluralCorrect(a.correctAnswer,o+1)&&e.addCls(a.dragItems[o],"drag--done");for(o=0;o<a.dropItems.length;o++)a.userValue[o].length===a.correctAnswer[o].length&&e.addCls(a.dropItems[o],"drop--done")}function l(t,i){let n=e.getEle("[data-quiz-pointer='drag'][data-num='"+t+"']",a.container)[0].cloneNode(!0);return a.pluralArea||n.classList.add("inline_flex"),n.removeAttribute("data-quiz-pointer"),n.removeAttribute("data-random-position"),a.isMultiAns&&a.isGrouping&&(n.style.left=0,n.style.top=0),i.appendChild(n),e.addCls(e.getEle("[data-drag-completed='"+t+"']",a.container),"show"),n}a.isFreeDrag&&a.dragItemsPos.forEach(function(t,i){t&&t.forEach(function(t){let n=null;a.isClone?(n=e.getEle("[data-quiz-pointer='drag'][data-num='"+(i+1)+"']",a.container)[0].cloneNode(!0),e.addCls(n,"drag--done"),a.dragArea[0].appendChild(n),n.style.left=t.x+"px",n.style.top=t.y+"px"):(n=l(i+1,a.dragItems[i].parentElement),e.addCls(n,"drag--clone"),a.dragItems[i].style.left=t.x+"px",a.dragItems[i].style.top=t.y+"px")})})}();break;case"draw":!function t(){let n={},s={},o,l,r;for(o=0;o<a.userValue.length;o++)if(l=a.userValue[o],n=i.drawAnswerPosition(a.svgContainer,a.endItems[o]),l&&0!==l.length){if(l.length>1)for(r=0;r<l.length;r++)c(l[r],o);else c(l,o);!a.pluralArea&&(i.getPluralCorrect(a.userValue,l)===a.correctAnswer[o].length||a.isMultiAns&&i.getPluralCorrect(a.userValue,l)>=a.correctAnswer[o].length)&&(a.isMultiAns||e.addCls(a.startItems[l-1],"draw--done"),e.addCls(a.endItems[o],"line--done"))}function c(e,t){s=i.drawAnswerPosition(a.svgContainer,a.startItems[e-1]),a.thisLine=i.createLine(a.svgContainer,"user--line",e),i.drawLine(a.thisLine,n,s,t+1)}}();break;case"layer":a.layerSelect.forEach(function(t,i){t.value&&("image"===a.layerPopup.dataset.optionType&&(a.userValue[i]=[Number(t.value.replace("bg",""))+1]),e.addCls(t,t.value))})}if(a.userValue){let s=!!EDUTSS.util.getEle(".drawing--canvas",a.container).length;setTimeout(function(){EDUTSS.quizData.addQuizActivity(a,!0),e.getText(JSON.stringify(a.userValue)).length>0&&EDUTSS.quiz.controlBtnHandler(a)},s?1400:0)}a.isResult&&e.addCls(a.container,"quiz--complete")},dtResetQuiz:function(i){if("function"!=typeof parent.API_ANNOTATION_INPUT_DELETE)return;let a=t.DATA[i],n=e.getEle("input, textarea",a.container);n.forEach(function(e){let t=e.getAttribute("id");t&&(e.value="",e.checked=!1,parent.API_ANNOTATION_INPUT_DELETE(t))})},dtSaveQuizData:function(i){let a=t.DATA[i],n=e.getEle(".quiz--save--data",a.container)[0];n&&(n.value="("+JSON.stringify(a)+")",a.isDtLoad=!0)},sendCaliperSensor:function(i){let a=t.DATA[i],n=a.container.closest("assessmentItem")||a.container;DTCaliperSensor.fire({correct:a.isCorrect,itemObject:n,value:EDUTSS.quizData.getCaliperAnswer(a),userValue:EDUTSS.quizData.getCaliperUser(a),description:a.description,pageNumber:parseInt(e.getFileNum())})}}}();var EDUTSS=EDUTSS||{};EDUTSS.quiz=function(){let e=EDUTSS.util,t=EDUTSS.quizData,i=EDUTSS.quizFeedBack,a=EDUTSS.quizDtBook,n=EDUTSS.dragUtil,s=EDUTSS.sound;return{initQuizType:function(n){EDUTSS.isQuizDragSound=!0,EDUTSS.randomDragPosition=!0,EDUTSS.emptyCheckActivity=!0,EDUTSS.quizData.DEFAULT_OPTION=n;let s=e.getEle("[data-quiz-type]");s.forEach(function(e){let i=e.dataset.quizId,n=e.dataset.quizType;switch(t.setData(e),n){case"multiple":EDUTSS.quiz.multipleQuiz(i);break;case"essay":EDUTSS.quiz.essayQuiz(i);break;case"draw":EDUTSS.quiz.drawQuiz(i);break;case"drag":EDUTSS.quiz.dragQuiz(i);break;case"layer":EDUTSS.quiz.layerQuiz(i)}EDUTSS.quiz.syncControlBtn(i),setTimeout(function(){EDUTSS.isDTBOOK&&a.dtLoadData(i,n)},500)}),s.length>0&&(this.initControlBtn(),i.initFeedback())},multipleQuiz:function(n){let s=t.DATA[n];function o(t,i){let o=s.selectItems[i],l=s.correctAnswer[i].length,r=parseInt(t.currentTarget.dataset.multipleNum),c=[];e.hasCls(t.currentTarget,"select--on")?s.selectedNums.splice(s.selectedNums.indexOf(r),1):s.selectedNums.push(r),o.forEach(function(t){let i=parseInt(t.dataset.multipleNum);i===r?e.hasCls(t,"select--on")?e.removeCls(t,"select--on"):(e.addCls(t,"select--on"),s.isDirectCheck&&e.addCls(t,"select--checked")):l<2?(e.removeCls(t,"select--on"),s.selectedNums.splice(s.selectedNums.indexOf(r),1)):l<s.selectedNums.length&&(e.removeCls(o[s.selectedNums[0]-1],"select--on"),s.selectedNums.splice(0,1)),e.hasCls(t,"select--on")&&c.push(i)}),EDUTSS.isDevMsg&&console.log("#D: 객관식 선택 => "+c),s.userValue[i]=c,EDUTSS.quizData.addQuizActivity(s,!0),s.isDirectCheck?s.isTurn?function t(){let i=e.getEle("[data-quiz-feed='direct']",s.quizName[s.isTurnIdx])[0],a=!1;if(e.addCls(i,"show"),e.removeCls(e.getEle(".show",i),"show"),JSON.stringify(s.userValue[s.isTurnIdx])===JSON.stringify(s.correctAnswer[s.isTurnIdx])?(a=!0,EDUTSS.sound.playAudio("oxCorrect")):(e.addCls(e.getEle(".incorrect",i),"show"),a=!1,EDUTSS.sound.playAudio("oxIncorrect")),a&&"[2]"===JSON.stringify(s.correctAnswer[s.isTurnIdx])&&e.addCls(e.getEle("[data-quiz-feed='wrong']",s.quizName[s.isTurnIdx])[0],"show"),s.isTurnNopass&&!a);else if(s.isTurnIdx<s.isTurnTotal-1){let o=s.selectItems[s.isTurnIdx][s.correctAnswer[s.isTurnIdx][0]-1];e.addCls(o,"select--answer"),e.addCls(s.quizName[s.isTurnIdx],"turn--done"),e.createMarkingGif(o),setTimeout(function(){s.isTurnIdx++,EDUTSS.quiz.moveTurnNav(s,s.isTurnIdx)},s.turnTime)}else s.correctAnswer.forEach(function(t,i){2===t[0]&&e.addCls(e.getEle("[data-quiz-feed='wrong']",s.quizName[i])[0],"show")}),e.removeCls(s.turnIdxBtn,"disabled"),EDUTSS.quiz.checkQuiz(n),EDUTSS.quiz.controlBtnHandler(s)}():(JSON.stringify(s.userValue)===JSON.stringify(s.correctAnswer)?EDUTSS.sound.playAudio("oxCorrect"):(EDUTSS.sound.playAudio("oxIncorrect"),e.addCls(e.getEle(".select--on",s.container),"select--incorrect")),s.correctAnswer.forEach(function(t,i){for(let a=0;a<t.length;a++){let n=t[a]-1;e.addCls(s.selectItems[i][n],"select--answer"),e.createMarkingGif(s.selectItems[i][n])}}),EDUTSS.quiz.checkQuiz(n),EDUTSS.quiz.controlBtnHandler(s)):EDUTSS.quiz.controlBtnHandler(s),EDUTSS.isDTBOOK&&a.dtSaveQuizData(n)}EDUTSS.isDevMsg&&console.log("#D: 객관식 세트([data-quiz-name]) => "+s.quizName.length+"개"),s.isTurn&&(s.isTurnIdx=0,s.isTurnTotal=s.quizName.length,EDUTSS.isDevMsg&&console.log("#D: 객관식 순차 학습"),this.createTurnNav(s)),s.quizName.forEach(function(t,a){s.selectItems[a]=e.getEle("[data-multiple-num]",t),e.addEvt(s.selectItems[a],"click",function(t){!e.hasCls(s.container,"quiz--complete")&&(t.preventDefault(),o.call(this,t,a),s.isActivity&&i.hideFeedback(),s.isDirectCheck||EDUTSS.sound.playAudio("click"))}),s.isTurn&&0===a&&e.addCls(t,"turn--show")})},createTurnNav:function(t){let i,a,n;i=e.createEle("span",{class:"turn--controller"},t.container),t.turnNavPrev=e.createEle("span",{class:"btn turn--prev disabled"},i),t.turnNavNext=e.createEle("span",{class:"btn turn--next disabled"},i),n=e.createEle("span",{class:"turn--idx"},i),t.turnIdxCurrent=e.createEle("span",{class:"number current"},n),t.turnIdxTotal=e.createEle("span",{class:"number total"},n),t.turnCurrent=e.createEle("span",{class:"turn--current"},i),t.turnThisNum=t.isTurnIdx;for(let s=0;s<t.isTurnTotal;s++)(a=e.createEle("span",{class:"idx disabled"},t.turnCurrent)).textContent=s+1;t.turnIdxBtn=e.getEle(".idx",t.turnCurrent),t.userValue.forEach(function(i,a){i.length>0&&e.removeCls(t.turnIdxBtn[a],"disabled")}),e.addEvt(t.turnNavPrev,"click",function(e){t.isTurnIdx>0&&(t.turnThisNum--,EDUTSS.quiz.moveTurnNav(t,t.turnThisNum),EDUTSS.sound.playAudio("click"))}),e.addEvt(t.turnNavNext,"click",function(e){t.isTurnIdx<t.isTurnTotal&&(t.turnThisNum++,EDUTSS.quiz.moveTurnNav(t,t.turnThisNum),EDUTSS.sound.playAudio("click"))}),e.addEvt(t.turnIdxBtn,"click",function(i){t.turnThisNum=e.getIdx(i.currentTarget),EDUTSS.quiz.moveTurnNav(t,t.turnThisNum),EDUTSS.sound.playAudio("click")}),EDUTSS.quiz.moveTurnNav(t,t.turnThisNum)},moveTurnNav:function(t,i){t.turnThisNum=i,t.turnIdxCurrent.textContent=t.turnThisNum+1,t.turnIdxTotal.textContent=t.isTurnTotal,e.removeCls(t.turnNavPrev,"btn--hide"),e.removeCls(t.turnNavNext,"btn--hide"),0===i?e.addCls(t.turnNavPrev,"disabled btn--hide"):e.removeCls(t.turnNavPrev,"disabled"),i===t.isTurnTotal-1?e.addCls(t.turnNavNext,"disabled btn--hide"):e.removeCls(t.turnNavNext,"disabled"),e.hasCls(t.quizName[i],"turn--done")?e.removeCls(t.turnNavNext,"disabled"):e.addCls(t.turnNavNext,"disabled"),e.removeCls(t.quizName,"turn--show"),e.addCls(t.quizName[i],"turn--show"),e.removeCls(t.turnIdxBtn,"on"),e.removeCls(t.turnIdxBtn[i],"disabled"),e.addCls(t.turnIdxBtn[i],"on"),t.quizName.forEach(function(i,a){e.hasCls(i,"turn--done")&&e.removeCls(t.turnIdxBtn[a],"disabled")}),EDUTSS.isDevMsg&&console.log("#D: 객관식 순차 학습 => "+(i+1)+"번 문제")},essayQuiz:function(n){let s=t.DATA[n];s.essayItems.forEach(function(t,o){let l=t.getAttribute("maxlength")||null;function r(t){let o=t.target,r=o===s.keydownActiveEl?o.value:s.keydownActiveEl.value,c="textarea"!==o.tagName?r.trim():r;"1"===l&&(c=c.toLowerCase()),s.userValue[s.keydownElIdx]=[c],!s.isExample&&s.correctAnswer&&s.correctAnswer[s.keydownElIdx].length>1&&s.correctAnswer[s.keydownElIdx].includes(e.getText(c).trim())&&(s.userValue[s.keydownElIdx]=s.correctAnswer[s.keydownElIdx]),EDUTSS.isDevMsg&&console.log("#D: 주관식 입력 => "+s.userValue[s.keydownElIdx]+", 정답 => "+s.correctAnswer[s.keydownElIdx]),EDUTSS.quizData.addQuizActivity(s,!0),EDUTSS.quiz.controlBtnHandler(s),s.isActivity&&i.hideFeedback(),EDUTSS.isDTBOOK&&a.dtSaveQuizData(n)}e.addEvt(t,"keydown",function(){s.keydownActiveEl=document.activeElement,s.keydownElIdx=o}),e.addEvt(t,"keyup",r),e.addEvt(t,"blur",r)})},dragQuiz:function(o){let l=t.DATA[o],r=e.detectDoubleTab(function t(i){let a=i.target,n=a.parentElement;if(!e.hasCls(a,"drag_box")||l.isDirectCheck||n.closest(".quiz--complete")||n.closest(".total--complete"))return;if(n.closest(".total--complete")||!l.thisSelect||!l.isDirectCheck&&!e.hasCls(l.thisSelect,"this--dragging")||l.isDirectCheck&&!a){e.removeCls(n,"double--tap");return}l.isDirectCheck&&(l.thisSelect=a.dataset.num,a.remove());let s=a?l.dragItems[a.dataset.num-1]:l.thisSelect;l.userValue[Array.prototype.slice.call(l.dropItems).indexOf(n)]=[],l.isCorrect=!1,l.droppedCnt--,e.removeCls(s,"drag--done drag--correct drag--incorrect"),e.removeCls(n,"drop--done drag--correct drag--incorrect"),e.removeCls(l.container,"quiz--complete is--activity"),e.addCls(l.container,"is--not--activity"),l.isFreeDrag&&(s.style.left=null,s.style.top=null,s.style.right=null),e.getEle(".drop_box .drag_box",l.container).length||e.removeCls(l.controlBtns,"btn--show on"),e.removeCls(e.getEle(".completed--image")[l.thisSelect-1],"show")}),c={};function d(t){let i=null;!e.hasCls(l.container,"quiz--complete")&&(l.isMoving=!1,n.setSelectItems(t,l),i=e.hasCls(t.currentTarget,"drag_box")?l.thisSelect:t.currentTarget,l.curDragItem=i,l.isClone&&!e.hasCls(l.thisSelect,"attach--drag-event")&&(i=i.cloneNode(!0),l.thisSelect.parentElement.append(i),l.thisSelect=i),e.hasCls(l.thisSelect,"drag--done")||(c=n.getDragPosition(l.dragArea,i,l.dropItems,l.thisSelect,t),n.getCoord(t,c),c.drag.prevLeft=c.coord.left-c.drag.left,c.drag.prevTop=c.coord.top-c.drag.top,l.dragItemsPos[l.thisNum-1]&&l.dragItemsPos[l.thisNum-1].forEach(function(e,t){e.x===l.curDragItem.offsetLeft&&e.y===l.curDragItem.offsetTop&&l.dragItemsPos[l.thisNum-1].splice(t,1)}),e.addEvt(window,"move",l.moveEventHandler),e.addEvt(window,"up",l.removeMoveEventHandler),e.addEvt(window,"leave",l.removeMoveEventHandler),e.addEvt(e.getEle("#wrap"),"leave",l.removeMoveEventHandler),e.hasCls(l.thisSelect,"attach--drag-event")||(l.dragBeforeItems=e.createEle("span",{class:"copy--drag"},l.thisSelect.parentNode),l.dragBeforeItems.style.left=l.thisSelect.offsetLeft+"px",l.dragBeforeItems.style.top=l.thisSelect.offsetTop+"px",l.dragBeforeItems.innerHTML=l.thisSelect.innerHTML,e.addCls(l.dragBeforeItems,l.thisSelect.className),EDUTSS.ui.convertGrayscale(l.dragBeforeItems)),n.setDragPosition(l.thisSelect,c,i),e.addCls(l.thisSelect,"this--dragging")))}l.curDragItem=null,l.dragItemsPos=[],l.moveEventHandler=function e(t){l.isMoving=!0,n.getCoord(t,c),n.setDragPosition(l.thisSelect,c),n.getSelectDone(t,c,l)},l.removeMoveEventHandler=function t(u){let h=u.target,p=null;if(r(u),("input"===h.tagName||"textarea"===h.tagName)&&h.focus(),n.getDoneElement(u,l),c.drag=l.thisSelect.getBoundingClientRect(),null!==l.doneNum)l.isSuccess=!0,EDUTSS.isDevMsg&&console.log("#D: 드래그 성공(포인트 일치) => "+l.doneNum);else for(let g=0;g<l.dropLen;g++)if(!1===n.dragStickTo(g,c)){l.isSuccess=!0,l.doneNum=g,EDUTSS.isDevMsg&&console.log("#D: 드래그 성공(포인트 불일치) => "+l.doneNum);break}if(n.isGroupName(l),l.dropItems[l.doneNum]&&l.dropItems[l.doneNum].dataset.cantDrag&&l.dropItems[l.doneNum].dataset.cantDrag.split("//").forEach(function(e){e==l.thisNum&&(l.isSuccess=!1)}),l.isSuccess){if(l.correctAnswer)(function t(){let r=l.dropItems[l.doneNum],c=r.closest(".sort_box")||r.parentElement,d=!1;n.selectHasDone(l),l.thisSelect.innerText.trim().length>0&&e.getEle(".drop_box",c).forEach(function(t){let i=e.getEle(".drag_box",t),a="";i.forEach(function(e){a+=e.innerText}),(l.isDirectCheck||!l.isDirectCheck&&l.isGrouping)&&(i[0]&&i[0].innerHTML.includes(l.thisSelect.innerHTML)||a.includes(l.thisSelect.innerText))&&(d=!0)}),e.getEle("img",l.thisSelect).length&&r.innerHTML.includes(e.getEle("img",l.thisSelect)[0].getAttribute("src"))&&(d=!0),l.isDirectCheck?(l.correctPlural=n.getPluralCorrect(l.correctAnswer,l.thisNum),EDUTSS.isDevMsg&&(console.log("#D: 다이렉트 체크"),console.log("#D: 복수정답여부 => "+l.correctPlural)),l.isHasValue||!l.isHasAnswer||e.hasCls(r,"drop--done")||d?(EDUTSS.isVibrateInterval&&window.navigator.vibrate(200),("ios"!==EDUTSS.isDevice||"safari"!==EDUTSS.isDevice)&&s.playAudio("incorrect")):(r.appendChild(n.cloneDrag(l,l.thisSelect)),l.isCheckToggle||(n.directCheckResult(l),n.saveSendComplete(l)),l.droppedCnt++,l.isPairType&&!l.droppedCnt||EDUTSS.iosDragSoundDisabled||s.playAudio("dragCorrect"),e.addCls(e.getEle("[data-drag-completed='"+l.thisNum+"']",l.container),"show"))):(l.correctPlural=l.correctAnswer[l.doneNum].length,EDUTSS.isDevMsg&&console.log("#D: 복수정답여부 => "+l.correctPlural),l.isHasValue||d||r.dataset.dropLimit&&!(e.getEle(".drag_box",r).length+1<=r.dataset.dropLimit)?(EDUTSS.isVibrateInterval&&window.navigator.vibrate(200),!EDUTSS.iosDragSoundDisabled&&EDUTSS.commonEffectAudio.dragfalse&&s.playAudio("dragfalse")):(e.hasCls(r,"drop--done")&&!l.pluralArea&&(e.removeCls(r,"drop--done"),e.removeCls(l.dragItems[l.userValue[l.doneNum]-1],"drag--done"),l.pluralArea||(r.innerHTML="",l.userValue[l.doneNum]=[]),EDUTSS.isDevMsg&&console.log("#D: 중복 드래그, 기존 drop--done 삭제")),e.hasCls(l.doneEl,"double--tap")?e.removeCls(l.doneEl,"double--tap"):(r.appendChild(n.cloneDrag(l,l.thisSelect)),n.addClsDone(l)),n.saveSendComplete(l),l.droppedCnt++,!EDUTSS.iosDragSoundDisabled&&EDUTSS.commonEffectAudio.dragtrue&&s.playAudio("dragtrue"))),n.resetDragPosition(l.thisSelect),EDUTSS.quizData.addQuizActivity(l,!0),EDUTSS.quiz.controlBtnHandler(l),l.isActivity&&i.hideFeedback(),EDUTSS.isDTBOOK&&a.dtSaveQuizData(o)})(l.doneNum);else{if(l.isFreeDrag){let m=!!e.getEle(".drag--clone[data-num='"+l.thisNum+"']",l.dragArea[0]).length;m||(p=n.cloneDrag(l,l.thisSelect),e.addCls(p,"drag--clone"),l.dragArea[0].appendChild(p),l.dragCloneItems=e.getEle(".drag--clone",l.container)),l.dragArea[0].append(l.thisSelect),e.addCls(l.thisSelect,"drag--done"),l.userValue.length||(l.userValue[0]=[]),l.userValue[0].push(l.thisSelect.dataset.num),EDUTSS.quizData.addQuizActivity(l,!0),l.isCloneDrag&&!e.hasCls(l.thisSelect,"attach--drag-event")&&(e.addCls(l.thisSelect,"attach--drag-event"),e.addEvt(l.thisSelect,"down",function(e){e.preventDefault(),e.stopPropagation(),d.call(this,e),EDUTSS.view.senseClosePopupEvent(e)})),EDUTSS.isDevMsg&&console.log("#D: 자유롭게 드래그 가능"),EDUTSS.quiz.controlBtnHandler(l)}else l.dropItems[l.doneNum].appendChild(n.cloneDrag(l,l.thisSelect)),e.addCls(l.thisSelect,"drag--done"),n.resetDragPosition(l.thisSelect);l.dragItemsPos[l.thisNum-1]||(l.dragItemsPos[l.thisNum-1]=[]),l.dragItemsPos[l.thisNum-1].push({x:l.thisSelect.offsetLeft,y:l.thisSelect.offsetTop}),n.saveSendComplete(l),EDUTSS.isDevMsg&&console.log("#D: 정답 없는 활동")}}else(l.isMoving||e.hasCls(l.thisSelect,"is--scale"))&&(e.getEle("img",l.thisSelect).length&&(e.getEle("img",l.thisSelect)[0].style.transform="none"),n.resetDragPosition(l.thisSelect),(p=e.getEle(".drag--clone[data-num='"+l.thisNum+"']",l.dragArea[0])[0])&&p.remove(),l.isFreeDrag&&l.isClone&&l.thisSelect.remove(),l.dragItemsPos[l.thisNum-1]&&l.dragItemsPos[l.thisNum-1].slice(0,-1),e.getEle(".drag--done",l.container).length||l.controlShowHide||(EDUTSS.quiz.syncControlBtn(l.qid,"replay"),l.controlShowHide=!0),EDUTSS.isVibrateInterval&&window.navigator.vibrate(200),EDUTSS.commonEffectAudio.dragfalse&&s.playAudio("dragfalse"));l.thisSelect.style.pointerEvents=null,e.removeCls(l.thisSelect,"this--dragging"),e.removeCls(l.dropItems,"select--drop"),e.removeEvt(window,"move",l.moveEventHandler),e.removeEvt(window,"up",l.removeMoveEventHandler),e.removeEvt(window,"leave",l.removeMoveEventHandler),e.removeEvt(e.getEle("#wrap"),"leave",l.removeMoveEventHandler),l.dragBeforeItems.remove(),EDUTSS.isDTBOOK&&a.dtSaveQuizData(o)},n.setPluralValue(l,l.dragItems),l.isRandomPosition?this.randomPosition(l):l.dragItems.forEach(function(e){e.style.opacity=1}),e.addEvt(l.dragItems,"down",function(e){e.preventDefault(),e.stopPropagation(),d.call(this,e),EDUTSS.view.senseClosePopupEvent(e)}),e.addEvt(l.dropItems,"down",function t(i){let a=i.target,n=e.hasCls(a,"drag_box")?a:a.closest(".drag_box");if(!n)return;let s=Array.prototype.slice.call(l.dropItems).indexOf(n.parentElement),o=l.dropItems[s];i.preventDefault(),i.stopPropagation(),!(!n||!e.hasCls(n,"drag_box")||l.isDirectCheck||n.closest(".quiz--complete")||n.closest(".total--complete"))&&(l.prevDropBox=o,l.userValue[s].splice(l.userValue[s].indexOf(Number(n.dataset.num)),1),l.pluralArea||e.removeCls(o,"drop--done"),d(i),n.remove())})},randomPosition:function(t){let i;t.defaultPosition=[],t.randomPosition=[];for(let a=0;a<t.dragItems.length;a++)i=e.getStyle(t.dragItems[a]),t.defaultPosition[a]={},t.defaultPosition[a].left=i.left,t.defaultPosition[a].top=i.top,t.dragItems[a].style.opacity=0;for(;t.defaultPosition.length>0;)t.randomPosition.push(t.defaultPosition.splice(Math.floor(Math.random()*t.defaultPosition.length),1)[0]);for(let n=0;n<t.dragItems.length;n++)t.dragItems[n].style.left=t.randomPosition[n].left,t.dragItems[n].style.top=t.randomPosition[n].top,t.dragItems[n].dataset.randomPosition=t.randomPosition[n].left+","+t.randomPosition[n].top,t.dragItems[n].style.opacity=1},drawQuiz:function(i){let o=t.DATA[i];o.moveEventHandler=function e(t){o.isMoving=!0,c=n.drawEndPosition(t,l),n.drawLine(o.thisLine,r,c)},o.removeMoveEventHandler=function t(d){n.getDoneElement(d,o),null!==o.doneNum&&(o.isSuccess=!0,EDUTSS.isDevMsg&&console.log("#D: 드래그 성공 => "+o.doneNum)),n.isGroupName(o),o.isSuccess?o.correctAnswer&&(c=n.drawEndPosition(d,l,o.doneEl),n.drawLine(o.thisLine,r,c,o.doneNum+1),o.doneNum,n.selectHasDone(o),o.isDirectCheck?(o.correctPlural=n.getPluralCorrect(o.correctAnswer,o.thisNum),EDUTSS.isDevMsg&&(console.log("#D: 다이렉트 체크"),console.log("#D: 복수정답여부 => "+o.correctPlural)),!o.isHasValue&&o.isHasAnswer?(o.isCheckToggle||(n.directCheckResult(o),n.saveSendComplete(o)),EDUTSS.iosDragSoundDisabled||s.playAudio("dragCorrect")):(o.svgContainer.removeChild(o.thisLine),EDUTSS.iosDragSoundDisabled||s.playAudio("incorrect"))):(o.correctPlural=o.correctAnswer[o.doneNum].length,EDUTSS.isDevMsg&&console.log("#D: 복수정답여부 => "+o.correctPlural),o.isHasValue?(o.svgContainer.removeChild(o.thisLine),EDUTSS.isVibrateInterval&&window.navigator.vibrate(200),!EDUTSS.iosDragSoundDisabled&&EDUTSS.commonEffectAudio.dragfalse&&s.playAudio("dragfalse")):(e.hasCls(o.endItems[o.doneNum],"line--done")&&o.correctPlural<=1&&!o.isMultiAns&&(e.removeCls(o.endItems[o.doneNum],"line--done"),e.removeCls(o.startItems[o.userValue[o.doneNum]-1],"draw--done"),o.oldLine=e.getEle("[data-start-num='"+o.userValue[o.doneNum]+"']",o.svgContainer)[0],o.svgContainer.removeChild(o.oldLine),o.userValue[o.doneNum]=[],EDUTSS.isDevMsg&&console.log("#D: 중복 드래그, 기존 line 삭제")),n.addClsDone(o),n.saveSendComplete(o),!EDUTSS.iosDragSoundDisabled&&EDUTSS.commonEffectAudio.dragtrue&&s.playAudio("dragtrue"))),EDUTSS.quizData.addQuizActivity(o,!0),EDUTSS.quiz.controlBtnHandler(o),EDUTSS.isDTBOOK&&a.dtSaveQuizData(i)):o.isMoving&&(o.svgContainer.removeChild(o.thisLine),EDUTSS.isVibrateInterval&&window.navigator.vibrate(200),!EDUTSS.iosDragSoundDisabled&&EDUTSS.commonEffectAudio.dragfalse&&s.playAudio("dragfalse")),e.removeEvt(window,"move",o.moveEventHandler),e.removeEvt(window,"up",o.removeMoveEventHandler),e.removeEvt(window,"leave",o.removeMoveEventHandler),e.removeEvt(e.getEle("#wrap"),"leave",o.removeMoveEventHandler)};let l={},r={},c={};function d(t){var s;let c;o.isMoving=!1,n.setSelectItems(t,o),!e.hasCls(o.container,"quiz--complete")&&e.hasCls(o.thisSelect,"draw--done")?o.isDirectCheck||(s=t,c=s.currentTarget.dataset.num,e.removeCls(s.currentTarget,"draw--done"),e.getEle("line",o.svgContainer).forEach(function(e){e.dataset.startNum===c&&o.svgContainer.removeChild(e)}),o.userValue.forEach(function(t,i){for(let a=0;a<t.length;a++)t[a]===Number(c)&&(e.removeCls(o.endItems[i],"line--done"),t.splice(a,1),a--)}),EDUTSS.quizData.addQuizActivity(o,!1),EDUTSS.quiz.controlBtnHandler(o),EDUTSS.isDTBOOK&&a.dtSaveQuizData(i)):(l=n.getDrawPosition(o.svgContainer,o.thisSelect),r=n.drawStartPosition(l),o.thisLine=n.createLine(o.svgContainer,"user--line",o.thisNum),e.addEvt(window,"move",o.moveEventHandler),e.addEvt(window,"up",o.removeMoveEventHandler),e.addEvt(window,"leave",o.removeMoveEventHandler),e.addEvt(e.getEle("#wrap"),"leave",o.removeMoveEventHandler))}n.setPluralValue(o,o.startItems),e.addEvt(o.startItems,"down",function(t){e.hasCls(o.container,"quiz--complete")||(t.preventDefault(),t.stopPropagation(),d.call(this,t),EDUTSS.view.senseClosePopupEvent(t))}),setTimeout(function(){e.isInDisplay(o.container)||e.addCls(o.container,"is--not--rect")},200)},layerQuiz:function(i){let n=t.DATA[i];n.layerPopupParent=n.layerPopup.parentNode,n.layerSelect.forEach(function(t,i){e.addEvt(t,"click",function(t){var a;e.hasCls(n.container,"quiz--complete")||(n.selectIdx=i,e.addCls(t.currentTarget,"layer--active"),e.removeCls(n.layerPopup,"select--open"),a=t.currentTarget,n.layerPopup.dataset.selectNum=n.selectIdx,e.addCls(n.layerPopup,"select--open select--animate"),setTimeout(function(){e.removeCls(n.layerPopup,"select--animate")},500),n.selectPosition=a.getBoundingClientRect(),n.popupSize=n.layerPopup.getBoundingClientRect(),n.layerPopupParentPos=n.layerPopupParent.getBoundingClientRect(),n.layerPopupPosLeft=a.getBoundingClientRect().left-n.layerPopupParentPos.left-n.popupSize.width/2+n.selectPosition.width/2,n.layerPopupPosTop=a.getBoundingClientRect().top+n.selectPosition.height-n.layerPopupParentPos.top,n.layerPopup.style.left=n.layerPopupPosLeft/EDUTSS.scaleValue.zoom+"px",n.layerPopup.style.top=n.layerPopupPosTop/EDUTSS.scaleValue.zoom+"px",EDUTSS.isDevMsg&&console.log("#D: 레이어 팝업 좌표 설정 => "+n.layerPopup.style.left+n.layerPopup.style.top),EDUTSS.isDevMsg&&console.log("#D: 레이어 퀴즈 => "+n.selectIdx+" 선택"),EDUTSS.sound.playAudio("click"))})}),n.layerOption.forEach(function(t,s){e.addEvt(t,"click",function(t){e.hasCls(n.container,"quiz--complete")||(function t(s,o){let l=n.layerPopup.dataset.optionType,r="true"===n.layerPopup.dataset.multiple,c=n.layerSelect[n.selectIdx];if(r||n.userValue.forEach(function(e,t){e[0]===o+1&&(n.layerSelect[t].value="",e.length=0)}),l&&"image"===l){let d=c.className.match(/bg\d/);d&&e.removeCls(c,d[0]),e.addCls(c,"bg"+o),c.value="bg"+o}else c.value=s.dataset.returnText||s.textContent;n.userValue[n.selectIdx]=[o+1],EDUTSS.isDevMsg&&console.log("#D: 반환 텍스트 => "+c.value),e.removeCls(n.layerPopup,"select--open"),e.removeCls(n.layerSelect,"layer--active"),EDUTSS.quizData.addQuizActivity(n,!0),EDUTSS.quiz.controlBtnHandler(n),EDUTSS.isDTBOOK&&a.dtSaveQuizData(i)}(t.currentTarget,s),EDUTSS.sound.playAudio("click"))})})},checkQuiz:function(n){let s=t.DATA[n],o=!!s.container.closest(".pop_finish");if(s.isCorrectList=[],!s.isTotalCheckBtn){let l=!1;if("multiple"===s.type){for(let r=0;r<s.userValue.length;r++)if(!s.userValue[r].length){l=!0;break}}if(s.isEmptyFeedback&&("canvas"!==s.type&&e.getText(JSON.stringify(s.userValue)).length<1||e.hasCls(s.container,"is--not--activity"))||"multiple"===s.type&&(l||o&&s.correctAnswer[0].length!==s.userValue[0].length)){i.playFeedback(s,"empty");return}s.isSolvingCheck||s.isExample&&EDUTSS.sound.playAudio("popup")}if(s.isWordMatching?(e.getEle(".drop--set",s.container).forEach(function(t){let i=t.dataset.word.split("||"),a="";e.getEle("[data-quiz-pointer='drop']",t).forEach(function(e){a+=e.textContent}),s.isCorrectList.push(i.includes(a))}),s.wrongScore=s.isCorrectList.filter(function(e){return!e}).length,s.isCorrect=!s.wrongScore):s.correctAnswer&&(s.userValue.forEach(function(t,i){"drag"===s.type&&e.getEle(".drag_box",s.dropItems[i]).forEach(function(t){"noAnswer"!==s.correctAnswer[i][0]&&e.addCls(t,"drag--incorrect")});let a=s.correctAnswer[i].filter(function(a){let n=!t.includes(a);return"drag"!==s.type||n||(e.addCls(e.getEle(".drag_box",s.dropItems[i])[t.indexOf(a)],"drag--correct"),e.removeCls(e.getEle(".drag_box",s.dropItems[i])[t.indexOf(a)],"drag--incorrect")),n}).length;"boolean"!=typeof s.correctAnswer&&s.isCorrectList.push(s.isMultiAns?!a:"noAnswer"===s.correctAnswer[i][0]||s.correctAnswer[i].includes(t[0]))}),s.isCorrect=JSON.stringify(s.correctAnswer)===JSON.stringify(s.userValue)||"essay"===s.type&&e.getText(JSON.stringify(s.correctAnswer))===e.getText(JSON.stringify(s.userValue))||(!!s.isOnce||!!s.isMultiAns)&&!s.isCorrectList.includes(!1)),EDUTSS.isDevMsg&&(console.log("#D: 사용자 입력값"),console.log(JSON.stringify(s.userValue)),console.log("#D: 정답"),console.log(JSON.stringify(s.correctAnswer))),s.isDuplicationPopup){e.addCls(s.container,"quiz--complete");return}if(s.isExample&&(s.example.forEach(function(t){e.addCls(t,"example--show")}),s.isFeedback&&i.playFeedback(s,"example")),!s.isCorrect&&s.chance<s.totalChance-1)EDUTSS.isDTBOOK&&s.isSendCaliperSensor&&a.sendCaliperSensor(n),s.hintItems&&s.chance===s.totalChance-2&&e.addCls(s.hintItems,"hint--show"),!s.isTotalCheckBtn&&s.isFeedback&&(s.hintItems&&s.chance===s.totalChance-2?i.playFeedback(s,"hint"):i.playFeedback(s,"again")),s.chance++,EDUTSS.isDevMsg&&console.log("#D: 기회 남음 => "+s.chance);else if(s.isCorrect||s.chance===s.totalChance-1){if(s.isMarking){let c=e.getEle("[data-quiz-marking="+s.qid+"]")[0];e.removeCls(c,"marking--correct marking--incorrect"),!0===s.isCorrect?e.addCls(c,"marking--correct"):e.addCls(c,"marking--incorrect"),EDUTSS.isDevMsg&&s.isCorrect&&console.log("#D: OX 마킹 => target : "+c)}s.isTotalCheckBtn||!s.isFeedback||s.isExample||s.solution&&(!s.solution||s.isCommonFeedback)||i.playFeedback(s,s.isCorrect),s.isViewAnswer||this.resultQuiz(n)}EDUTSS.quiz.detectScroll(s)},totalCheck:function(a,n){let s,o,l,r,c,d=!1,u=!1,h=!0,p=0,g=0;for(c=0,s=e.getEle(a),r=(l=e.getEle("[data-quiz-type]",s)).length;c<r;c++)(o=t.DATA[l[c].dataset.quizId]).isEmptyFeedback&&(EDUTSS.emptyCheckActivity&&"false"===o.container.dataset.isActivity||"canvas"!==o.type&&0===e.getText(JSON.stringify(o.userValue)).length)&&(d=!0);if(d){let m=e.getEle(".each--feedback",n.currentTarget.parentNode)[0];m?i.playFeedback(o,"empty","totalCheck",m):i.playFeedback(o,"empty","totalCheck");return}for(c=0;c<r;c++)o=t.DATA[l[c].dataset.quizId],EDUTSS.quiz.checkQuiz(o.qid),o.isCorrect?p++:h=!1,o.isCommonFeedback||(u=!1);if(g=Math.round(p/r*100),e.getEle("[quiz-score-num]",s).forEach(function(e){e.dataset.scoreNum=g,e.childNodes[0].textContent=g}),u?i.playFeedback(o,h,"total"):EDUTSS.sound.playAudio("click"),e.addCls(s,"total--complete"),e.addCls(e.getEle(".btn.check",s),"on disabled"),e.addCls(e.getEle(".btn.replay",s),"on"),e.addCls(e.getEle(".btn.view_user",s),"on"),e.addCls(e.getEle(".page",s),"user--answer"),e.getEle(".quiz--short",s).length){let f=e.getEle("[data-tab-list]",s),E=e.getEle(".quiz_short",s);e.removeCls(f,"tab--show"),e.addCls(f[0],"tab--show"),e.removeCls(E,"on"),e.addCls(E[0],"on")}EDUTSS.isDevMsg&&console.log("#D: 통합 퀴즈, 점수 : "+g)},resultQuiz:function(i,n,o){let l=t.DATA[i];if(EDUTSS.isDevMsg&&console.log("#D: 결과 보기"),n&&e.hasCls(n,"on")){e.removeCls(n,"on"),"essay"===l.type&&l.isExample&&(l.example.length>0&&l.example.forEach(function(t){e.removeCls(t,"example--show")}),l.essayItems.forEach(function(t){e.removeCls(t,"disabled")}));return}if(!l.isDirectCheck){if(e.getEle("[data-quiz-answer]",l.container).forEach(function(t){"show"===t.dataset.quizAnswer&&e.addCls(t,"answer--show")}),l.isBlindAnswer)switch(l.type){case"multiple":case"draw":case"layer":break;case"essay":!l.isExample&&(e.hasCls(l.container,"incorrect--color")||l.container.closest(".pop_remember"))&&l.essayItems.forEach(function(t,i){let a=t.closest(".input--set");if(e.removeCls(t,"input--correct input--incorrect"),a){let n=!0,s=e.getEle(".quiz--input",a);for(let o=0;o<s.length;o++){let r=s[o];if(r.value!==r.nextElementSibling.textContent){n=!1;break}}n?e.addCls(s,"input--correct"):e.addCls(s,"input--incorrect")}else 0!==e.getText(JSON.stringify(l.correctAnswer[i])).length&&(JSON.stringify(l.correctAnswer[i])===JSON.stringify(l.userValue[i])?e.addCls(t,"input--correct"):e.addCls(t,"input--incorrect"))});break;case"drag":l.isWordMatching?e.getEle(".drop--set",l.container).forEach(function(t,i){!0===l.isCorrectList[i]?e.addCls(e.getEle("[data-num]",t),"drag--correct"):e.addCls(e.getEle("[data-num]",t),"drag--incorrect")}):l.dropItems.forEach(function(t,i){e.removeCls(t,"drag--correct drag--incorrect"),JSON.stringify(l.correctAnswer[i])===JSON.stringify(l.userValue[i])||l.isCorrectList[i]?e.addCls(t,"drag--correct"):e.addCls(t,"drag--incorrect")})}else this.viewCorrectAnswer(i)}if(l.hintItems&&"sci"!==EDUTSS.isSubject&&e.removeCls(l.hintItems,"hint--show"),(!l.isExample||l.quizTypeChapter)&&"essay"===l.type&&e.addCls(l.essayItems,"disabled"),"multiple"===l.type){let r=e.getEle("[data-quiz-feed='wrong']",l.container);l.correctAnswer.forEach(function(t,i){for(let a=0;a<t.length;a++)r[i]&&2===t[a]&&EDUTSS.util.getText(r[i].innerText).length>0&&e.addCls(r[i],"show")})}"soc"===EDUTSS.isSubject&&l.container.closest(".pop_remember")&&"multiple"===l.type?l.isCorrect?s.playAudio("oxCorrect"):s.playAudio("oxIncorrect"):l.solution?(l.isDirectCheck||l.isExample||EDUTSS.sound.playAudio("showAnswer"),l.solution.forEach(function(t){e.removeCls(t,"solution--hide"),e.addCls(t,"solution--show"),t.forEach(function(t){e.removeCls(e.getEle(".color--incorrect",t),"color--incorrect")}),l.isDirectCheck||l.isBlindAnswer||l.isCorrect||t.forEach(function(t){e.addCls(e.getEle(".answer",t),"color--incorrect"),e.addCls(e.getEle(".ticon1",t),"color--incorrect")})}),e.getEle(".key_area",l.container.parentElement).length&&(e.getEle(".key_area",l.container.parentElement)[0].style.display="none")):"multiple"!==l.type||l.isEmptyFeedback||EDUTSS.sound.playAudio("showAnswer"),e.addCls(l.container,"quiz--complete"),this.syncControlBtn(i,"result"),l.isResult=!0,EDUTSS.complete&&EDUTSS.complete.quizResult(l),EDUTSS.isDTBOOK&&l.isSendCaliperSensor&&a.sendCaliperSensor(i),EDUTSS.isDTBOOK&&a.dtSaveQuizData(i),"sci"!==EDUTSS.isSubject||l.quizTypeChapter||this.resetBtnBlinking(i,"enabled")},resetBtnBlinking:function(i,a){let n=t.DATA[i];function s(t){t.style.pointerEvents="auto",e.addEvt(t,"click",n.alertHandler)}function o(t){t.style.pointerEvents=null,e.removeEvt(t,"click",n.alertHandler)}switch(e.hasCls(n.container,"quiz--complete")||(a="disabled"),n.alertHandler||(n.alertHandler=(function t(){function i(t){e.addCls(t,"animate_replay_motion"),setTimeout(function(){e.removeCls(t,"animate_replay_motion")},1e3)}n.totalControlBtns&&n.totalControlBtns.forEach(function(e){"all-replay"===e.dataset.quizBtn&&i(e)}),n.controlBtns.forEach(function(e){"replay"===e.dataset.quizBtn&&i(e)})}).bind(this)),n.type){case"multiple":"enabled"===a?n.selectItems.forEach(function(e){for(let t=0;t<e.length;t++)s(e[t])}):n.selectItems.forEach(function(e){for(let t=0;t<e.length;t++)o(e[t])});break;case"essay":break;case"drag":"enabled"===a?(n.dragItems.forEach(function(e){s(e)}),n.dropItems.forEach(function(e){s(e)})):(n.dragItems.forEach(function(e){o(e)}),n.dropItems.forEach(function(e){o(e)}));break;case"draw":"enabled"===a?(n.startItems.forEach(function(e){s(e)}),n.endItems.forEach(function(e){s(e)})):(n.startItems.forEach(function(e){o(e)}),n.endItems.forEach(function(e){o(e)}));break;case"layer":"enabled"===a?n.layerSelect.forEach(function(e){s(e)}):n.layerSelect.forEach(function(e){o(e)})}},viewCorrectAnswer:function(i){let a=t.DATA[i];switch(a.type){case"multiple":let s;a.correctAnswer.forEach(function(t,i){a.isViewAnswer&&e.removeCls(a.selectItems[i],"select--on");for(let n=0;n<t.length;n++)s=t[n]-1,e.addCls(a.selectItems[i][s],"select--answer"),e.createMarkingGif(a.selectItems[i][s])});break;case"essay":!a.isExample&&(a.essayItems.forEach(function(t,i){e.removeCls(t,"input--correct input--incorrect"),0!==e.getText(JSON.stringify(a.correctAnswer[i])).length&&(JSON.stringify(a.correctAnswer[i])===JSON.stringify(a.userValue[i])||e.getText(JSON.stringify(a.correctAnswer[i]))===e.getText(JSON.stringify(a.userValue[i]))?e.addCls(t,"input--correct"):e.addCls(t,"input--incorrect"))}),e.getEle("[data-quiz-answer]",a.container).forEach(function(e){e.textContent=e.textContent.replace("//"," 또는 ")}),EDUTSS.isDevMsg&&console.log("#D: [data-quiz-answer]의 //를 또는 으로 치환"));break;case"drag":a.dropItems.forEach(function(t,i){e.addCls(t,"drop--done"),JSON.stringify(a.correctAnswer[i])===JSON.stringify(a.userValue[i])||a.isCorrectList[i]?e.addCls(t,"drag--correct"):e.addCls(t,"drag--incorrect")});break;case"draw":!function t(){let i=e.getEle(".user--line",a.svgContainer),s={},o={};a.isCheckToggle?e.addCls(a.endItems,"disabled"):e.addCls(a.endItems,"line--done");for(let l=0;l<a.correctAnswer.length;l++){let r=a.correctAnswer[l];if(s=n.drawAnswerPosition(a.svgContainer,a.endItems[l]),r&&0!==r.length){if(r.length>1)for(let c=0;c<r.length;c++)d(r[c],a.userValue[l][c],l);else d(r,a.userValue[l],l);a.isCheckToggle?e.addCls(a.startItems[l],"disabled"):e.addCls(a.startItems[l],"draw--done")}}function d(e,t,i){(a.isCheckToggle||JSON.stringify(e)!==JSON.stringify(t))&&(o=n.drawAnswerPosition(a.svgContainer,a.startItems[e-1]),a.thisLine=n.createLine(a.svgContainer,"answer--line",e),n.drawLine(a.thisLine,s,o,i+1))}i.forEach(function(t){let i=parseInt(t.dataset.startNum),n=parseInt(t.dataset.endNum);"number"!=typeof i||"number"!=typeof n?e.addCls(t,"line--hide"):a.correctAnswer[n-1].includes(i)||e.addCls(t,"line--hide"),a.isCheckToggle&&e.addCls(t,"line--hide")})}();break;case"layer":let o=a.layerPopup.dataset.optionType;a.layerSelect.forEach(function(t,i){let n=a.correctAnswer[i];if("image"===o){let s=t.className.match(/bg\d/);s&&e.removeCls(t,s[0]),e.addCls(t,"bg"+(n-1))}else{let l=e.createEle("span",{class:"layer--answer"},t.parentNode);l.innerHTML=a.layerOption[n-1].dataset.returnText||a.layerOption[n-1].textContent}e.addCls(t,"layer--done")}),e.removeCls(a.layerPopup,"select--open")}},showUserValue:function(i){let n=t.DATA[i];switch(n.type){case"multiple":n.correctAnswer.forEach(function(t,i){t.forEach(function(t,a){e.removeCls(n.selectItems[i][t-1],"select--answer"),e.addCls(n.selectItems[n.userValue[i][a]],"select--on")})});break;case"essay":n.essayItems.forEach(function(t,i){t.textContent=n.userValue[i][0].replace("//"," 또는 "),e.addCls(t,"disabled")});break;case"drag":n.dropItems.forEach(function(e){e.removeChild(e.firstChild)}),n.userValue.forEach(function(t,i){t.length&&function t(i,a){let n=a.cloneNode(!0);n.removeAttribute("data-quiz-pointer"),e.removeCls(n,"drag--done"),i.appendChild(n)}(n.dropItems[i],n.dragItems[t[0]-1])});break;case"draw":let s=e.getEle(".user--line",n.svgContainer),o=e.getEle(".answer--line",n.svgContainer);e.addCls(o,"line--hide"),e.removeCls(s,"line--hide");break;case"layer":let l=n.layerPopup.dataset.optionType;n.userValue.forEach(function(t,i){let a=n.layerSelect[i];if("image"===l)e.removeCls(a,a.className.match(/bg\d/)[0]),e.addCls(a,"bg"+(t[0]-1));else{let s=e.createEle("span",{class:"layer--answer"},a.parentElement),o=n.layerOption[t[0]-1];s.textContent=o.dataset.returnText||o.textContent}e.addCls(a,"layer--done")})}EDUTSS.isDTBOOK&&a.dtSaveQuizData(i)},onceMoreChance:function(e){let i=t.DATA[e];i.chance=i.totalChance-1},resetQuiz:function(e){let i=t.DATA[e];EDUTSS.isDevMsg&&console.log("#D: 퀴즈 초기화"),i&&(t.resetUserData(e),this.resetQuizElement(e),this.resetQuizData(i),t.addQuizActivity(i,!1),EDUTSS.isDTBOOK&&a.dtResetQuiz(e),EDUTSS.isDTBOOK&&a.dtSaveQuizData(e),EDUTSS.quiz.detectScroll(i),"sci"!==EDUTSS.isSubject||i.quizTypeChapter||this.resetBtnBlinking(e,"disabled"))},resetQuizData:function(e,t){let i=e.qid;e.chance=0,e.isResult=!1,void 0!==e.controlShowHide&&(e.controlShowHide=!0),this.syncControlBtn(i,"replay"),EDUTSS.complete&&EDUTSS.complete.quizReset(e)},resetQuizElement:function(i,a){let n=t.DATA[i],s=e.getEle(".scroll_area",n.container);if(n.isMarking&&e.removeCls(e.getEle("[data-quiz-marking="+n.qid+"]"),"marking--correct marking--incorrect"),e.removeCls(e.getEle("[data-quiz-answer]",n.container),"answer--show"),n.hintItems&&(e.removeCls(n.hintItems,"hint--show"),e.removeCls(n.controlBtns,"viewed--duplication--hint")),n.isExample&&n.example.forEach(function(t){e.removeCls(t,"example--show pop--open example--hide")}),n.isEachFeedback&&(n.eachFeedback.forEach(function(t){e.removeCls(t,"show")}),e.removeCls(n.eachFeedback,"show")),e.hasCls(n.container,"quiz--complete")&&(e.removeCls(e.getEle("[data-quiz-feed='wrong']",n.container),"show"),n.solution&&(n.solution.forEach(function(t){e.removeCls(t,"solution--show solution--hide")}),e.getEle(".key_area",n.container.parentElement).length&&(e.getEle(".key_area",n.container.parentElement)[0].style.display=""))),!a)switch(e.removeCls(n.container,"quiz--complete"),n.type){case"multiple":n.selectItems.forEach(function(t){for(let i=0;i<t.length;i++)e.removeCls(t[i],"select--on select--answer select--checked select--incorrect")}),n.isTurn&&(e.removeCls(n.quizName,"turn--done"),EDUTSS.quiz.moveTurnNav(n,n.isTurnIdx),n.turnIdxBtn.forEach(function(t,i){0===i?e.addCls(t,"on"):e.addCls(t,"disabled")})),e.getEle(".oxquiz--answer--marking",n.container).forEach(function(e){e.remove()});break;case"essay":n.essayItems.forEach(function(t){e.removeCls(t,"disabled input--correct input--incorrect"),t.value="",e.getEle(".placeholder--text",t.parentElement).length&&(e.getEle(".placeholder--text",t.parentElement)[0].style.display="")});break;case"drag":e.removeCls(n.dragItems,"drag--done drag--correct drag--incorrect"),e.removeCls(n.dropItems,"drop--done drag--correct drag--incorrect"),n.isFreeDrag?(n.dragItems.forEach(function(e){e.style.left=null,e.style.top=null,e.style.right=null}),n.dragCloneItems.forEach(function(e){e.remove()}),e.getEle(".drag--done",n.dragArea[0]).forEach(function(e){e.remove()})):n.dropItems.forEach(function(e){e.innerHTML=""}),n.isRandomPosition&&this.randomPosition(n),e.removeCls(e.getEle("[data-drag-completed]",n.container),"show");break;case"draw":e.removeCls(n.startItems,"draw--done disabled"),e.removeCls(n.endItems,"line--done disabled"),e.getEle("line",n.svgContainer).forEach(function(t){(e.hasCls(t,"user--line")||e.hasCls(t,"answer--line"))&&n.svgContainer.removeChild(t)});break;case"layer":n.layerSelect.forEach(function(t){let i=t.className.match(/bg\d/),a=e.getEle(".layer--answer",t.parentNode)[0];t.value="",a&&t.parentNode.removeChild(a),e.removeCls(t,"layer--done"),i&&e.removeCls(t,i[0])}),e.removeCls(n.layerPopup,"select--open")}n.layerSelect&&e.removeCls(n.layerSelect,"layer--active"),(e.getEle("[data-func-check]",n.container).length>0||e.getEle("[data-func-show]",n.container).length>0)&&EDUTSS.view.viewResetEle(n.container),n.container.dataset.funcShow&&EDUTSS.view.showHideReplay(n.container),n.container.dataset.funcCheck&&EDUTSS.view.resetCheckList(n.container),s.length&&s.forEach(function(e){EDUTSS.view.visibleScrollState(e)}),e.getEle(".drawing--canvas",n.container).length&&e.getEle(".drawing--canvas",n.container).forEach(function(t,i){let a=e.getEle(".open--drawing",n.container)[i];e.getEle("[data-drawing-type='reset']",n.container)[i]&&(e.getEle("[data-drawing-type='reset']",n.container)[i].click(),e.getEle("[data-drawing-type='pen']",n.container)[i].click()),e.hasCls(a,"on")&&a.click()}),(e.getEle(".scratch--content",n.container).length>0||e.getEle("[data-func-show]",n.container).length>0)&&e.getEle(".scratch--content",n.container).forEach(function(t,i){e.getEle(".replay[data-scratch-target]",t)[0].click()})},resultToggle:function(e){let i=t.DATA[e];if(EDUTSS.isDevMsg&&console.log("#D: 정답 토글"),!i.isCheckToggle)return},duplicationResult:function(i,a){let s=t.DATA[i.dataset.quizId];if(s.isExample&&"answer"===a){let o=e.getEle("[data-quiz-feed='example']",i);o.length>0&&o.forEach(function(t){e.addCls(t,"example--show")})}switch(i.dataset.quizType){case"multiple":let l,r,c;0===(r=e.getEle("[data-quiz-name]",i)).length&&(r=[i]),c=[],r.forEach(function(t,i){c[i]=e.getEle("[data-multiple-num]",t),c[i].forEach(function(t){"answer"===a&&(e.removeCls(t,"select--on"),s.correctAnswer.forEach(function(t,i){for(let a=0;a<t.length;a++)l=t[a]-1,e.addCls(c[i][l],"select--answer")}))})});break;case"essay":e.getEle(".quiz--input",i).forEach(function(t,i){e.removeCls(t,"disabled input--correct input--incorrect"),"answer"===a?(s.isExample?t.style.display="none":s.correctAnswer[i]&&(t.value=s.correctAnswer[i]),e.addCls(t,"answer")):s.userValue[i]&&(t.value=s.userValue[i],"textarea"===t.tagName&&(t.style.height=e.hasCls(t,"scroll--content")?"100%":t.scrollHeight+"px"),"textarea"!==t.tagName||e.hasCls(t,"scroll--content")||(t.style.height=t.scrollHeight+"px"))});break;case"drag":"answer"===a&&function t(){let a=e.getEle("[data-quiz-pointer='drop']",i);function n(t,i){let a=e.getEle("[data-quiz-pointer='drag'][data-num='"+t+"']",s.container)[0].cloneNode(!0);a.classList.add("inline_flex"),a.removeAttribute("data-quiz-pointer"),i.appendChild(a)}a.forEach(function(t){e.addCls(t,"drop--done"),t.innerHTML=""}),s.correctAnswer.forEach(function(t,i){t.length>0&&t.length<2?n(t[0],a[i]):t.length>1&&t.forEach(function(e){n(e,a[i])}),e.removeCls(e.getEle(".drag--done",a[i]),"drag--done")})}();break;case"draw":!function t(a){let o=e.getEle("[data-quiz-area='svg']",i)[0],l=e.getEle("[data-quiz-pointer='start']",i),r=e.getEle("[data-quiz-pointer='end']",i),c,d,u={},h={};if(e.getEle("line",o).forEach(function(e){o.removeChild(e)}),e.addCls(l,"draw--done disabled"),e.addCls(r,"line--done disabled"),"answer"===a)for(let p=0;p<s.correctAnswer.length;p++)m(c=s.correctAnswer[p],p);else for(let g=0;g<s.userValue.length;g++)s.userValue[g]&&m(c=s.userValue[g],g);function m(e,t){if(u=n.drawAnswerPosition(o,r[t]),e.length>1)for(let i=0;i<e.length;i++)f(e[i],t);else 0!==e.length&&f(e,t)}function f(e,t){h=n.drawAnswerPosition(o,l[e-1]),d="answer"===a?n.createLine(o,"answer--line",e):n.createLine(o,"user--line",e),n.drawLine(d,u,h,t+1)}}(a);break;case"layer":let d=e.getEle(".layer--return",i);"answer"===a?d.forEach(function(e,t){let i=s.correctAnswer[t];e.value=s.layerOption[i-1].dataset.returnText||s.layerOption[i-1].textContent}):d.forEach(function(e,t){let i=s.userValue[t];i&&i.length>0&&(e.value=s.layerOption[i-1].dataset.returnText||s.layerOption[i-1].textContent)})}e.getEle("[data-quiz-answer]",i).forEach(function(t){"show"===t.dataset.quizAnswer&&e.addCls(t,"answer--show")}),e.addCls(e.getEle("[data-quiz-feed='hint']",i),"hint--show"),e.addCls(e.getEle("[data-quiz-solution='"+i.qid+"']"),"solution--show"),e.addCls(e.getEle("[data-quiz-solution]",i),"solution--show"),e.removeCls(i,"is--not--activity is--activity"),e.addCls(i,"quiz--complete")},initControlBtn:function(){e.getEle("[data-quiz-btn]").forEach(function(i){let a=i.dataset.quizTarget,n=i.dataset.quizBtn,s=t.DATA[a],o,l,r=!0;e.addEvt(i,"click",function(c){let d=this.closest(".page");switch(n){case"check":e.hasCls(this,"on")||(EDUTSS.quiz.checkQuiz(a),r=!1);break;case"answer":e.hasCls(this,"on")||EDUTSS.quiz.resultQuiz(a,this);break;case"replay":EDUTSS.quiz.resetQuiz(a);break;case"all-check":e.hasCls(this,"on")||(EDUTSS.quiz.totalCheck(a,c),r=!1);break;case"all-answer":l=e.getEle(a),e.hasCls(this,"on")||((o=e.getEle("[data-quiz-type]",l)).forEach(function(e){EDUTSS.quiz.resultQuiz(e.dataset.quizId)}),e.addCls(this,"on")),e.addCls(l,"total--complete");break;case"all-replay":l=e.getEle(a),(o=e.getEle("[data-quiz-type]",l)).forEach(function(e){EDUTSS.quiz.resetQuiz(e.dataset.quizId)}),e.removeCls(l,"total--complete"),(e.getEle("[data-func-check]",l).length>0||e.getEle("[data-func-show]",l).length>0)&&EDUTSS.view.viewResetEle(l);break;case"view-user":if(e.hasCls(this,"on"))return;EDUTSS.quiz.showUserValue(a),e.addCls(this,"on"),e.addCls(d,"user--answer"),e.removeCls(d,"example--answer"),e.getEle("[data-quiz-btn='view-answer']").forEach(function(t){t.dataset.quizTarget===a&&e.removeCls(t,"on")});break;case"view-answer":EDUTSS.quiz.resultQuiz(a),e.addCls(this,"on"),e.addCls(d,"example--answer"),e.removeCls(d,"user--answer"),e.getEle("[data-quiz-btn='view-user']").forEach(function(t){t.dataset.quizTarget===a&&e.removeCls(t,"on")});break;case"close-solution":t.DATA[a].totalControlBtns&&t.DATA[a].totalControlBtns.forEach(function(t){"all-check"===t.dataset.quizBtn&&e.removeCls(t,"disabled on")}),e.removeCls(e.getEle(".check[data-quiz-target='"+a+"']"),"disabled on"),e.addCls(e.getEle("[data-quiz-solution='"+a+"']"),"solution--hide"),e.addCls(e.getEle("[data-quiz-solution]",t.DATA[a].container),"solution--hide"),t.DATA[a]&&EDUTSS.quiz.detectScroll(t.DATA[a]);break;case"shuffle":EDUTSS.quiz.randomPosition(s)}r&&!i.dataset.popup&&EDUTSS.sound.playAudio("click")}),("all-check"===n||"all-answer"===n||"all-replay"===n)&&(EDUTSS.isDevMsg&&!a.includes("#")&&console.log("#D: all-check, all-answer, all-replay는 [data-quiz-id]가 아닌 ID로 연결"),(o=e.getEle("[data-quiz-type]",e.getEle(a))).forEach(function(e){let a=t.DATA[e.dataset.quizId],s;for(let o in i.dataset.popup&&(a.isDuplicationPopup=!0),a.totalControlBtns||(a.totalControlBtns=[]),a.totalControlBtns.push(i),a.totalControlById||(a.totalControlById=[]),s=!1,a.totalControlById)a.totalControlById[o]===i.dataset.quizTarget&&(s=!0);s||a.totalControlById.push(i.dataset.quizTarget),"all-replay"!==n&&(a.isTotalCheckBtn=!0)}))})},controlBtnHandler:function(i,a){let n=i.container.closest(".pop_finish");if(i.filledValues=i.userValue.filter(function(t){return""!==e.getText(t.join())}),void 0!==i.controlShowHide){if(i.controlShowHide)i.controlShowHide=!1,EDUTSS.quiz.syncControlBtn(i.qid);else if(!a){if(i.totalControlBtns){if("canvas"===i.type)e.addCls(i.totalControlBtns,"btn--show");else{let s=0,o=0;e.getEle("[data-quiz-type]",e.getEle(i.totalControlById)[0]).forEach(function(i){s+=t.DATA[i.dataset.quizId].userValue.filter(function(t){return""!==e.getText(t.join())}).length,o+=t.DATA[i.dataset.quizId].userValue.filter(function(t){return""===e.getText(t.join())}).length}),s?(e.addCls(i.totalControlBtns,"btn--show"),o||e.removeCls(i.totalControlBtns[1],"btn--show")):e.removeCls(i.totalControlBtns,"btn--show")}}else"canvas"===i.type||i.filledValues.length&&(!n||n&&this.checkEnableBtnCheck(i))?e.addCls(i.controlBtns,"btn--show"):(e.removeCls(i.controlBtns,"btn--show"),i.filledValues.length&&e.addCls(i.controlBtns[0],"btn--show"))}}},syncControlBtn:function(i,a){let n=t.DATA[i],s=n.controlBtns,o=s.length>0,l=n.container.closest(".pop_finish");if("result"===a){if(o&&s.forEach(function(t){t.dataset.quizBtn&&"view-user"!==t.dataset.quizBtn&&"view-answer"!==t.dataset.quizBtn&&("check"===t.dataset.quizBtn||"answer"===t.dataset.quizBtn)&&e.addCls(t,"on disabled"),n.isEmptyFeedback||"replay"!==t.dataset.quizBtn||e.addCls(t,"btn--show")}),n.totalControlBtns){let r=0;e.getEle("[data-quiz-type]",e.getEle(n.totalControlById[0])).forEach(function(i){r+=t.DATA[i.dataset.quizId].userValue.filter(function(t){return""===e.getText(t.join())}).length}),n.totalControlBtns.forEach(function(t){"all-replay"===t.dataset.quizBtn||e.hasCls(t,"btn--show")&&r||e.addCls(t,"on disabled"),n.isEmptyFeedback||"all-replay"!==t.dataset.quizBtn||e.addCls(t,"btn--show")})}EDUTSS.isDevMsg&&console.log("#D: 정답확인 버튼 제어")}else if("replay"===a){if(o&&s.forEach(function(t){t.dataset.quizBtn&&e.removeCls(t,"on disabled btn--show")}),n.totalControlBtns){n.totalControlBtns.forEach(function(t){t.closest(".btn_wrap.all")||e.removeCls(t,"on disabled btn--show")});let c=!0,d=e.getEle(n.totalControlBtns[0].dataset.quizTarget),u=e.getEle("[data-quiz-type]",d),h=u.length;for(let p=0;p<h;p++)e.getText(JSON.stringify(t.DATA[u[p].dataset.quizId].userValue)).length>=1&&(c=!1);c&&e.removeCls(n.totalControlBtns,"on btn--show disabled")}EDUTSS.isDevMsg&&console.log("#D: 다시풀기 버튼 제어")}else if(!n.controlShowHide){if(o){if("canvas"!==n.type&&!n.filledValues.length||l&&!this.checkEnableBtnCheck(n)){n.filledValues.length&&e.addCls(s[0],"btn--show");return}n.controlShowHide?e.removeCls(s,"btn--show"):e.addCls(s,"btn--show")}if(n.totalControlBtns){let g=0;e.getEle("[data-quiz-type]",e.getEle(n.totalControlById[0])).forEach(function(i){g+=t.DATA[i.dataset.quizId].userValue.filter(function(t){return""!==e.getText(t.join())}).length}),!g||n.controlShowHide?e.removeCls(n.totalControlBtns,"btn--show"):e.addCls(n.totalControlBtns,"btn--show")}}},detectScroll:function(t){let i=t.container.closest(".popup");i&&e.getEle("[data-layout-type='scroll']",i).forEach(function(e){EDUTSS.view.visibleScrollState(e)})},checkEnableBtnCheck:function(t){let i=!1;switch(t.type){case"multiple":i=e.getText(t.userValue.join()).length===e.getText(t.correctAnswer.join()).length;break;case"essay":let a=t.essayItems.length;for(let n=0;n<a;n++)if(e.getText(t.userValue[n].join()).length)i=!0;else{i=!1;break}break;case"draw":i=!!t.isActivity&&t.correctAnswer.length===t.filledValues.length;break;case"drag":i=!!t.isActivity&&t.dropItems.length===e.getEle(".drop--done",t.container).length||t.dropItems.length===e.getEle(".drop_area .drag_box",t.container).length}return i}}}();var EDUTSS=EDUTSS||{};EDUTSS.view=function(){let e=EDUTSS.util,t=EDUTSS.sound,i={slide:[],tab:[],scroll:[],zoom:[],drawing:[],checklist:[],showHide:[],popup:[]},a,n=(function t(i){let s,o=!1,l=!1,r=!1,c=!1;e.hasCls(i.target,"popup--container")&&(o=!0),i&&(s=i.composedPath&&i.composedPath()||i.path),s&&s.forEach(function(t){if(t.dataset&&t.dataset.popup&&(r=t),t.dataset&&t.dataset.layoutType&&"popup"===t.dataset.layoutType){o=!0,e.getEle("[data-popup]",t).forEach(function(t){e.hasCls(t,"on")&&(c=t,s.forEach(function(e){e.classList&&e.classList.contains("toast")&&(c=!1,EDUTSS.isDevMsg&&console.log("#D: 토스트 팝업 방어"))}))});return}t.classList&&t.classList.length>0&&(t.classList.contains("pop--open")?o=!0:t.classList.contains("btn")&&(l=!0))}),!1!==c&&(e.removeEvt(document.body,"click",n,{capture:!0}),c.click()),o||(EDUTSS.isDevMsg&&console.log("#D: 팝업 외곽 클릭, 팝업 닫음, EDUTSS.isPopupOutSideClose => "+EDUTSS.isPopupOutSideClose),e.removeEvt(document.body,"click",n,{capture:!0}),EDUTSS.isPopupDisableEvent?(EDUTSS.view.closePopup(i),i.stopPropagation()):r&&e.hasCls(r,"on")?(a[0]&&EDUTSS.view.closePopup(a[0],a[1],a[2]),i.stopPropagation()):EDUTSS.view.closePopup(i))}).bind(this);return{toastOutHandler:n,initViewType:function(){let t=e.getEle("[data-layout-type]");t.forEach(function(e){switch(e.dataset.layoutType){case"slide":EDUTSS.view.initSlide(e);break;case"tab":EDUTSS.view.initTab(e);break;case"scroll":EDUTSS.view.initScroll(e)}}),this.initPopup(),this.initZoom({rate:.2,step:4,way:50}),this.initShowHide(),this.initCheckList(),this.initPageMove(),this.initDownload(),this.initDrawing({type:"pen,eraser,reset",color:"000000,ffffff,ff0000,ffba00,00d05d,0600ff",thick:"2px,4px,8px",default:"pen,ffba00,2px"}),this.viewReset(),this.showIndivReplay(),this.initTextAreaScroll()},initSlide:function(a){let n=i.slide,s=n.length,o={slideId:"slide-"+e.isNum(s+1),container:a,slideAnimate:a.dataset.slideMove||!1,slideList:e.getEle("[data-slide-list]",a),btnPrev:e.getEle("[data-slide-btn='prev']",a),btnNext:e.getEle("[data-slide-btn='next']",a),btnDotted:e.getEle("[data-slide-dot]",a),thisNum:0},l;if(o.slideListLen=o.slideList.length,a.dataset.slideDot&&"true"===a.dataset.slideDot&&0===e.getEle(".move--slider",a).length){let r=e.createEle("div",{class:"move--slider"},a),c;for(let d=0;d<o.slideListLen;d++)c=e.createEle("div",{class:"btn slide dot","data-slide-dot":String(d)},r),o.slideList[d].dataset.dotName&&(c.textContent=o.slideList[d].dataset.dotName,e.addCls(c,"has--name"));o.btnDotted=e.getEle("[data-slide-dot]",a)}if(a.dataset.slideNum&&"true"===a.dataset.slideNum&&0===e.getEle(".slide--num",a).length){let u=e.createEle("div",{class:"slide--num"},a),h=e.createEle("div",{class:"slide num current"},u),p=e.createEle("div",{class:"slide num total"},u);h.innerText=1,p.innerText=o.slideListLen,o.currentNum=h,o.totalNum=p}n.push(o),l=n[s],a.dataset.slideId=l.slideId,EDUTSS.isDevMsg&&console.log("#D: 슬라이드 id 부여, 슬라이드 데이터 설정"),EDUTSS.isDevMsg&&console.log(o),l.slideAnimate&&EDUTSS.view.getSlideRect(l),EDUTSS.view.moveSlide(l,0),l.slideListLen>1?(e.addEvt(l.btnPrev,"click",function(e){EDUTSS.view.moveSlide(l,e),t.playAudio("slide")}),e.addEvt(l.btnNext,"click",function(e){EDUTSS.view.moveSlide(l,e),t.playAudio("slide")}),e.addEvt(l.btnDotted,"click",function(e){EDUTSS.view.moveSlide(l,e),t.playAudio("slide")}),!e.getEle(".slide--swipe--area",l.container).length&&!e.getEle("[data-quiz-type]",l.container).length&&e.getEle("figure, img",l.container).length&&(e.getEle("figure",l.container).length?e.getEle("figure",l.container).forEach(function(t){e.addCls(t.parentElement,"slide--swipe--area")}):e.getEle("img",l.container).length&&e.getEle("img",l.container).forEach(function(t){e.addCls(t.parentElement,"slide--swipe--area")})),EDUTSS.ui.addSwipe(e.getEle(".slide--swipe--area",l.container),l)):(e.addCls(l.btnPrev,"btn--hide"),e.addCls(l.btnNext,"btn--hide"))},getSlideRect:function(t){if(t.slidePosition)return;let i=e.getEle(".slide_inner",t.container)[0];t.slideWidth=i.getBoundingClientRect().width/EDUTSS.scaleValue.zoom,t.slideHeight=i.getBoundingClientRect().height/EDUTSS.scaleValue.zoom,0!==t.slideWidth?(t.slidePosition=!0,i.style.width=t.slideWidth+"px",i.style.height=t.slideHeight+"px",t.slideList.forEach(function(e,i){e.style.position="absolute",e.style.left=t.slideWidth*i+"px",e.style.top="0px"})):t.slideList.forEach(function(e,t){e.style.position="absolute",e.style.top="0px",e.style.left=100*t+"%"})},moveSlide:function(a,n){let s,o,l,r;if(!a.slideId){for(r=0,s=a.dataset.slideId,o=i.slide;r<o.length;r++)if(o[r].slideId===s){a=o[r];break}}if(!(n.target&&n.target.dataset.slideDot&&e.hasCls(n.target,"on"))){if(a.thisNum>=0&&a.thisNum<a.slideListLen&&t.stopCurrentSound(a.slideList[a.thisNum]),"number"==typeof n)a.thisNum=n;else{let c=n.currentTarget;c.dataset.slideBtn?("prev"===c.dataset.slideBtn&&(a.thisNum-=1),"next"===c.dataset.slideBtn&&(a.thisNum+=1)):c.dataset.slideDot&&(a.thisNum=c.dataset.slideDot)}a.thisNum<1?(a.thisNum=0,e.removeCls(a.btnPrev,"btn--show"),e.addCls(a.btnNext,"btn--show")):a.thisNum>=a.slideListLen-1?(a.thisNum=a.slideListLen-1,e.addCls(a.btnPrev,"btn--show"),e.removeCls(a.btnNext,"btn--show")):(e.addCls(a.btnPrev,"btn--show"),e.addCls(a.btnNext,"btn--show")),e.getEle("[data-slide-list='"+a.thisNum+"']",a.container).length&&(l=a.slideList[a.thisNum],a.slideAnimate&&!a.slidePosition&&EDUTSS.view.getSlideRect(a),a.slideAnimate&&a.slidePosition?"left"===a.slideAnimate?a.slideList.forEach(function(e,t){e.style.left=a.slideWidth*t-a.slideWidth*a.thisNum+"px"}):a.slideList.forEach(function(e,t){e.style.left=100*t-100*a.thisNum+"%"}):(e.removeCls(a.slideList,"slide--show"),e.addCls(l,"slide--show")),a.btnDotted.forEach(function(t){t.dataset.slideDot==a.thisNum?e.addCls(t,"on"):e.removeCls(t,"on")}),a.currentNum&&(a.currentNum.innerText=Number(a.thisNum)+1),EDUTSS.view.viewUpdate(l),EDUTSS.complete&&EDUTSS.complete.slide(a),EDUTSS.isDevMsg&&console.log("#D: 슬라이드 이동"))}},initTab:function(a){let n=i.tab,s=n.length,o={tabId:"tab-"+e.isNum(s+1),container:a,tabNav:e.getEle("[data-tab-nav]",e.getEle(".tab--nav",a)[0]),tabList:[],thisTab:0,moveBtn:e.getEle("[data-tab-move]",a)},l;o.tabNav.forEach(function(t){o.tabList.push(e.getEle("[data-tab-list='"+t.dataset.tabNav+"']",a)[0])}),o.tabLen=o.tabNav.length;for(let r=0;r<o.tabLen;r++)o.tabNav[r].dataset.viewedList=!1;n.push(o),l=n[s],a.dataset.tabId=l.tabId,EDUTSS.isDevMsg&&console.log("#D: 탭 id 부여, 탭 데이터 설정"),EDUTSS.isDevMsg&&console.log(o),EDUTSS.view.moveTab(l,e.getEle(".duplication--area",o.tabList[0]).length&&o.tabNav[0].textContent.includes("나의 답안")?o.tabNav[1].dataset.tabNav:o.tabNav[0].dataset.tabNav),e.addEvt(l.tabNav,"click",function(i){e.hasCls(i.currentTarget,"disabled")||(EDUTSS.view.moveTab(l,i.currentTarget.dataset.tabNav),t.playAudio("tab"))}),e.addEvt(l.moveBtn,"click",function(e){let i,a=(i=0,l.tabNav.forEach(function(e,t){l.currNav[0]===e&&(i=t)}),i);"next"===e.currentTarget.dataset.tabMove?a+1<l.tabNav.length&&(EDUTSS.view.moveTab(l,l.tabNav[a+1].dataset.tabNav),t.playAudio("tab")):"prev"===e.currentTarget.dataset.tabMove&&a-1>=0&&(EDUTSS.view.moveTab(l,l.tabNav[a-1].dataset.tabNav),t.playAudio("tab"))})},moveTab:function(a,n){let s,o,l;if(!a.tabId){for(l=0,s=a.dataset.tabId,o=i.tab;l<o.length;l++)if(o[l].tabId===s){a=o[l];break}}t.stopCurrentSound(a.tabList[a.thisTab]),a.thisTab=n,a.currNav=e.getEle("[data-tab-nav='"+n+"']",a.container),a.currList=e.getEle("[data-tab-list='"+n+"']",a.container),e.removeCls(a.tabNav,"on"),e.removeCls(a.tabList,"tab--show"),e.addCls(a.currNav,"on"),e.addCls(a.currList,"tab--show"),a.currNav[0].dataset.viewedList=!0,a.currList.forEach(function(t){e.getEle(".duplication--area",t).forEach(function(t){e.getEle("textarea",t).forEach(function(t){t.style.height=e.hasCls(t,"scroll--content")?"100%":t.scrollHeight+"px"})})}),EDUTSS.view.viewUpdate(a.currList),EDUTSS.complete&&EDUTSS.complete.tab(a),EDUTSS.isDevMsg&&console.log("#D: 탭 이동")},initScroll:function(t){function a(t,i){this.container=t,this.container.dataset.scrollId="scroll-"+(i+1),this.content=e.getEle(".scroll--content",t)[0],this.containerHeight=parseInt(e.getStyle(t).height)||0,this.barTop=0,this.barLeft=0,this.scrollValue=0,this.scrollFlow="vertical",e.hasCls(t,"is--horizontal")&&(this.scrollFlow="horizontal"),Object.defineProperties(this,{containerSize:{get:function(){return this.content.getBoundingClientRect()}},containerTop:{get:function(){return this.containerSize.top}},containerLeft:{get:function(){return this.containerSize.left}},contentHeight:{get:function(){return this.containerSize.height}},contentWidth:{get:function(){return this.containerSize.width}},railSize:{get:function(){return this.barRail.getBoundingClientRect()}},railHeight:{get:function(){return this.railSize.bottom-this.railSize.top}},railWidth:{get:function(){return this.railSize.right-this.railSize.left}},barSize:{get:function(){return this.barHandler.getBoundingClientRect()}},barHeight:{get:function(){return(this.barSize.bottom-this.barSize.top)/2}},barWidth:{get:function(){return(this.barSize.right-this.barSize.left)/2}},heightRate:{get:function(){return(this.contentHeight-(this.contentHeight-this.railHeight)-2*this.barHeight)/EDUTSS.scaleValue.zoom}},widthRate:{get:function(){return(this.contentWidth-(this.contentWidth-this.railWidth)-2*this.barWidth)/EDUTSS.scaleValue.zoom}},barHightRate:{get:function(){return(this.barTop+this.barHeight)/(this.railHeight-this.barHeight)}},barWidthRate:{get:function(){return(this.barLeft+this.barWidth)/(this.railWidth-this.barWidth)}},scrollHeight:{get:function(){return this.content.scrollHeight*EDUTSS.scaleValue.zoom}},scrollWidth:{get:function(){return this.content.scrollWidth*EDUTSS.scaleValue.zoom}},containerHeightRate:{get:function(){return this.content.scrollTop/((this.scrollHeight-this.contentHeight)/EDUTSS.scaleValue.zoom)}},containerWidthRate:{get:function(){return this.content.scrollLeft/((this.scrollWidth-this.contentWidth)/EDUTSS.scaleValue.zoom)}},coord:{get:function(){return this.coordX,this.coordY},set:function(e){this.coordX=e.touches?e.touches[0].clientX:e.clientX,this.coordY=e.touches?e.touches[0].clientY:e.clientY}}})}a.prototype={init:function(){this.create(),this.addEvt(),this.ready()},create:function(){return this.barContainer=e.createEle("div",{class:"scroll--bar"},this.container),this.barRail=e.createEle("div",{class:"scroll--rail"},this.barContainer),this.barCurrent=e.createEle("div",{class:"scroll--current"},this.barContainer),this.barHandler=e.createEle("div",{class:"scroll--handle"},this.barContainer),this.moveControl=e.createEle("div",{class:"scroll--move"},this.container),this.barUp=e.createEle("div",{class:"scroll--move--btn scroll--up"},this.moveControl),this.barDown=e.createEle("div",{class:"scroll--move--btn scroll--down"},this.moveControl),this},addEvt:function(){let t=this;e.addEvt(this.barRail,"down",this.startDrag.bind(this)),e.addEvt(this.barHandler,"down",this.dragBarHandle.bind(this)),e.addEvt(this.barHandler,"up",function(){e.removeCls(t.barHandler,"scroll--dragging")}),e.addEvt(this.barUp,"down",this.scrollMove.bind(this)),e.addEvt(this.barDown,"down",this.scrollMove.bind(this)),e.addEvt(this.content,"scroll",this.scrollHandle.bind(this))},ready:function(){let t=e.hasCls(this.container,"input")||e.hasCls(this.container,"quiz--input")?10:0;"vertical"===this.scrollFlow&&this.content.clientHeight+t>=this.content.scrollHeight?e.addCls(this.container,"scroll--hide"):(e.removeCls(this.container,"scroll--hide"),e.getEle(".solution--show",this.container).length&&(this.content.scrollTop=this.content.scrollHeight)),"sci"===EDUTSS.isSubject&&("vertical"===this.scrollFlow?this.barHandler.style.height=this.railHeight-(this.scrollHeight-this.contentHeight)+"px":"horizontal"===this.scrollFlow&&(this.barHandler.style.width=this.railWidth-(this.scrollWidth-this.contentWidth)+"px"));let i=!!e.getEle(".viewed--popup",this.container.closest(".toast_area")).length;"bottom"!==this.container.dataset.startPosition||i||(this.content.scrollTop=(this.scrollHeight-this.contentHeight)/EDUTSS.scaleValue.zoom)},dragBarHandle:function(t){let i=this,a=i.startDrag.bind(this);t.preventDefault(),e.addEvt(window,"move",a),e.addEvt(window,"up",function(){e.removeEvt(window,"move",a),e.removeCls(i.barHandler,"scroll--dragging")})},startDrag:function(t){this.coord=t,"vertical"===this.scrollFlow?(this.barTop=(this.coordY-this.containerTop-this.barHeight)/EDUTSS.scaleValue.zoom,this.barTop=this.barTop<=0?0:this.barTop>=this.heightRate?this.heightRate:this.barTop,this.scrollValue=(this.scrollHeight-this.contentHeight)*(this.barTop<=.1?0:this.barHightRate),this.barHandler.style.top=this.barTop+"px",this.barCurrent.style.height=this.barTop+"px",this.content.scrollTop=parseFloat(this.scrollValue).toFixed(2)):"horizontal"===this.scrollFlow&&(this.barLeft=(this.coordX-this.containerLeft-this.barWidth)/EDUTSS.scaleValue.zoom,this.barLeft=this.barLeft<=0?0:this.barLeft>=this.widthRate?this.widthRate:this.barLeft,this.scrollValue=(this.scrollWidth-this.contentWidth)*(this.barLeft<=.1?0:this.barWidthRate),this.barHandler.style.left=this.barLeft+"px",this.barCurrent.style.width=this.barLeft+"px",this.content.scrollLeft=parseFloat(this.scrollValue).toFixed(2)),e.addCls(this.barHandler,"scroll--dragging"),e.isTouch||t.preventDefault()},scrollHandle:function(){e.hasCls(this.barHandler,"scroll--dragging")||("vertical"===this.scrollFlow?(this.barTop=this.heightRate*this.containerHeightRate,this.barHandler.style.top=this.barTop+"px",this.barCurrent.style.height=this.barTop+"px"):"horizontal"!==this.scrollFlow||(this.barLeft=this.widthRate*this.containerWidthRate,this.barHandler.style.left=this.barLeft+"px",this.barCurrent.style.width=this.barLeft+"px"))},scrollMove:function(t){if("vertical"===this.scrollFlow){let i=(this.scrollHeight-this.contentHeight)*.1;e.hasCls(t.currentTarget,"scroll--up")?this.content.scrollTop-i>0?this.content.scrollTop=this.content.scrollTop-i:this.content.scrollTop=0:e.hasCls(t.currentTarget,"scroll--down")&&(this.content.scrollTop+i<this.scrollHeight-this.contentHeight?this.content.scrollTop=this.content.scrollTop+i:this.content.scrollTop=this.scrollHeight-this.contentHeight)}else if("horizontal"===this.scrollFlow){let a=(this.scrollWidth-this.contentWidth)*.1;e.hasCls(t.currentTarget,"scroll--up")?this.content.scrollLeft-a>0?this.content.scrollLeft=this.content.scrollLeft-a:this.content.scrollLeft=0:e.hasCls(t.currentTarget,"scroll--down")&&(this.content.scrollLeft+a<this.scrollWidth-this.contentWidth?this.content.scrollLeft=this.content.scrollLeft+a:this.content.scrollLeft=this.scrollWidth-this.contentWidth)}}};let n=i.scroll,s=n.length;n[s]=new a(t,s),n[s].init(),EDUTSS.isDevMsg&&console.log("#D: 스크롤 생성")},initPopup:function(){EDUTSS.isPopupOutSideClose=!0,EDUTSS.isPopupDisableEvent=!1,e.addEvt(e.getEle("[data-popup]"),"click",function(i){let a=i.currentTarget;if(!(function t(i){if(!i.dataset.quizTarget)return!1;let a=i.dataset.quizTarget,n,s=!1;return a.includes("#")?(n=e.getEle(".is--not--activity",e.getEle(a))).length>0:e.hasCls(e.getEle("[data-quiz-id='"+a+"']")[0],"is--not--activity")}(a)||function t(i){if(!i.dataset.quizTarget)return!1;let a=i.dataset.quizTarget,n,s=!1;return(n=a.includes("#")?e.getEle("[data-quiz-feed='hint']",e.getEle(a)):e.getEle("[data-quiz-feed='hint']",e.getEle("[data-quiz-id='"+a+"']")[0])).forEach(function(t){e.hasCls(t,"hint--show")&&!e.hasCls(i,"viewed--duplication--hint")&&(e.addCls(i,"viewed--duplication--hint"),s=!0)}),s}(a))){if(""===a.dataset.popup){dtDevAlert("내용 확인 중입니다.");return}!e.hasCls(a,"on")&&(a.dataset.quizBtn||t.playAudio("popup")),EDUTSS.view.openPopup(i),EDUTSS.scoThisGoalBtn&&EDUTSS.scoLastGoalBtn&&(e.hasCls(i.currentTarget.parentNode,"last_goal")?e.addCls(EDUTSS.scoThisGoalBtn,"off"):e.hasCls(i.currentTarget.parentNode,"this_goal")&&e.addCls(EDUTSS.scoLastGoalBtn,"off"))}}),e.addEvt(e.getEle("[data-popup-btn='close']"),"click",function(e){EDUTSS.view.closePopup(e)}),e.addEvt(e.getEle("[data-msg]"),"click",function(e){t.playAudio("popup"),EDUTSS.view.openMsg(e)})},openPopup:function(s,o){let l=o?null:s.currentTarget,r=o||l.dataset.popup,c,d,u=!1,h=l&&l.dataset.videoAutoplay||null,p=l&&l.dataset.tabIdx||null,g=l&&l.dataset.slideIdx||null;if(e.hasCls(l.parentNode,"step--popup")&&l.parentNode.previousElementSibling&&!e.hasCls(l.parentNode.previousElementSibling,"viewed--popup")&&(u=!0),u?(d=l.nextElementSibling,e.addCls(l.parentNode.previousElementSibling,"animated bounceOn"),setTimeout(function(){e.removeCls(l.parentNode.previousElementSibling,"animated bounceOn")},1e3)):r.includes("#")?(c=e.getEle(r),e.hasCls(c,"toast")&&(c.dataset.isToast=!0)):"inner"===r?(c=e.getEle("[data-layout-type='popup']",l)[0]).dataset.isToast=!0:"next"===r?l.nextElementSibling&&(d=l.nextElementSibling):"prev"===l&&l.previousElementSibling&&(d=l.previousElementSibling),d&&"popup"===d.dataset.layoutType&&((c=d).dataset.isToast=!0),c){let m=!1;if(l&&l!==s.target&&"inner"===r&&e.hasCls(c,"pop--open")){if(EDUTSS.isPopupOutSideClose)m=!0;else{let f;s&&(f=s.composedPath&&s.composedPath()||s.path),f&&f.forEach(function(e){e.dataset&&"popup"===e.dataset.layoutType&&(m=!0)})}}if(m){EDUTSS.isDevMsg&&console.log("#D: 토스트 본문 클릭 - 닫기 방어");return}if(c.dataset.isToast?e.hasCls(c,"pop--open")?(EDUTSS.view.closePopup(s,c,l),EDUTSS.isDevMsg&&console.log("#D: 토스트 닫음")):("true"!==c.dataset.overlay&&EDUTSS.view.closePopup(),C(),l&&(EDUTSS.view.setPopupPosition(c,l),EDUTSS.view.setTailPosition(c,l)),EDUTSS.isDevMsg&&console.log("#D: 토스트 팝업 열기"),EDUTSS.isDevMsg&&console.log(c),u&&setTimeout(function(){EDUTSS.view.closePopup(s,c,l)},1e4)):(t.stopActiveSound(),EDUTSS.view.closePopup(),C(),e.addCls(c.parentNode,"active"),l&&e.hasCls(c,"word")&&"0px"===e.getStyle(c).top&&EDUTSS.view.setPopupPosition(c,l),EDUTSS.isDevMsg&&console.log("#D: 팝업 열기"),EDUTSS.isDevMsg&&console.log(c)),!u){if(e.getEle(".duplication--area",c).length&&e.getEle(".tab--nav",c).length&&e.getEle("[data-tab-nav]",c)[0].textContent.includes("나의 답안")&&(p=e.getEle("[data-tab-nav]",c)[1].dataset.tabNav),p){let E=e.getEle("[data-layout-type='tab']",c)[0];i.tab.forEach(function(e){e.tabId===E.dataset.tabId&&EDUTSS.view.moveTab(e,Number(p))}),EDUTSS.isDevMsg&&console.log("#D: 탭 이동 => "+p)}if(g){let S=e.getEle("[data-layout-type='slide']",c)[0];i.slide.forEach(function(e){e.slideId===S.dataset.slideId&&EDUTSS.view.moveSlide(e,Number(g))}),EDUTSS.isDevMsg&&console.log("#D: 슬라이드 이동 => "+g)}if(h){let v=e.getEle("[data-media-control]",c)[0].dataset.mediaId;for(let T in EDUTSS.mediaPlayer)EDUTSS.mediaPlayer[T].mediaId===v&&(EDUTSS.mediaPlayer[T].mediaLoad(),EDUTSS.mediaPlayer[T].mediaPlay())}c.dataset.duplication&&this.duplicationObject(c)}if(EDUTSS.isPopupOutSideClose){let D=!1;c.dataset.isToast&&!c.dataset.hasClose?D=!0:e.hasCls(c,"is--outside--close")&&(outSizeEvent=!0),D&&(s&&s.stopPropagation(),e.addEvt(document.body,"click",n,{capture:!0}))}EDUTSS.isPopupDisableEvent||(a=[s,c,l]),EDUTSS.view.viewUpdate(c,"disabled_sound"),e.addCls(l,"viewed--popup"),EDUTSS.complete&&EDUTSS.complete.openPopup(c,l)}function C(){e.addCls(l,"on"),e.addCls(c,"pop--open"),e.addCls(document.body,"isOnPopup"),EDUTSS.isOpenPopupObject=c}},closePopup:function(i,s,o){let l,r=null,c;function d(t){if(t.dataset.duplication)e.getEle(".duplication--area",t).forEach(function(e){e.children.innerHTML=""})}e.hasCls(document.body,"isOnPopup")&&(EDUTSS.isDevMsg&&console.log("#D: 팝업 닫기"),s&&"string"==typeof s&&s.includes("#")?(l=e.getEle(s),r=e.getEle("[data-popup='"+s.replace("#","")+"']")):s&&"object"==typeof s?(l=s,i.stopPropagation()):i&&i.currentTarget.dataset&&"close"===i.currentTarget.dataset.popupBtn?(l=i.currentTarget.closest("[data-layout-type='popup']"),o&&(r=o),i.stopPropagation()):l=e.getEle("[data-layout-type='popup']"),e.removeCls(l,"pop--open"),r||e.removeCls(e.getEle("[data-popup]"),"on"),e.removeCls(r,"on"),l.dataset&&l.dataset.isToast&&(c=!0),EDUTSS.isOpenPopupObject&&t.stopCurrentSound(EDUTSS.isOpenPopupObject),EDUTSS.isOpenPopupObject=null,!c&&(e.removeCls(document.body,"isOnPopup"),e.removeCls(e.getEle(".popup--container"),"active"),n&&e.removeEvt(document.body,"click",n,{capture:!0}),EDUTSS.isPopupDisableEvent||(a=[])),l.length?l.forEach(function(e){d(e)}):d(l),EDUTSS.scoThisGoalBtn&&EDUTSS.scoLastGoalBtn&&(e.removeCls(EDUTSS.scoThisGoalBtn,"off"),e.removeCls(EDUTSS.scoLastGoalBtn,"off")),EDUTSS.complete&&EDUTSS.complete.closeAllPopup())},duplicationObject:function(t){function i(t,i){e.copyPaste(t,i),e.getEle("[data-quiz-type]",t).forEach(function(i){e.hasCls(t,"duplication--answer")?EDUTSS.quiz.duplicationResult(i,"answer"):EDUTSS.quiz.duplicationResult(i,"default")})}e.getEle("[data-duplication-target]",t).forEach(function(t){let a=e.getEle("[data-duplication-object="+t.dataset.duplicationTarget+"]")[0],n=e.getEle("[data-duplication-name]",t),s;a&&n.length>0?n.forEach(function(t){(s=e.getEle("[data-duplication-sublist='"+t.dataset.duplicationName+"']",a)[0])&&i(t,s)}):(s=a)&&i(t,a),e.getEle(".animated",t).forEach(function(t){e.removeCls(t,"animated")})})},senseClosePopupEvent:function(t){EDUTSS.isPopupOutSideClose&&e.hasCls(document.body,"isOnPopup")&&!t.currentTarget.closest("[data-layout-type='popup']")&&EDUTSS.view.closePopup()},setPopupPosition:function(t,i){if(t.dataset.isPosition)return;let a=e.getEle("#wrap").getBoundingClientRect(),n=i.getBoundingClientRect(),s=t.getBoundingClientRect(),o=!1,l;i.dataset.quizTarget&&(o=!0,l=(i=i.dataset.quizTarget.includes("#")?e.getEle(i.dataset.quizTarget):e.getEle("[data-quiz-id='"+i.dataset.quizTarget+"']")[0]).closest(".content").getBoundingClientRect(),n=i.getBoundingClientRect()),o?(e.hasCls(t,"up")?t.style.top=(l.top-s.height)/EDUTSS.scaleValue.zoom+"px":e.hasCls(t,"down")&&(t.style.top=(l.top+l.height)/EDUTSS.scaleValue.zoom+"px"),EDUTSS.isDevMsg&&console.log("#D: 답안 top top 좌표 확인"),t.dataset.isPosition=!0):e.hasCls(t,"toast")&&(a.width/3*2<n.left?e.addCls(t,"right"):a.width/3>n.left?e.addCls(t,"left"):e.addCls(t,"center"),EDUTSS.isDevMsg&&console.log("#D: 토스트 팝업 left, right 추가"),t.dataset.isPosition=!0)},setTailPosition:function(t,i){let a=e.getEle(".tail",t)[0];if(a&&!a.dataset.tailX&&!i.dataset.quizTarget&&a){let n=i.getBoundingClientRect(),s=t.getBoundingClientRect(),o=a.getBoundingClientRect(),l=(n.left-s.left+n.width/2-o.width/2)/EDUTSS.scaleValue.zoom||o.left;a.dataset.tailX=l,a.style.left=l+"px"}},openMsg:function(t){let i=t.currentTarget,a="#"+i.dataset.popup,n=e.getEle(a);e.addCls(n,"msg--open"),setTimeout(function(){e.removeCls(n,"msg--open")},2e3)},initPageMove:function(){e.addEvt(e.getEle("[data-prev-page]"),"click",function(i){e.hasCls(i.currentTarget,"disabled")||(EDUTSS.view.pageMove(i),t.playAudio("click"))}),e.addEvt(e.getEle("[data-next-page]"),"click",function(i){e.hasCls(i.currentTarget,"disabled")||(EDUTSS.view.pageMove(i),t.playAudio("click"))}),e.addEvt(e.getEle("[data-move-page]"),"click",function(i){if(EDUTSS.isDTBOOK){let a=i.currentTarget.dataset.movePage;e.hasCls(i.currentTarget,"disabled")||(parent.GO_PAGE_LOAD(a),t.playAudio("click"))}else e.hasCls(i.currentTarget,"disabled")||(EDUTSS.view.pageMove(i),t.playAudio("click"))})},pageMove:function(e){let t="",i="";i="string"==typeof e?e:(t=e.target).dataset.movePage,setTimeout(function(){location.href=i},200)},initCheckList:function(){let a=e.getEle("[data-func-check]"),n=i.checklist,s=n.length,o,l;a.forEach(function(t){0===(o={checkId:"checklist-"+e.isNum(s+1),container:t,checklist:e.getEle("[data-check-list]",t),type:t.dataset.funcCheck,replayBtn:e.getEle("[data-check-replay]",t),groups:{}}).replayBtn.length&&(o.replayBtn=e.getEle("[data-check-replay='"+t.getAttribute("id")+"']")),o.feedback=e.getEle(".check--feedback .feed",t),o.length=o.checklist.length,o.checkName={},o.checklist.forEach(function(e){let t=e.dataset.checkGroup;t&&(o.groups[t]||(o.groups[t]=[]),o.groups[t].push(e))});for(let i=0;i<o.length;i++)l=o.checklist[i].dataset.checkList,o.checkName[l]||(o.checkName[l]=!1);o.quizLink=o.container.closest("[data-quiz-type]"),n.push(o),s=n.length,t.dataset.checkId=o.checkId,EDUTSS.isDevMsg&&console.log("#D: 체크 리스트 데이터 설정"),EDUTSS.isDevMsg&&console.log(o)}),n.forEach(function(t){e.addEvt(t.checklist,"click",function(e){EDUTSS.view.isCheckList(t,e)})}),e.addEvt(e.getEle("[data-check-replay]"),"click",function(i){let a=i.currentTarget,n=a.dataset.checkReplay?e.getEle("#"+a.dataset.checkReplay):a.closest("[data-func-check]");EDUTSS.view.resetCheckList(n),t.playAudio("click")}),EDUTSS.isDTBOOK&&this.loadCheckData()},isCheckList:function(i,a){let n=a.currentTarget,s=n.dataset.checkList.split("-")||"";switch(EDUTSS.isDevMsg&&console.log("#D: checkType(checkbox, sum, ...) => "+i.type),e.getEle(".star",n).length>0||n.closest(".pop_rating")?(!e.hasCls(n,"check--on")||n.nextElementSibling&&e.hasCls(n.nextElementSibling,"check--on"))&&t.playAudio("star"):e.hasCls(n,"check--on")||t.playAudio("check"),i.type){case"checkbox":e.hasCls(n,"check--on")?e.removeCls(n,"check--on"):e.addCls(n,"check--on");break;case"one":if(e.hasCls(n,"check--on")){e.removeCls(n,"check--on");return}i.checklist.forEach(function(t){t.dataset.checkList===n.dataset.checkList&&e.removeCls(t,"check--on")}),e.addCls(n,"check--on");break;case"sum":let o=n.dataset.checkGroup,l=!e.hasCls(n.nextElementSibling,"check--on"),r,c;if(e.hasCls(n,"check--on")){if(r=!1,o)for(c=0;c<i.length;c++){let d=i.checklist[c];d.dataset.checkGroup===o&&(l?e.removeCls(d,"check--on"):(d===n.nextElementSibling&&(r=!0),r&&e.removeCls(d,"check--on")))}else{for(c=0;c<i.length;c++){let u=i.checklist[c];u===n&&(r=!0),r&&e.removeCls(u,"check--on")}e.addCls(n,"check--on")}}else if(o)for(c=0;c<i.length&&(i.checklist[c].dataset.checkGroup===o&&e.addCls(i.checklist[c],"check--on"),i.checklist[c]!==n);c++);else for(c=0;c<i.length&&(e.addCls(i.checklist[c],"check--on"),i.checklist[c]!==n);c++);break;default:if(e.hasCls(n,"check--on"))return;e.removeCls(i.checklist,"check--on"),e.addCls(n,"check--on")}if(i.checklist.forEach(function(t){e.hasCls(t,"check--on")?(e.getEle(".check--input",t)[0].checked=!0,i.checkName[t.dataset.checkList]=!0):e.getEle(".check--input",t)[0].checked=!1}),e.addCls(i.replayBtn,"btn--show"),i.feedback.length>0){let h=e.getEle(".check--on",i.container).length;e.removeCls(i.feedback,"show"),h&&e.addCls(i.feedback[h-1],"show"),setTimeout(function(){t.playAudio("showAnswer")},1200)}if(e.hasCls(n,"toggle")&&("true"===s[1]?(s[1]=!1,n.dataset.checkList=s[0]+"-false"):"false"===s[1]&&(s[1]=!0,n.dataset.checkList=s[0]+"-true"),EDUTSS.isDevMsg&&console.log("#D: check toggle dataset 변환")),i.quizLink){let p=EDUTSS.quizData.DATA[i.quizLink.dataset.quizId];EDUTSS.quizData.addQuizActivity(p,!0),EDUTSS.quiz.controlBtnHandler(p,"isViewCheckLink")}EDUTSS.complete&&EDUTSS.complete.checkList(i,n)},resetCheckList:function(t){let a,n;for(n in i.checklist)t.dataset.checkId===i.checklist[n].checkId&&(a=i.checklist[n]);for(n in a.checklist.forEach(function(t){e.removeCls(t,"check--on"),e.getEle("input",t).forEach(function(e){e.checked=!1,EDUTSS.isDTBOOK&&(e.id&&(e.checked=!1),"function"==typeof parent.API_ANNOTATION_INPUT_DELETE&&e.id&&parent.API_ANNOTATION_INPUT_DELETE(e.id))});let i=t.dataset.checkList.split("-");i.length>1&&e.hasCls(t,"toggle")&&"true"===i[1]&&(i[1]=!1,t.dataset.checkList=i[0]+"-false"),EDUTSS.isDevMsg&&console.log("#D: 체크 리스트 초기화")}),a.checkName)a.checkName[n]=!1;a.feedback&&e.removeCls(a.feedback,"show"),a.replayBtn&&e.removeCls(a.replayBtn,"btn--show")},loadCheckData:function(){let t=e.getEle("[data-check-list] .check--input"),a=[],n,s=!1,o=setInterval(function(){if(s){let l=e.getEle("[data-func-check]"),r;l.forEach(function(t){for(let a in i.checklist)t.dataset.checkId===i.checklist[a].checkId&&((r=i.checklist[a]).replayBtn&&e.addCls(r.replayBtn,"btn--show"),r.checklist.forEach(function(t){e.hasCls(t,"check--on")&&(r.checkName[t.dataset.checkList]=!0)}))}),clearInterval(o);return}t.forEach(function(t){if((n=t.getAttribute("id"))&&(-1!==a.indexOf(n)&&clearInterval(o),!0===t.checked)){a.push(n),s=!0;let i=t.closest("[data-check-list]");!0===t.checked&&e.addCls(i,"check--on")}})},200);setTimeout(function(){clearInterval(o)},7e3)},getCheckActivity:function(t){let a,n,s=!0,o=[];for(n in i.checklist)t.dataset.checkId===i.checklist[n].checkId&&(a=i.checklist[n]);if(a){for(n in a.checkName)!1===a.checkName[n]&&(s=!1);for(let l in a.groups){let r=a.groups[l];for(let c=0;c<r.length;c++){let d=r[c];if(e.hasCls(d,"check--on")){o.push(!0);break}}s=o.length===Object.keys(a.groups).length}return s}},initShowHide:function(){let i=e.getEle("[data-func-show]"),a=e.getEle("[data-show-all]");i.forEach(function(i){let a=e.getEle("[data-show-idx]",i),n,s,o;"all"===i.dataset.funcShow&&e.addCls(a,"disabled"),EDUTSS.isDevMsg&&console.log("#D: showHideType(toggle, one, all, show, ...) => "+i.dataset.funcShow),e.addEvt(a,"click",function(a){switch(n=a.currentTarget,s=e.getEle("[data-show-idx='"+n.dataset.showIdx+"']",i),o=e.getEle("[data-show-obj='"+n.dataset.showIdx+"']",i),i.dataset.funcShow){case"toggle":e.hasCls(n,"on")?(e.removeCls(o,"obj--show"),e.removeCls(s,"on")):(e.addCls(o,"obj--show"),e.addCls(s,"on"));break;case"one":e.removeCls(e.getEle("[data-show-obj]",i),"obj--show"),e.removeCls(e.getEle("[data-show-idx]",i),"on disabled"),e.addCls(o,"obj--show"),e.addCls(n,"on disabled");break;default:e.addCls(o,"obj--show"),e.addCls(n,"on disabled")}n.dataset.funcAudio||(i.dataset.effectAudio?t.playAudio(i.dataset.effectAudio):EDUTSS.commonEffectAudio.sticker&&e.hasCls(n,"sticker")?t.playAudio("sticker"):t.playAudio("click")),EDUTSS.complete&&EDUTSS.complete.showHide(n),"one"!==i.dataset.funcShow&&EDUTSS.view.showHideComplete(i)})}),e.addEvt(a,"click",function(i){let a=i.currentTarget,n=a.closest("[data-func-show]")||e.getEle("#"+a.dataset.showAll);e.hasCls(a,"replay")?EDUTSS.view.showHideReplay(n):EDUTSS.view.showHideComplete(n,a),t.playAudio("click")})},showHideComplete:function(t,i){let a=e.getEle("[data-show-idx]",t),n=a.length,s=0,o,l;if(i&&"object"!=typeof i&&(l=i,i=null),l)"result"===l?r():"replay"===l&&c();else if(i)e.hasCls(i,"replay")?(e.removeCls(i,"on"),e.hasCls(i,"toggle")&&e.removeCls(i,"replay"),c()):(e.addCls(i,"on"),e.hasCls(i,"toggle")&&e.addCls(i,"replay"),r());else for(0===(i=e.getEle("[data-show-all]",t)).length&&(i=e.getEle("[data-show-all='"+t.getAttribute("id")+"']")),o=0;o<n;o++)e.hasCls(a[o],"on")&&s++;function r(){for(o=0;o<n;o++)e.addCls(a[o],"on"),"toggle"!==t.dataset.funcShow&&e.addCls(a[o],"disabled"),e.addCls(e.getEle("[data-show-obj='"+a[o].dataset.showIdx+"']",t),"obj--show");s=n}function c(){for(o=0;o<n;o++)e.removeCls(a[o],"on disabled"),e.removeCls(e.getEle("[data-show-obj='"+a[o].dataset.showIdx+"']",t),"obj--show")}s===n?(e.addCls(t,"show--complete"),i&&e.addCls(i,"on"),EDUTSS.complete&&EDUTSS.complete.showHide(t),EDUTSS.isDevMsg&&console.log("#D: showHide - 전체 활성 함")):(e.removeCls(t,"show--complete"),i&&e.removeCls(i,"on"))},showHideReplay:function(t){let i=e.getEle("[data-show-idx]",t),a=i.length;for(let n=0;n<a;n++)e.removeCls(i[n],"on disabled"),e.removeCls(e.getEle("[data-show-obj='"+i[n].dataset.showIdx+"']",t),"obj--show");e.removeCls(t,"show--complete");let s=e.getEle("[data-show-all]",t);0===s.length&&(s=e.getEle("[data-show-all='"+t.getAttribute("id")+"']")),s&&(e.removeCls(s,"on disabled"),s.forEach(function(t){e.hasCls(t,"toggle")&&e.removeCls(t,"replay")})),EDUTSS.complete&&EDUTSS.complete.showHide(t),EDUTSS.isDevMsg&&console.log("#D: showHide - 다시하기")},initZoom:function(a){let n=e.getEle("[data-func-zoom]");function s(t,i,a){this.container=t,this.zoomId="zoomPlayer-"+e.isNum(a),this.zoomImgEle=e.getEle(".zoom--obj",t),this.zoomImgEle.length>1?(this.zoomType="fileChange",this.zoomImgEle.forEach(function(e,t){0===t?e.style.opacity="1":e.style.opacity="0",e.style.cursor="default"}),this.ZOOM_RATE=1,this.ZOOM_STEP=this.zoomImgEle.length-1):(this.zoomImg=this.zoomImgEle[0],this.zoomImg.style.cursor="default",this.moveX=this.zoomImg.offsetLeft||0,this.moveY=this.zoomImg.offsetTop||0,this.ZOOM_RATE=Number(i.rate)||20,this.ZOOM_STEP=Number(i.step)||4),this.ZOOM_MIN=1,this.ZOOM_MAX=Number(this.ZOOM_RATE*this.ZOOM_STEP)+1,this.ZOOM_BORDER=2*parseInt(window.getComputedStyle(this.container).borderWidth)||0,this.zoomControl="true"===t.dataset.controlZoom,this.wayControl="true"===t.dataset.controlWay,this.wayMove=Number(i.way)||100,this.rate=1,this.scrollFlow="horizontal",e.hasCls(this.container,"is--vertical")&&(this.scrollFlow="vertical"),t.dataset.zoomRate&&(this.ZOOM_RATE=Number(t.dataset.zoomRate.split("//")[0]),this.ZOOM_STEP=Number(t.dataset.zoomRate.split("//")[1]),this.ZOOM_MAX=Number(this.ZOOM_RATE*this.ZOOM_STEP)+1),Object.defineProperties(this,{areaSize:{get:function(){return this.container.getBoundingClientRect()}},controlHeight:{get:function(){return this.control&&this.control.getBoundingClientRect().height||0}},barSize:{get:function(){return this.barContainer.getBoundingClientRect()}},barWidth:{get:function(){return this.barSize.right-this.barSize.left}},barHeight:{get:function(){return this.barSize.bottom-this.barSize.top}},barRateX:{get:function(){return this.ZOOM_RATE*this.ZOOM_STEP/this.barWidth}},barRateY:{get:function(){return this.ZOOM_RATE*this.ZOOM_STEP/this.barHeight}},barHandlerX:{get:function(){return this.coordX-this.barSize.left}},barHandlerY:{get:function(){return this.coordY-this.barSize.top}},imgSize:{get:function(){return this.zoomImg.getBoundingClientRect()}},imgWidth:{get:function(){return this.imgSize.right-this.imgSize.left}},imgHeight:{get:function(){return this.imgSize.bottom-this.imgSize.top}},limitTop:{get:function(){return Math.round(Math.abs(this.imgHeight-this.imgHeight/this.rate)/2)/EDUTSS.scaleValue.zoom}},limitLeft:{get:function(){return Math.round(Math.abs(this.imgWidth-this.imgWidth/this.rate)/2)/EDUTSS.scaleValue.zoom}},limitRight:{get:function(){return(this.areaSize.width-this.imgWidth)/EDUTSS.scaleValue.zoom+this.limitLeft}},limitBottom:{get:function(){return(this.areaSize.height-this.imgHeight-this.controlHeight)/EDUTSS.scaleValue.zoom+this.limitTop}},coord:{get:function(){return this.coordX,this.coordY},set:function(e){this.coordX=e.touches?e.touches[0].clientX:e.clientX,this.coordY=e.touches?e.touches[0].clientY:e.clientY}}})}s.prototype={init:function(){this.container.dataset.zoomPlayerId=this.zoomId,this.create(),this.addEvt(),this.btnShowHide()},create:function(){this.zoomControl&&(this.control=e.createEle("div",{class:"zoom--control"},this.container),this.zoomOutBtn=e.createEle("div",{class:"btn zoom--out","data-zoom-btn":"out",title:"축소"},this.control),this.zoomInBtn=e.createEle("div",{class:"btn zoom--in","data-zoom-btn":"in",title:"확대"},this.control),this.zoomResetBtn=e.createEle("div",{class:"btn zoom--reset","data-zoom-btn":"reset",title:"초기화"},this.control),this.barContainer=e.createEle("div",{class:"zoom--bar"},this.container),this.barRail=e.createEle("div",{class:"zoom--rail"},this.barContainer),this.barHandler=e.createEle("div",{class:"zoom--handle"},this.barContainer)),this.wayControl&&(this.wayBtns=e.createEle("div",{class:"way--control"},this.container),this.wayBtnLeft=e.createEle("div",{class:"btn way--left","data-way-btn":"left",title:"이동"},this.wayBtns),this.wayBtnRight=e.createEle("div",{class:"btn way--right","data-way-btn":"right",title:"이동"},this.wayBtns),this.wayBtnTop=e.createEle("div",{class:"btn way--top","data-way-btn":"top",title:"이동"},this.wayBtns),this.wayBtnBottom=e.createEle("div",{class:"btn way--bottom","data-way-btn":"bottom",title:"이동"},this.wayBtns))},addEvt:function(){e.addEvt(this.zoomOutBtn,"click",this.setZoomOut.bind(this)),e.addEvt(this.zoomInBtn,"click",this.setZoomIn.bind(this)),e.addEvt(this.zoomResetBtn,"click",this.resetZoom.bind(this)),e.addEvt(this.barContainer,"click",this.clickBarHandle.bind(this)),e.addEvt(this.barHandler,"down",this.dragBarHandle.bind(this)),"fileChange"!==this.zoomType&&(e.addEvt(this.zoomImg,"down",this.dragImgHandle.bind(this)),e.addEvt(this.wayBtnLeft,"click",this.wayHandle.bind(this)),e.addEvt(this.wayBtnRight,"click",this.wayHandle.bind(this)),e.addEvt(this.wayBtnTop,"click",this.wayHandle.bind(this)),e.addEvt(this.wayBtnBottom,"click",this.wayHandle.bind(this)))},setZoomOut:function(){this.rate-this.ZOOM_RATE<=this.ZOOM_MIN?this.rate=this.ZOOM_MIN:(this.rate=this.rate-this.ZOOM_RATE,this.rate=Number(this.rate.toPrecision(2))),this.btnHandle()},setZoomIn:function(){this.rate+this.ZOOM_RATE>=this.ZOOM_MAX?this.rate=this.ZOOM_MAX:(this.rate=this.rate+this.ZOOM_RATE,this.rate=Number(this.rate.toPrecision(2))),this.btnHandle()},resetZoom:function(){this.rate=1,this.zoomImg.style.top=null,this.zoomImg.style.left=null,this.btnHandle()},btnHandle:function(){this.btnShowHide(),this.changeImage(),this.linkageBar(this.getMoveHandler()),t.playAudio("click")},getMoveHandler:function(){var e,t;return(t=(e="horizontal"===this.scrollFlow?this.barWidth:this.barHeight)/this.ZOOM_STEP*((this.rate-1)/this.ZOOM_RATE))>e&&(t=e),Math.round(t)},linkageBar:function(e){"horizontal"===this.scrollFlow?(this.barHandler.style.left=e+"px",this.barRail.style.width=e+"px"):(this.barHandler.style.top=e+"px",this.barRail.style.height=e+"px")},btnShowHide:function(){this.rate===this.ZOOM_MIN?(e.addCls(this.zoomOutBtn,"btn--off"),e.removeCls(this.zoomInBtn,"btn--off"),e.addCls(this.zoomResetBtn,"btn--off")):this.rate===this.ZOOM_MAX?(e.removeCls(this.zoomOutBtn,"btn--off"),e.addCls(this.zoomInBtn,"btn--off"),e.removeCls(this.zoomResetBtn,"btn--off")):(e.removeCls(this.zoomOutBtn,"btn--off"),e.removeCls(this.zoomInBtn,"btn--off"),e.removeCls(this.zoomResetBtn,"btn--off"))},changeImage:function(){if("fileChange"!==this.zoomType)this.zoomImg.style.transform="scale("+this.rate+")",this.zoomImg.style.MsTransform="scale("+this.rate+")",this.zoomImg.style.MozTransform="scale("+this.rate+")",this.zoomImg.style.WebkitTransform="scale("+this.rate+")",this.rate!==this.ZOOM_MIN?this.zoomImg.style.cursor="move":this.zoomImg.style.cursor="default",this.moveX=this.zoomImg.offsetLeft||0,this.moveY=this.zoomImg.offsetTop||0,this.setImgPosition();else{let e=this;this.changeNumber=Math.round(this.rate)-1,this.zoomImgEle.forEach(function(t,i){i===e.changeNumber?t.style.opacity="1":t.style.opacity="0"})}EDUTSS.complete&&EDUTSS.complete.zoom(this)},setImgPosition:function(){let e=this.moveX,t=this.moveY;e>0&&e>this.limitLeft?e=this.limitLeft:e<this.limitRight&&(e=this.limitRight),t>0&&t>this.limitTop?t=this.limitTop:t<this.limitBottom&&(t=this.limitBottom),1===this.rate&&(Math.floor(this.areaSize.width)-Math.floor(this.ZOOM_BORDER)-4<Math.floor(this.imgSize.width)&&Math.floor(this.areaSize.width)-Math.floor(this.ZOOM_BORDER)+4>Math.floor(this.imgSize.width)&&(e=0),Math.floor(this.areaSize.height)-Math.floor(this.ZOOM_BORDER)-4<Math.floor(this.imgSize.height)&&Math.floor(this.areaSize.height)-Math.floor(this.ZOOM_BORDER)+4>Math.floor(this.imgSize.height)&&(t=0)),this.zoomImg.style.left=e+"px",this.zoomImg.style.top=t+"px"},dragImgHandle:function(t){let i=this;function a(e){i.coord=e,i.moveX=i.startPrevX-i.startX+i.coordX,i.moveY=i.startPrevY-i.startY+i.coordY,i.setImgPosition()}t.preventDefault(),t.stopPropagation(),e.addEvt(i.container,"move",a),e.addEvt(i.container,"up",function(){e.removeEvt(i.container,"move",a)}),e.addEvt(i.container,"leave",function(){e.removeEvt(i.container,"move",a)}),this.coord=t,this.startX=this.coordX,this.startY=this.coordY,this.startPrevX=this.zoomImg.offsetLeft,this.startPrevY=this.zoomImg.offsetTop,EDUTSS.view.senseClosePopupEvent(t)},clickBarHandle:function(e){this.coord=e,this.moveBarHandle(this.barHandlerX)},dragBarHandle:function(t){let i=this;function a(e){let t,a;"horizontal"===i.scrollFlow?(t=i.barHandlerX,a=i.barHandler.offsetWidth/2,i.coord=e,t<i.barWidth&&t>0&&(t<a?t=0:t>i.barWidth-a&&(t=i.barWidth),i.moveBarHandle(t))):(t=i.barHandlerY,a=i.barHandler.offsetHeight/2,i.coord=e,t<i.barHeight&&t>0&&(t<a?t=0:t>i.barHeight-a&&(t=i.barHeight),i.moveBarHandle(t))),i.btnShowHide()}t.preventDefault(),t.stopPropagation(),e.addEvt(document,"move",a),e.addEvt(document,"up",function(){e.removeEvt(document,"move",a)}),e.addEvt(this.container,"leave",function(){e.removeEvt(document,"move",a)}),EDUTSS.view.senseClosePopupEvent(t)},moveBarHandle:function(e){"horizontal"===this.scrollFlow?this.rate=Number((e*this.barRateX+1).toPrecision(3)):this.rate=Number((e*this.barRateY+1).toPrecision(3)),this.linkageBar(e),this.changeImage()},wayHandle:function(e){let t=e.currentTarget.dataset.wayBtn;switch(this.startPrevX=this.zoomImg.offsetLeft,this.startPrevY=this.zoomImg.offsetTop,this.moveX=this.startPrevX,this.moveY=this.startPrevY,t){case"left":this.moveX=this.startPrevX-this.wayMove;break;case"right":this.moveX=this.startPrevX+this.wayMove;break;case"top":this.moveY=this.startPrevY-this.wayMove;break;case"bottom":this.moveY=this.startPrevY+this.wayMove}this.setImgPosition()}};let o=i.zoom;n.forEach(function(e,t){o[t]=new s(e,a,t+1),o[t].init(),EDUTSS.isDevMsg&&console.log("#D: 확대/축소 생성")})},resetZoom:function(e){i.zoom.forEach(function(e){data.zoomId===e&&data.resetZoom()})},initDownload:function(){let i=e.getEle("[data-func-down]"),a;i.forEach(function(t){t.dataset.funcTooltip&&((a=e.createEle("span",{class:"tooltip"},t)).innerHTML=t.dataset.funcTooltip)}),e.addEvt(i,"enter",function(t){a=e.getEle(".tooltip",t.currentTarget)[0],e.isTouch||e.addCls(a,"show--tooltip")}),e.addEvt(i,"leave",function(t){a=e.getEle(".tooltip",t.currentTarget)[0],e.isTouch||e.removeCls(a,"show--tooltip")}),e.addEvt(i,"click",function(i){let a=i.currentTarget.dataset.funcDown,n=a.split("/").slice(-1)[0],s=n.split(".")[1];if(EDUTSS.isDTBOOK)parent.GO_OPEN_FILE(a,s);else{let o=e.createEle("a",{href:a,download:n,target:"_blank"});if("ie"===e.getDevice()){let l=new XMLHttpRequest;l.onloadstart=function(){l.responseType="blob"},l.onload=function(){navigator.msSaveOrOpenBlob(l.response,n)},l.open("GET",a,!0),l.send()}else o.click()}t.playAudio("click")})},initDrawing:function(a){let n=e.getEle("[data-func-drawing]"),s=n[0]&&n[0].dataset.defaultOption||a.default;function o(t,i,a){this.container=t,this.drawingId="drawingCanvas-"+e.isNum(a),this.canvas=e.getEle(".drawing--canvas",t)[0],this.saveInput=e.getEle(".drawing--save",t)[0],this.arrType=i.type.split(","),this.arrColor=t.dataset.colorOption?t.dataset.colorOption.split("//"):i.color.split(","),this.arrThick=i.thick.split(","),this.arrDefault=s.split(","),this.isDrawType=this.arrDefault[0],this.isDrawColor=t.dataset.colorOption?this.arrColor[0]:this.arrDefault[1],this.isDrawThick=this.arrDefault[2],this.isDisable=!0,this.isDrawing=!1,this.isEraser=!1,this.ctx=this.canvas.getContext("2d"),this.ctx.lineJoin="round",this.ctx.lineCap="round",this.ctx.lineWidth=this.isDrawThick.split("px")[0],this.ctx.strokeStyle="#"+this.isDrawColor,this.ctx.imageSmoothingEnabled=!0,this.startX=0,this.startY=0,this.endX=0,this.endY=0,this.withQuiz=!!this.container.closest("[data-quiz-type]"),e.hasCls(this.container,"is--menu--view")?this.isOpenMenu=!1:this.isOpenMenu=!0,Object.defineProperties(this,{canvasSize:{get:function(){return this.canvas.getBoundingClientRect()}},canvasX:{get:function(){return this.canvasSize.left/EDUTSS.scaleValue.zoom}},canvasY:{get:function(){return this.canvasSize.top/EDUTSS.scaleValue.zoom}},canvasWidth:{get:function(){return this.canvasSize.width/EDUTSS.scaleValue.zoom}},canvasHeight:{get:function(){return this.canvasSize.height/EDUTSS.scaleValue.zoom}},coord:{get:function(){return this.coordX,this.coordY},set:function(e){this.coordX=e.touches?e.touches[0].clientX:e.clientX,this.coordY=e.touches?e.touches[0].clientY:e.clientY}}})}o.prototype={init:function(){if(this.container.dataset.drawingId=this.drawingId,0===e.getEle(".drawing--menu",this.container).length?this.create():this.drawingMenu=e.getEle(".drawing--menu",this.container),this.btnDrawType=e.getEle("[data-drawing-type]",this.container),this.btnDrawColor=e.getEle("[data-drawing-color]",this.container),this.btnDrawThick=e.getEle("[data-drawing-thick]",this.container),"soc"===EDUTSS.isSubject&&e.getEle(".drawing--canvas",this.container).length>1){this.canvasArr=e.getEle(".drawing--canvas",this.container),this.saveInputArr=e.getEle(".drawing--save",this.container),this.canvasLen=this.canvasArr.length,this.ctxArr=[];for(let t=0;t<this.canvasLen;t++)this.ctxArr[t]=this.canvasArr[t].getContext("2d"),this.ctxArr[t].lineJoin="round",this.ctxArr[t].lineCap="round",this.ctxArr[t].lineWidth=this.isDrawThick.split("px")[0],this.ctxArr[t].strokeStyle="#"+this.isDrawColor,this.ctxArr[t].imageSmoothingEnabled=!0}this.addEvt(),this.readyDraw()},create:function(){this.isOpenMenu&&(this.btnOpenMenu=e.createEle("div",{class:"btn open--drawing"},this.container)),this.drawingMenu=e.createEle("div",{class:"drawing--menu"},this.container),this.colorContainer=e.createEle("div",{class:"drawing--colors"},this.drawingMenu),this.thickContainer=e.createEle("div",{class:"drawing--thicks"},this.drawingMenu),this.typeContainer=e.createEle("div",{class:"drawing--type"},this.drawingMenu);for(let t=0;t<this.arrColor.length;t++)e.createEle("div",{class:"btn","data-drawing-color":this.arrColor[t]},this.colorContainer);for(let i=0;i<this.arrThick.length;i++)e.createEle("div",{class:"btn","data-drawing-thick":this.arrThick[i]},this.thickContainer);for(let a=0;a<this.arrType.length;a++)e.createEle("div",{class:"btn","data-drawing-type":this.arrType[a]},this.typeContainer)},addEvt:function(){let t=this,i=t.canvasArr?t.canvasArr:t.canvas;t.isOpenMenu&&e.addEvt(t.btnOpenMenu,"click",t.openMenu.bind(t)),e.addEvt(t.btnDrawType,"click",t.typeHandle.bind(t)),e.addEvt(t.btnDrawColor,"click",t.colorHandle.bind(t)),e.addEvt(t.btnDrawThick,"click",t.thickHandle.bind(t)),e.addEvt(i,"down",function(e){t.isDisable||(e.preventDefault(),e.stopPropagation(),t.onTouchStart.call(t,e))})},readyDraw:function(){e.addCls(e.getEle("[data-drawing-type='"+this.isDrawType+"']",this.container),"on"),e.addCls(e.getEle("[data-drawing-color='"+this.isDrawColor+"']",this.container),"on"),e.addCls(e.getEle("[data-drawing-thick='"+this.isDrawThick+"']",this.container),"on"),this.btnDrawColor.forEach(function(e){e.style.backgroundColor="#"+e.dataset.drawingColor}),this.loadDraw(),this.isOpenMenu||this.openMenu()},openMenu:function(){this.isDisable?(this.isDisable=!1,e.addCls(this.drawingMenu,"active"),e.addCls(this.btnOpenMenu,"on"),this.btnOpenMenu&&(this.btnOpenMenu.style.left=this.drawingMenu.offsetWidth+"px")):(this.isDisable=!0,e.removeCls(this.drawingMenu,"active"),e.removeCls(this.btnOpenMenu,"on"),this.btnOpenMenu&&(this.btnOpenMenu.style.left=null)),this.isOpenMenu&&t.playAudio("click")},typeHandle:function(t){let i=this,a=t.currentTarget;i.isDrawType=a.dataset.drawingType,e.removeCls(i.btnDrawType,"on"),e.addCls(a,"on"),"reset"===i.isDrawType&&(i.deleteDraw(),i.isDrawing=!1,i.isEraser=!1)},colorHandle:function(t){let i=t.currentTarget;this.isDrawColor=i.dataset.drawingColor,e.removeCls(this.btnDrawColor,"on"),e.addCls(i,"on"),this.btnDrawType[0].click()},thickHandle:function(t){let i=t.currentTarget;this.isDrawThick=i.dataset.drawingThick,e.removeCls(this.btnDrawThick,"on"),e.addCls(i,"on"),this.btnDrawType[0].click()},onTouchStart:function(t){let i=this,a=i.canvasArr?i.canvasArr:i.canvas;function n(e){i.endX=(e.touches?e.touches[0].clientX:e.clientX)/EDUTSS.scaleValue.zoom-i.canvasX,i.endY=(e.touches?e.touches[0].clientY:e.clientY)/EDUTSS.scaleValue.zoom-i.canvasY,i.ctx.lineTo(i.endX,i.endY),i.ctx.stroke()}i.canvasArr&&(t.composedPath&&t.composedPath()||t.path).forEach(function(e){if(e.classList&&e.classList.contains("drawing--canvas"))for(let t=0;t<i.canvasArr.length;t++)i.canvasArr[t]===e&&(i.canvas=i.canvasArr[t],i.ctx=i.ctxArr[t])}),i.coord=t,i.startX=(t.touches?t.touches[0].clientX:t.clientX)/EDUTSS.scaleValue.zoom-i.canvasX,i.startY=(t.touches?t.touches[0].clientY:t.clientY)/EDUTSS.scaleValue.zoom-i.canvasY,"pen"===i.isDrawType?i.startDraw():"eraser"===i.isDrawType&&i.eraserDraw(),(this.isDrawing||this.isEraser)&&(i.endX=null,i.endY=null,e.addEvt(a,"move",n),e.addEvt(a,"up",function(){i.endX||(i.ctx.lineTo(i.startX,i.startY),i.ctx.stroke()),e.removeEvt(a,"move",n),i.stopDraw()}),e.addEvt(a,"leave",function(){e.removeEvt(a,"move",n),i.stopDraw()}))},startDraw:function(){this.isDrawing=!0,this.isEraser=!1,this.ctx.beginPath(),this.ctx.lineWidth=this.isDrawThick.split("px")[0],this.ctx.strokeStyle="#"+this.isDrawColor,this.ctx.globalCompositeOperation="source-over",this.canvas.style.visibility="visible"},eraserDraw:function(){this.isDrawing=!1,this.isEraser=!0,this.ctx.beginPath(),this.ctx.lineWidth=2*this.isDrawThick.split("px")[0],this.ctx.globalCompositeOperation="destination-out"},stopDraw:function(){if(this.isDrawing=!1,this.isEraser=!1,this.ctx.closePath(),this.ctx.save(),this.saveDraw(),this.withQuiz){let t=this.checkDrawn(),i=EDUTSS.quizData.DATA[this.container.closest("[data-quiz-type]").dataset.quizId];t?(e.addCls(this.canvas,"canvas--drawn"),EDUTSS.quiz.controlBtnHandler(i)):e.removeCls(this.canvas,"canvas--drawn"),EDUTSS.quizData.addQuizActivity(i,t)}},deleteDraw:function(){if(this.canvasArr)for(let t=0;t<this.canvasLen;t++)this.ctxArr[t].clearRect(0,0,this.canvasArr[t].width,this.canvasArr[t].height),this.ctxArr[t].beginPath(),this.saveInputArr[t].value="";else if(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.beginPath(),this.saveInput.value="",this.withQuiz){let i=this.container.closest("[data-quiz-type]").dataset.quizId;e.removeCls(this.canvas,"canvas--drawn"),EDUTSS.quizData.addQuizActivity(EDUTSS.quizData.DATA[i],!1),EDUTSS.quiz.syncControlBtn(i,"replay")}},hideDraw:function(){if(this.canvasArr)for(let e=0;e<this.canvasLen;e++)this.canvasArr[e].style.visibility="hidden";else this.canvas.style.visibility="hidden"},loadDraw:function(){let t=this,i=this.container.closest("[data-quiz-type]"),a=i?EDUTSS.quizData.DATA[i.dataset.quizId]:null;setTimeout((function(){if(t.canvasArr){for(let i=0;i<this.canvasLen;i++)if(t.saveInputArr[i].value){let n=new Image;n.src=t.saveInputArr[i].value,n.onload=function(){t.ctxArr[i].drawImage(n,0,0),EDUTSS.isDevMsg&&console.log("#D: 그리기 로드")},e.addCls(t.canvasArr[i],"canvas--drawn")}}else if(t.saveInput.value){let s=new Image;s.src=t.saveInput.value,s.onload=function(){t.ctx.drawImage(s,0,0),EDUTSS.isDevMsg&&console.log("#D: 그리기 로드")},e.addCls(t.canvas,"canvas--drawn"),t.withQuiz&&(EDUTSS.quiz.controlBtnHandler(a),EDUTSS.quizData.addQuizActivity(a,!0))}}).bind(this),2e3)},saveDraw:function(){if(this.canvasArr)for(let e=0;e<this.canvasLen;e++)this.saveInputArr[e].value=this.canvasArr[e].toDataURL("images/png");else this.saveInput.value=this.canvas.toDataURL("images/png")},checkDrawn:function(){let e=new Uint32Array(this.ctx.getImageData(0,0,this.canvas.width,this.canvas.height).data.buffer),t=!e.some(function(e){return 0!==e});return!t}};let l=i.drawing;n.forEach(function(e,t){l[t]=new o(e,a,t+1),l[t].init(),EDUTSS.isDevMsg&&console.log("#D: 그리기 생성")})},viewReset:function(){let i=e.getEle("[data-func-replay]"),a,n;i.forEach(function(t){(a=e.getEle("#"+t.dataset.funcReplay)||null)&&(n=e.getEle("input, textarea",a)).forEach(function(t){e.hasCls(t,"quiz--input")||(t.addEventListener("keyup",function(t){var a;let s;s=!1,(a=n).forEach(function(t){e.hasCls(t,"quiz--input")||""===t.value||(s=!0)}),s?e.addCls(i,"btn--show"):e.removeCls(i,"btn--show")}),setTimeout(function(){""!==t.value&&e.addCls(i,"btn--show")},1e3))})}),e.addEvt(i,"click",function(i){let a=e.getEle("#"+i.currentTarget.dataset.funcReplay);EDUTSS.view.viewResetEle(a),e.removeCls(i.currentTarget,"btn--show"),t.playAudio("click")})},viewResetEle:function(t){let i=e.getEle("[data-func-show]",t);i.forEach(function(e){EDUTSS.view.showHideReplay(e)});let a=e.getEle("[data-func-check]",t);a.forEach(function(e){EDUTSS.view.resetCheckList(e)}),e.getEle("input, textarea",t).forEach(function(t){e.hasCls(t,"quiz--input")||(e.removeCls(t,"disabled done on"),t.value="",t.checked=!1)})},viewUpdate:function(i,a){i.length||(i=[i]),i.forEach(function(t){if(EDUTSS.isDTBOOK&&EDUTSS.dragUtil.loadDrawData(t),EDUTSS.fixBtnBottomPosition){let i=e.getEle(".btn_wrap.bottom_right.fix, .btn_wrap.bottom_left.fix",t);i.length>0&&EDUTSS.ui.addPositionButton(i)}e.getEle("[data-layout-type='scroll']",t).forEach(function(e){EDUTSS.view.visibleScrollState(e)})}),a||t.stopCurrentSound(i)},visibleScrollState:function(e){e&&i.scroll.forEach(function(t){t.container.dataset.scrollId===e.dataset.scrollId&&t.ready()})},toggleIndivReplay:function(t,i){let a=e.getEle(".input--reset .replay",t.closest(".input_area"));i?e.addCls(a,"btn--show"):e.removeCls(a,"btn--show")},limitInputText:function(t,i,a){let n=a||("textarea"===t.tagName?5e3:e.hasCls(t,"spelling")?1:5e3);i.length>n&&(t.value=i.substring(0,n))},removeInpText:function(t){e.getEle("input, textarea",t.closest(".input_area")).forEach(function(e){e.value=""})},showIndivReplay:function(){let t=setInterval(function(){e.getEle("input, textarea").forEach(function(t){e.getText(t.value)&&"checkbox"!==t.type&&"radio"!==t.type&&e.addCls(e.getEle(".input--reset .replay",t.closest(".input_area")),"btn--show")})},200);setTimeout(function(){clearInterval(t)},5e3)},initTextAreaScroll:function(){e.getEle("textarea").forEach(function(t){let i=t.parentElement;t.closest("scroll_area")||(e.addCls(i,"scroll_area"),i.dataset.layoutType="scroll",e.addCls(t,"scroll--content"),EDUTSS.view.initScroll(i),e.getEle(".scroll--bar, .scroll--move",i).forEach(function(e){e.dataset.duplicationType="false"})),setTimeout(function(){EDUTSS.view.visibleScrollState(t.closest(".scroll_area"))},1500)})}}}();var EDUTSS=EDUTSS||{};EDUTSS.animate=function(){let e=EDUTSS.util,t={};return{initAnimate:function(){let t=e.getEle("[data-func-animate]");t.forEach(function(e){EDUTSS.animate.setAnimateData(e)});let i=e.getEle("[data-animate-play]");e.addEvt(i,"click",function(t){e.hasCls(t.currentTarget,"playing--on")?EDUTSS.animate.animateStop(t.currentTarget.dataset.animatePlay):EDUTSS.animate.animatePlay(t.currentTarget.dataset.animatePlay)})},animatePlay:function(i){let a=e.getEle("[data-animate-id='"+i+"']")[0],n=a.dataset.funcAnimate;switch(t[a.dataset.animateId]||EDUTSS.animate.setAnimateData(a),n){case"css":EDUTSS.animate.cssAnimate(a,"play");break;case"sprite":EDUTSS.animate.spriteAnimate(a,"play");break;case"png":EDUTSS.animate.pngAnimate(a,"play");break;case"gif":EDUTSS.animate.gifAnimate(a,"play")}EDUTSS.isDevMsg&&console.log("#D: 애니메이션 재생, type => "+n),EDUTSS.complete&&t[a.dataset.animateId]&&EDUTSS.complete.animate(t[a.dataset.animateId])},animateStop:function(i){let a=e.getEle("[data-animate-id='"+i+"']")[0],n=a.dataset.funcAnimate;switch(t[a.dataset.animateId]||EDUTSS.animate.setAnimateData(a),n){case"css":EDUTSS.animate.cssAnimate(a,"stop");break;case"sprite":EDUTSS.animate.spriteAnimate(a,"stop");break;case"png":EDUTSS.animate.pngAnimatePlay(a,"stop");break;case"gif":EDUTSS.animate.gifAnimate(a,"stop")}EDUTSS.isDevMsg&&console.log("#D: 애니메이션 정지, type => "+n)},stopAllAnimate:function(){e.getEle("[data-animate-id]").forEach(function(e){EDUTSS.animate.animateStop(e.dataset.animateId)})},cssAnimate:function(i,a){let n=t[i.dataset.animateId];for(let s=0;s<n.animateLen;s++)e.removeCls(n.animate[s],"animate--playing"),e.addCls(n.animate[s],"animate--hide");"play"===a?(n.playing=null,n.playing=setInterval(function(){n.num===n.animateLen&&(clearInterval(n.playing),e.addCls(n.container,"animate--complete")),n.target=n.animate[n.num],e.addCls(n.target,"animate--playing"),e.removeCls(n.target,"animate--hide"),n.num++},n.delay),n.playingTime&&EDUTSS.animate.endAnimate(i),n.playBtn&&e.addCls(n.playBtn,"playing--on")):"stop"===a&&(e.removeCls(n.container,"animate--complete"),n.playing&&clearInterval(n.playing),n.playBtn&&e.removeCls(n.playBtn,"playing--on"))},pngAnimate:function(i,a){let n=t[i.dataset.animateId];"play"===a?(n.num=1,n.playing=null,n.playing=setInterval(function(){n.num===n.endNum&&(0===n.iteration?n.num=1:1===n.iteration?clearInterval(n.playing):(n.iteration--,n.num=1)),n.imgEle.src=n.fixSrc+"_"+(n.num<10?"0"+n.num:n.num)+"."+n.fileName,n.num++},n.delay),n.playingTime&&EDUTSS.animate.endAnimate(i),n.playBtn&&e.addCls(n.playBtn,"playing--on")):"stop"===a&&(n.imgEle.src=n.fixSrc+"_01."+n.fileName,n.playing&&clearInterval(n.playing),n.playBtn&&e.removeCls(n.playBtn,"playing--on"))},spriteAnimate:function(i,a){let n=t[i.dataset.animateId];"play"===a?(n.playing=null,n.playing=setInterval(function(){n.num===n.spriteTotal&&(0===n.iteration?(n.num=1,n.col=0,n.row=0):1===n.iteration?clearInterval(n.playing):(n.iteration--,n.num=1,n.col=0,n.row=0)),n.row===Math.floor(n.num/n.spriteRowNum)?n.col++:(n.row++,n.col=0),n.imgEle.style.backgroundPositionX="-"+n.col*n.imgWidth+"px",n.imgEle.style.backgroundPositionY="-"+n.row*n.imgHeight+"px",n.num++},n.delay),n.playingTime&&EDUTSS.animate.endAnimate(i),n.playBtn&&e.addCls(n.playBtn,"playing--on")):"stop"===a&&(n.imgEle.style.backgroundPositionX="0px",n.imgEle.style.backgroundPositionY="0px",n.num=1,n.col=0,n.row=0,n.playing&&clearInterval(n.playing),n.playBtn&&e.removeCls(n.playBtn,"playing--on"))},gifAnimate:function(i,a){let n=t[i.dataset.animateId];"play"===a?(n.imgEle.src=n.changeSrc.split("?")[0].replace(".png",".gif")+"?"+e.getRandomNumber(1e4),n.playingTime&&EDUTSS.animate.endAnimate(i),n.playBtn&&e.addCls(n.playBtn,"playing--on")):"stop"===a&&(n.imgEle.src=n.changeSrc.split("?")[0].replace(".gif",".png"),n.playing&&clearInterval(n.playing),n.playBtn&&e.removeCls(n.playBtn,"playing--on"))},endAnimate:function(e){let i=t[e.dataset.animateId];i.endTimeOut&&clearTimeout(i.endTimeOut),i.endTimeOut=setTimeout(function(){switch(i.type){case"css":EDUTSS.animate.cssAnimate(e,"stop");break;case"sprite":EDUTSS.animate.spriteAnimate(e,"stop");break;case"png":EDUTSS.animate.pngAnimate(e,"stop");break;case"gif":EDUTSS.animate.gifAnimate(e,"stop")}},1e3*i.playingTime)},setAnimateData:function(i){let a=i.dataset.animateId,n;if(!t[a]){switch((n={}).container=i,n.animateId=i.dataset.animateId,n.type=i.dataset.funcAnimate,n.iteration=Number(i.dataset.animateIteration)||0,n.delay=Number(i.dataset.animateDelay)||Number(EDUTSS.isAnimateSpriteDelay)||80,n.playingTime=i.dataset.playingTime||null,i.dataset.funcAnimate){case"css":n.animate=e.getEle(".animate",i),n.animateLen=n.animate.length,n.delay=Number(i.dataset.animateDelay)||80,n.num=0,n.target;break;case"sprite":n.imgEle=e.getEle(".animate--sprite",i)[0],n.imgWidth=n.imgEle.offsetWidth,n.imgHeight=n.imgEle.offsetHeight,n.spriteRowNum=Number(i.dataset.animateSprite.split("//")[0]),n.spriteColNum=Number(i.dataset.animateSprite.split("//")[1]),n.spriteEndNum=Number(i.dataset.animateSprite.split("//")[2])||n.spriteRowNum,n.spriteTotal=n.spriteRowNum*(n.spriteColNum-1)+n.spriteEndNum-1,n.num=1,n.col=0,n.row=0;break;case"png":n.imgEle=e.getEle(".animate--png",i)[0],n.imgFile=n.imgEle.getAttribute("src").split("/").slice(-1),n.imgSrc=n.imgEle.getAttribute("src").split(n.imgFile),n.fixSrc=n.imgSrc[0]+n.imgFile[0].split("_01.png")[0],n.fileName=n.imgFile[0].split(".")[1],n.endNum=Number(i.dataset.animateEndnum),n.num=1;let s=e.createEle("div",{class:"image_loading blind"},i);for(let o=1;o<=n.endNum;o++)e.createEle("img",{src:n.fixSrc+"_"+(o<10?"0"+o:o)+"."+n.fileName},s);break;case"gif":n.imgEle=e.getEle(".animate--gif",i)[0],n.imgFile=n.imgEle.getAttribute("src").split("/").slice(-1),n.imgSrc=n.imgEle.getAttribute("src").split(n.imgFile),n.changeSrc=n.imgSrc[0]+n.imgFile[0]}n.playBtn=e.getEle("[data-animate-play='"+a+"']"),t[a]=n,EDUTSS.isDevMsg&&(console.log("#D: 애니메이션 데이터"),console.log(n))}}}}();